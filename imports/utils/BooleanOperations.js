// boolean operations extracted from Paper.js

/*!
 * Paper.js v0.10.2-svg-boolean-op - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2016, Juerg Lehni & Jonathan Puckey
 * http://scratchdisk.com/ & http://jonathanpuckey.com/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Sat Jul 23 13:00:49 2016 +0300
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2016 Juerg Lehni
 * http://scratchdisk.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * http://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */

//var paper = function(self, undefined) {

/*self = self || require('./node/window.js');

var window = self.window,
  document = self.document;
*/


var Base=new function(){function t(t,i,r,s,o){function u(n,u){u=u||(u=a(i,n))&&(u.get?u:u.value),"string"==typeof u&&"#"===u[0]&&(u=t[u.substring(1)]||u);var c,_="function"==typeof u,g=u,d=o||_&&!u.base?u&&u.get?n in t:t[n]:null;o&&d||(_&&d&&(u.base=d),_&&s!==!1&&(c=n.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(l[c[3].toLowerCase()+c[4]]=c[2]),g&&!_&&g.get&&"function"==typeof g.get&&e.isPlainObject(g)||(g={value:g,writable:!0}),(a(t,n)||{configurable:!0}).configurable&&(g.configurable=!0,g.enumerable=r),h(t,n,g))}var l={};if(i){for(var c in i)i.hasOwnProperty(c)&&!n.test(c)&&u(c);for(var c in l){var _=l[c],g=t["set"+_],d=t["get"+_]||g&&t["is"+_];!d||s!==!0&&0!==d.length||u(c,{get:d,set:g})}}return t}function e(){for(var t=0,e=arguments.length;e>t;t++){var n=arguments[t];n&&l(this,n)}return this}var n=/^(statics|enumerable|beans|preserve)$/,i=[],r=i.slice,s=Object.create,a=Object.getOwnPropertyDescriptor,h=Object.defineProperty,o=i.forEach||function(t,e){for(var n=0,i=this.length;i>n;n++)t.call(e,this[n],n,this)},u=function(t,e){for(var n in this)this.hasOwnProperty(n)&&t.call(e,this[n],n,this)},l=Object.assign||function(t){for(var e=1,n=arguments.length;n>e;e++){var i=arguments[e];for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t},c=function(t,e,n){if(t){var i=a(t,"length");(i&&"number"==typeof i.value?o:u).call(t,e,n=n||t)}return n};return t(e,{inject:function(e){if(e){var n=e.statics===!0?e:e.statics,i=e.beans,r=e.preserve;n!==e&&t(this.prototype,e,e.enumerable,i,r),t(this,n,!0,i,r)}for(var s=1,a=arguments.length;a>s;s++)this.inject(arguments[s]);return this},extend:function(){for(var e,n,i,r=this,a=0,o=arguments.length;o>a&&(!e||!n);a++)i=arguments[a],e=e||i.initialize,n=n||i.prototype;return e=e||function(){r.apply(this,arguments)},n=e.prototype=n||s(this.prototype),h(n,"constructor",{value:e,writable:!0,configurable:!0}),t(e,this,!0),arguments.length&&this.inject.apply(e,arguments),e.base=r,e}},!0).inject({initialize:e,set:e,inject:function(){for(var e=0,n=arguments.length;n>e;e++){var i=arguments[e];i&&t(this,i,i.enumerable,i.beans,i.preserve)}return this},extend:function(){var t=s(this);return t.inject.apply(t,arguments)},each:function(t,e){return c(this,t,e)},clone:function(){return new this.constructor(this)},statics:{set:l,each:c,create:s,define:h,describe:a,clone:function(t){return l(new t.constructor,t)},isPlainObject:function(t){var n=null!=t&&t.constructor;return n&&(n===Object||n===e||"Object"===n.name)},pick:function(t,e){return void 0!==t?t:e},slice:function(t,e,n){return r.call(t,e,n)}}})};"undefined"!=typeof module&&(module.exports=Base),Base.inject({statics:{exports:{enumerable:!0},extend:function t(){var e=t.base.apply(this,arguments),n=e.prototype._class;return n&&!Base.exports[n]&&(Base.exports[n]=e),e},read:function(t,e,n,i){if(this===Base){var r=this.peek(t,e);return t.__index++,r}var s=this.prototype,a=s._readIndex,h=e||a&&t.__index||0,o=t.length,u=t[h];return i=i||o-h,u instanceof this||n&&n.readNull&&null==u&&1>=i?(a&&(t.__index=h+1),u&&n&&n.clone?u.clone():u):(u=Base.create(this.prototype),a&&(u.__read=!0),u=u.initialize.apply(u,h>0||o>h+i?Base.slice(t,h,h+i):t)||u,a&&(t.__index=h+u.__read,u.__read=void 0),u)},peek:function(t,e){return t[t.__index=e||t.__index||0]},readList:function(t,e,n,i){for(var r,s=[],a=e||0,h=i?a+i:t.length,o=a;h>o;o++)s.push(Array.isArray(r=t[o])?this.read(r,0,n):this.read(t,o,n,1));return s},splice:function(t,e,n,i){var r=e&&e.length,s=void 0===n;n=s?t.length:n,n>t.length&&(n=t.length);for(var a=0;r>a;a++)e[a]._index=n+a;if(s)return t.push.apply(t,e),[];var h=[n,i];e&&h.push.apply(h,e);for(var o=t.splice.apply(t,h),a=0,u=o.length;u>a;a++)o[a]._index=void 0;for(var a=n+r,u=t.length;u>a;a++)t[a]._index=a;return o},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(t,e){if("string"!=typeof t)Base.each(t,function(t,e){this.on(e,t)},this);else{var n=this._eventTypes,i=n&&n[t],r=this._callbacks=this._callbacks||{};r=r[t]=r[t]||[],-1===r.indexOf(e)&&(r.push(e),i&&i.install&&1===r.length&&i.install.call(this,t))}return this},off:function(t,e){if("string"!=typeof t)return void Base.each(t,function(t,e){this.off(e,t)},this);var n,i=this._eventTypes,r=i&&i[t],s=this._callbacks&&this._callbacks[t];return s&&(!e||-1!==(n=s.indexOf(e))&&1===s.length?(r&&r.uninstall&&r.uninstall.call(this,t),delete this._callbacks[t]):-1!==n&&s.splice(n,1)),this},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var n=this._callbacks&&this._callbacks[t];if(!n)return!1;var i=Base.slice(arguments,1),r=e&&e.target&&!e.currentTarget;n=n.slice(),r&&(e.currentTarget=this);for(var s=0,a=n.length;a>s;s++)if(n[s].apply(this,i)===!1){e&&e.stop&&e.stop();break}return r&&delete e.currentTarget,!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._eventTypes,n=this._callbacks,i=t?"install":"uninstall";if(e)for(var r in n)if(n[r].length>0){var s=e[r],a=s&&s[i];a&&a.call(this,r)}},statics:{inject:function e(t){var n=t._events;if(n){var i={};Base.each(n,function(e,n){var r="string"==typeof e,s=r?e:n,a=Base.capitalize(s),h=s.substring(2).toLowerCase();i[h]=r?{}:e,s="_"+s,t["get"+a]=function(){return this[s]},t["set"+a]=function(t){var e=this[s];e&&this.off(h,e),t&&this.on(h,t),this[s]=t}}),t._eventTypes=i}return e.base.apply(this,arguments)}}},PaperScope=Base.extend({_class:"PaperScope",initialize:function n(){paper=this,this.settings=new Base({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=n._id++,n._scopes[this._id]=this;n.prototype},version:"0.10.2-svg-boolean-restart",setup:function(t){return paper=this,this.project=new Project(t),this},statics:new function(){return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null}}}}),Formatter=Base.extend({initialize:function(t){this.precision=Base.pick(t,5),this.multiplier=Math.pow(10,this.precision)},number:function(t){return this.precision<16?Math.round(t*this.multiplier)/this.multiplier:t},pair:function(t,e,n){return this.number(t)+(n||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});Formatter.instance=new Formatter;var Numerical=new function(){function t(t,e,n){return e>t?e:t>n?n:t}function e(t,e,n){function i(t){var e=134217729*t,n=t-e,i=n+e,r=t-i;return[i,r]}var r=e*e-t*n,a=e*e+t*n;if(3*s(r)<a){var h=i(t),o=i(e),u=i(n),l=e*e,c=o[0]*o[0]-l+2*o[0]*o[1]+o[1]*o[1],_=t*n,g=h[0]*u[0]-_+h[0]*u[1]+h[1]*u[0]+h[1]*u[1];r=l-_+(c-g)}return r}function n(){var t=Math.max.apply(Math,arguments);return t&&(1e-8>t||t>1e8)?h(2,-Math.round(o(t))):0}var i=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],r=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],s=Math.abs,a=Math.sqrt,h=Math.pow,o=Math.log2||function(t){return Math.log(t)*Math.LOG2E},u=1e-12,l=1.12e-16;return{TOLERANCE:1e-6,EPSILON:u,MACHINE_EPSILON:l,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:1e-7,WINDING_EPSILON:1e-8,TRIGONOMETRIC_EPSILON:1e-8,CLIPPING_EPSILON:1e-10,KAPPA:4*(a(2)-1)/3,isZero:function(t){return t>=-u&&u>=t},clamp:t,integrate:function(t,e,n,s){for(var a=i[s-2],h=r[s-2],o=.5*(n-e),u=o+e,l=0,c=s+1>>1,_=1&s?h[l++]*t(u):0;c>l;){var g=o*a[l];_+=h[l++]*(t(u+g)+t(u-g))}return o*_},findRoot:function(t,e,n,i,r,a,h){for(var o=0;a>o;o++){var u=t(n),l=u/e(n),c=n-l;if(s(l)<h)return c;u>0?(r=n,n=i>=c?.5*(i+r):c):(i=n,n=c>=r?.5*(i+r):c)}return n},solveQuadratic:function(i,r,h,o,c,_){var g,d=1/0;if(s(i)<u){if(s(r)<u)return s(h)<u?-1:0;g=-h/r}else{r*=-.5;var f=e(i,r,h);if(f&&s(f)<l){var v=n(s(i),s(r),s(h));v&&(i*=v,r*=v,h*=v,f=e(i,r,h))}if(f>=-l){var m=0>f?0:a(f),p=r+(0>r?-m:m);0===p?(g=h/i,d=-g):(g=p/i,d=h/p)}}var x=0,y=null==c,C=c-u,P=_+u;return isFinite(g)&&(y||g>C&&P>g)&&(o[x++]=y?g:t(g,c,_)),d!==g&&isFinite(d)&&(y||d>C&&P>d)&&(o[x++]=y?d:t(d,c,_)),x},solveCubic:function(e,i,r,o,c,_,g){function d(t){f=t;var n=e*f;v=n+i,m=v*f+r,p=(n+v)*f+m,x=m*f+o}var f,v,m,p,x,y=n(s(e),s(i),s(r),s(o));if(y&&(e*=y,i*=y,r*=y,o*=y),s(e)<u)e=i,v=r,m=o,f=1/0;else if(s(o)<u)v=i,m=r,f=0;else{d(-(i/e)/3);var C=x/e,P=h(s(C),1/3),w=0>C?-1:1,b=-p/e,S=b>0?1.324717957244746*Math.max(P,a(b)):P,I=f-w*S;if(I!==f){do d(I),I=0===p?f:f-x/p/(1+l);while(w*I>w*f);s(e)*f*f>s(o/f)&&(m=-o/f,v=(m-r)/f)}}var M=Numerical.solveQuadratic(e,v,m,c,_,g),B=null==_;return isFinite(f)&&(0===M||M>0&&f!==c[0]&&f!==c[1])&&(B||f>_-u&&g+u>f)&&(c[M++]=B?f:t(f,_,g)),M}}},UID={_id:1,_pools:{},get:function(t){if(t){var e=this._pools[t];return e||(e=this._pools[t]={_id:1}),e._id++}return this._id++}},Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var n=typeof t,i=this.__read,r=0;if("number"===n){var s="number"==typeof e;this._set(t,s?e:t),i&&(r=s?2:1)}else if("undefined"===n||null===t)this._set(0,0),i&&(r=null===t?1:0);else{var a="string"===n?t.split(/[\s,]+/)||[]:t;r=1,Array.isArray(a)?this._set(+a[0],+(a.length>1?a[1]:a[0])):"x"in a?this._set(a.x||0,a.y||0):"width"in a?this._set(a.width||0,a.height||0):"angle"in a?(this._set(a.length||0,0),this.setAngle(a.angle||0)):(this._set(0,0),r=0)}return i&&(this.__read=r),this},set:"#initialize",_set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new Point(this.x,this.y)},toString:function(){var t=Formatter.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this._set(Math.cos(e)*t,Math.sin(e)*t)}else{var n=t/this.getLength();Numerical.isZero(n)&&this.getAngle(),this._set(this.x*n,this.y*n)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var t=Point.read(arguments),e=this.getLength()*t.getLength();if(Numerical.isZero(e))return NaN;var n=this.dot(t)/e;return Math.acos(-1>n?-1:n>1?1:n)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this._set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=Point.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=Point.read(arguments),e=t.x-this.x,n=t.y-this.y,i=e*e+n*n,r=Base.read(arguments);return r?i:Math.sqrt(i)},normalize:function(t){void 0===t&&(t=1);var e=this.getLength(),n=0!==e?t/e:0,i=new Point(this.x*n,this.y*n);return n>=0&&(i._angle=this._angle),i},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var n=e?this.subtract(e):this,i=Math.sin(t),r=Math.cos(t);return n=new Point(n.x*r-n.y*i,n.x*i+n.y*r),e?n.add(e):n},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=Point.read(arguments);return new Point(this.x+t.x,this.y+t.y)},subtract:function(){var t=Point.read(arguments);return new Point(this.x-t.x,this.y-t.y)},multiply:function(){var t=Point.read(arguments);return new Point(this.x*t.x,this.y*t.y)},divide:function(){var t=Point.read(arguments);return new Point(this.x/t.x,this.y/t.y)},modulo:function(){var t=Point.read(arguments);return new Point(this.x%t.x,this.y%t.y)},negate:function(){return new Point(-this.x,-this.y)},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var t=Point.read(arguments),e=Base.read(arguments);return this.getDistance(t)<=e},isCollinear:function(){var t=Point.read(arguments);return Point.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var t=Point.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=Point.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=Point.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new Point(t.x*e,t.y*e)},statics:{min:function(){var t=Point.read(arguments),e=Point.read(arguments);return new Point(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=Point.read(arguments),e=Point.read(arguments);return new Point(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(t,e,n,i){return Math.abs(t*i-e*n)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))},isOrthogonal:function(t,e,n,i){return Math.abs(t*n+e*i)<=1e-8*Math.sqrt((t*t+e*e)*(n*n+i*i))}}},Base.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new Point(e(this.x),e(this.y))}},{})),Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(t,e,n,i){var r,s=typeof t;if("number"===s?(this._set(t,e,n,i),r=4):"undefined"===s||null===t?(this._set(0,0,0,0),r=null===t?1:0):1===arguments.length&&(Array.isArray(t)?(this._set.apply(this,t),r=1):void 0!==t.x||void 0!==t.width?(this._set(t.x||0,t.y||0,t.width||0,t.height||0),r=1):void 0===t.from&&void 0===t.to&&(this._set(0,0,0,0),Base.filter(this,t),r=1)),void 0===r){var a,h,o=Point.readNamed(arguments,"from"),u=Base.peek(arguments),l=o.x,c=o.y;if(u&&void 0!==u.x||Base.hasNamed(arguments,"to")){var _=Point.readNamed(arguments,"to");a=_.x-l,h=_.y-c,0>a&&(l=_.x,a=-a),0>h&&(c=_.y,h=-h)}else{var g=Size.read(arguments);a=g.width,h=g.height}this._set(l,c,a,h),r=arguments.__index}return this.__read&&(this.__read=r),this},set:"#initialize",_set:function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(t){var e=Base.isPlainValue(t)?Rectangle.read(arguments):t;return e===this||e&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height||!1},toString:function(){var t=Formatter.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){var e=t?Point:LinkedPoint;return new e(this.x,this.y,this,"setPoint")},setPoint:function(){var t=Point.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){var e=t?Size:LinkedSize;return new e(this.width,this.height,this,"setSize")},setSize:function(){var t=Size.read(arguments);this._fixX&&(this.x+=(this.width-t.width)*this._fixX),this._fixY&&(this.y+=(this.height-t.height)*this._fixY),this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){this._fixW||(this.width-=t-this.x),this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){this._fixH||(this.height-=t-this.y),this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(t){void 0!==this._fixX&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=t-this.width:this.width=t-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(t){void 0!==this._fixY&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=t-this.height:this.height=t-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){var e=t?Point:LinkedPoint;return new e(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=Point.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(t){return t&&void 0!==t.width||4===(Array.isArray(t)?t:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(t){var e=t.x,n=t.y;return e>=this.x&&n>=this.y&&e<=this.x+this.width&&n<=this.y+this.height},_containsRectangle:function(t){var e=t.x,n=t.y;return e>=this.x&&n>=this.y&&e+t.width<=this.x+this.width&&n+t.height<=this.y+this.height},intersects:function(){var t=Rectangle.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=Rectangle.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=Rectangle.read(arguments),e=Math.max(this.x,t.x),n=Math.max(this.y,t.y),i=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new Rectangle(e,n,i-e,r-n)},unite:function(){var t=Rectangle.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new Rectangle(e,n,i-e,r-n)},include:function(){var t=Point.read(arguments),e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new Rectangle(e,n,i-e,r-n)},expand:function(){var t=Size.read(arguments),e=t.width,n=t.height;return new Rectangle(this.x-e/2,this.y-n/2,this.width+e,this.height+n)},scale:function(t,e){return this.expand(this.width*t-this.width,this.height*(void 0===e?t:e)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var n=t.join(""),i=/^[RL]/.test(n);e>=4&&(t[1]+=i?"Y":"X");var r=t[i?0:1],s=t[i?1:0],a="get"+r,h="get"+s,o="set"+r,u="set"+s,l="get"+n,c="set"+n;this[l]=function(t){var e=t?Point:LinkedPoint;return new e(this[a](),this[h](),this,c)},this[c]=function(){var t=Point.read(arguments);this[o](t.x),this[u](t.y)}},{beans:!0})),LinkedRectangle=Rectangle.extend({initialize:function(t,e,n,i,r,s){this._set(t,e,n,i,!0),this._owner=r,this._setter=s},_set:function(t,e,n,i,r){return this._x=t,this._y=e,this._width=n,this._height=i,r||this._owner[this._setter](this),this}},new function(){var t=Rectangle.prototype;return Base.each(["x","y","width","height"],function(t){var e=Base.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var n="set"+e;this[n]=function(){this._dontNotify=!0,t[n].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(t){var e=this._owner;e.changeSelection&&e.changeSelection(2,t)}}))}),Matrix=Base.extend({_class:"Matrix",initialize:function i(t){var e=arguments.length,n=!0;if(6===e?this._set.apply(this,arguments):1===e?t instanceof i?this._set(t._a,t._b,t._c,t._d,t._tx,t._ty):Array.isArray(t)?this._set.apply(this,t):n=!1:e?n=!1:this.reset(),!n)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(t,e,n,i,r,s,a){return this._a=t,this._b=e,this._c=n,this._d=i,this._tx=r,this._ty=s,a||this._changed(),this},_serialize:function(t,e){return Base.serialize(this.getValues(),t,!0,e)},_changed:function(){var t=this._owner;t&&(t._applyMatrix?t.transform(null,!0):t._changed(9))},clone:function(){return new Matrix(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty},toString:function(){var t=Formatter.instance;return"[["+[t.number(this._a),t.number(this._c),t.number(this._tx)].join(", ")+"], ["+[t.number(this._b),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,t||this._changed(),this},apply:function(t,e){var n=this._owner;return n?(n.transform(null,!0,Base.pick(t,!0),e),this.isIdentity()):!1},translate:function(){var t=Point.read(arguments),e=t.x,n=t.y;return this._tx+=e*this._a+n*this._c,this._ty+=e*this._b+n*this._d,this._changed(),this},scale:function(){var t=Point.read(arguments),e=Point.read(arguments,0,{readNull:!0});return e&&this.translate(e),this._a*=t.x,this._b*=t.x,this._c*=t.y,this._d*=t.y,e&&this.translate(e.negate()),this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=Point.read(arguments,1),n=e.x,i=e.y,r=Math.cos(t),s=Math.sin(t),a=n-n*r+i*s,h=i-n*s-i*r,o=this._a,u=this._b,l=this._c,c=this._d;return this._a=r*o+s*l,this._b=r*u+s*c,this._c=-s*o+r*l,this._d=-s*u+r*c,this._tx+=a*o+h*l,this._ty+=a*u+h*c,this._changed(),this},shear:function(){var t=Point.read(arguments),e=Point.read(arguments,0,{readNull:!0});e&&this.translate(e);var n=this._a,i=this._b;return this._a+=t.y*this._c,this._b+=t.y*this._d,this._c+=t.x*n,this._d+=t.x*i,e&&this.translate(e.negate()),this._changed(),this},skew:function(){var t=Point.read(arguments),e=Point.read(arguments,0,{readNull:!0}),n=Math.PI/180,i=new Point(Math.tan(t.x*n),Math.tan(t.y*n));return this.shear(i,e)},append:function(t){if(t){var e=this._a,n=this._b,i=this._c,r=this._d,s=t._a,a=t._c,h=t._b,o=t._d,u=t._tx,l=t._ty;this._a=s*e+h*i,this._c=a*e+o*i,this._b=s*n+h*r,this._d=a*n+o*r,this._tx+=u*e+l*i,this._ty+=u*n+l*r,this._changed()}return this},prepend:function(t){if(t){var e=this._a,n=this._b,i=this._c,r=this._d,s=this._tx,a=this._ty,h=t._a,o=t._c,u=t._b,l=t._d,c=t._tx,_=t._ty;this._a=h*e+o*n,this._c=h*i+o*r,this._b=u*e+l*n,this._d=u*i+l*r,this._tx=h*s+o*a+c,this._ty=u*s+l*a+_,this._changed()}return this},appended:function(t){return this.clone().append(t)},prepended:function(t){return this.clone().prepend(t)},invert:function(){var t=this._a,e=this._b,n=this._c,i=this._d,r=this._tx,s=this._ty,a=t*i-e*n,h=null;return a&&!isNaN(a)&&isFinite(r)&&isFinite(s)&&(this._a=i/a,this._b=-e/a,this._c=-n/a,this._d=t/a,this._tx=(n*s-i*r)/a,this._ty=(e*r-t*s)/a,h=this),h},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new Matrix(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var t=this._a*this._d-this._c*this._b;return t&&!isNaN(t)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(t,e,n){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(t,e,n)},_transformPoint:function(t,e,n){var i=t.x,r=t.y;return e||(e=new Point),e._set(i*this._a+r*this._c+this._tx,i*this._b+r*this._d+this._ty,n)},_transformCoordinates:function(t,e,n){for(var i=0,r=2*n;r>i;i+=2){var s=t[i],a=t[i+1];e[i]=s*this._a+a*this._c+this._tx,e[i+1]=s*this._b+a*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,n=t.y,i=e+t.width,r=n+t.height,s=[e,n,i,n,i,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,n){for(var i=this._transformCorners(t),r=i.slice(0,2),s=r.slice(),a=2;8>a;a++){var h=i[a],o=1&a;h<r[o]?r[o]=h:h>s[o]&&(s[o]=h)}return e||(e=new Rectangle),e._set(r[0],r[1],s[0]-r[0],s[1]-r[1],n)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_inverseTransform:function(t,e,n){var i=this._a,r=this._b,s=this._c,a=this._d,h=this._tx,o=this._ty,u=i*a-r*s,l=null;if(u&&!isNaN(u)&&isFinite(h)&&isFinite(o)){var c=t.x-this._tx,_=t.y-this._ty;e||(e=new Point),l=e._set((c*a-_*s)/u,(_*i-c*r)/u,n)}return l},decompose:function(){var t,e,n,i=this._a,r=this._b,s=this._c,a=this._d,h=i*a-r*s,o=Math.sqrt,u=Math.atan2,l=180/Math.PI;if(0!==i||0!==r){var c=o(i*i+r*r);t=Math.acos(i/c)*(r>0?1:-1),e=[c,h/c],n=[u(i*s+r*a,c*c),0]}else if(0!==s||0!==a){var _=o(s*s+a*a);t=Math.asin(s/_)*(a>0?1:-1),e=[h/_,_],n=[0,u(i*s+r*a,_*_)]}else t=0,n=e=[0,0];return{translation:this.getTranslation(),rotation:t*l,scaling:new Point(e),skewing:new Point(n[0]*l,n[1]*l)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(t){this.isIdentity()||t.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},Base.each(["a","b","c","d","tx","ty"],function(t){var e=Base.capitalize(t),n="_"+t;this["get"+e]=function(){return this[n]},this["set"+e]=function(t){this[n]=t,this._changed()}},{})),Line=Base.extend({_class:"Line",initialize:function(t,e,n,i,r){var s=!1;arguments.length>=4?(this._px=t,this._py=e,this._vx=n,this._vy=i,s=r):(this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=n),s||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return Line.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return Line.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return Point.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return Point.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,n,i,r,s,a,h,o,u){o||(n-=t,i-=e,a-=r,h-=s);var l=n*h-i*a;if(!Numerical.isZero(l)){var c=t-r,_=e-s,g=(a*_-h*c)/l,d=(n*_-i*c)/l,f=1e-12,v=-f,m=1+f;if(u||g>v&&m>g&&d>v&&m>d)return u||(g=0>=g?0:g>=1?1:g),new Point(t+g*n,e+g*i)}},getSide:function(t,e,n,i,r,s,a,h){a||(n-=t,i-=e);var o=r-t,u=s-e,l=o*i-u*n;return 0!==l||h||(l=(o*n+o*n)/(n*n+i*i),l>=0&&1>=l&&(l=0)),0>l?-1:l>0?1:0},getSignedDistance:function(t,e,n,i,r,s,a){return a||(n-=t,i-=e),0===n?i>0?r-t:t-r:0===i?0>n?s-e:e-s:((r-t)*i-(s-e)*n)/Math.sqrt(n*n+i*i)}}}),Project=Base.extend(Emitter,{_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(t){this._children=[],this._namedChildren={},this._activeLayer=null,this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_changed:function(t,e){if(1&t){var n=this._view;n&&(n._needsUpdate=!0,!n._requested&&n._autoUpdate&&n.requestUpdate())}var i=this._changes;if(i&&e){var r=this._changesById,s=e._id,a=r[s];a?a.flags|=t:i.push(r[s]={item:e,flags:t})}},insertLayer:function(t,e){if(e instanceof Group){e._remove(!1,!0),Base.splice(this._children,[e],t,0),e._setProject(this,!0);var n=e._name;n&&e.setName(n),this._changes&&e._changed(5),this._activeLayer||(this._activeLayer=e)}else e=null;return e},_insertItem:function(t,e,n){return e=this.insertLayer(t,e)||(this._activeLayer||this._insertItem(void 0,new Group(Item.NO_INSERT),!0)).insertChild(t,e),n&&e.activate&&e.activate(),e}}),Item=Base.extend(Emitter,{statics:{extend:function r(t){return t._serializeFields&&(t._serializeFields=Base.set({},this.prototype._serializeFields,t._serializeFields)),r.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}}},new function(){var t=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return Base.each(t,function(t){this._events[t]={install:function(t){this.getView()._countItemEvent(t,1)},uninstall:function(t){this.getView()._countItemEvent(t,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:t}})},{initialize:function(){},_initialize:function(t,e){var n=t&&Base.isPlainObject(t),i=n&&t.internal===!0,r=this._matrix=new Matrix,s=n&&t.project||paper.project,a=paper.settings;return this._id=i?null:UID.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&a.applyMatrix,e&&r.translate(e),r._owner=this,i||n&&t.insert===!1||!a.insertItems&&(!n||t.insert!==!0)?this._setProject(s):(n&&t.parent||s)._insertItem(void 0,this,!0),n&&t!==Item.NO_INSERT&&Base.filter(this,t,{internal:!0,insert:!0,
project:!0,parent:!0}),n},_changed:function(t){var e=this._symbol,n=this._parent||e,i=this._project;8&t&&(this._bounds=this._position=this._decomposed=this._globalMatrix=void 0),n&&40&t&&Item._clearBoundsCache(n),2&t&&Item._clearBoundsCache(this),i&&i._changed(t,this),e&&e._changed(t)},set:function(t){return t&&this._set(t),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(t){if(this._name&&this._removeNamed(),t===+t+"")throw new Error("Names consisting only of numbers are not supported.");var e=this._getOwner();if(t&&e){var n=e._children,i=e._namedChildren;(i[t]=i[t]||[]).push(this),t in n||(n[t]=this)}this._name=t||void 0,this._changed(128)}},{beans:!0,getSelection:function(){return this._selection},setSelection:function(t){if(t!==this._selection){this._selection=t;var e=this._project;e&&(e._updateSelection(this),this._changed(129))}},changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,n=t.length;n>e;e++)if(t[e].isSelected())return!0;return!!(1&this._selection)},setSelected:function(t){if(this._selectChildren)for(var e=this._children,n=0,i=e.length;i>n;n++)e[n].setSelected(t);this.changeSelection(1,t)},isFullySelected:function(){var t=this._children,e=!!(1&this._selection);if(t&&e){for(var n=0,i=t.length;i>n;n++)if(!t[n].isFullySelected())return!1;return!0}return e},setFullySelected:function(t){var e=this._children;if(e)for(var n=0,i=e.length;i>n;n++)e[n].setFullySelected(t);this.changeSelection(1,t)},getData:function(){return this._data||(this._data={}),this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,n=t?Point:LinkedPoint;if(!e){var i=this._pivot;e=this._position=i?this._matrix._transformPoint(i):this.getBounds().getCenter(!0)}return new n(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var t=this._pivot;return t?new LinkedPoint(t.x,t.y,this,"setPivot"):null},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:!0,readNull:!0}),this._position=void 0}},Base.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(t,e){this[e]=function(e){return this.getBounds(e,t)}},{beans:!0,getBounds:function(t,e){var n=e||t instanceof Matrix,i=Base.set({},n?e:t,this._boundsOptions);(!i.stroke||this.getStrokeScaling())&&(i.cacheItem=this);var r=this._getCachedBounds(n&&t,i);return arguments.length?r:new LinkedRectangle(r.x,r.y,r.width,r.height,this,"setBounds")},setBounds:function(){var t=Rectangle.read(arguments),e=this.getBounds(),n=this._matrix,i=new Matrix,r=t.getCenter();i.translate(r),(t.width!=e.width||t.height!=e.height)&&(n.isInvertible()||(n.set(n._backup||(new Matrix).translate(n.getTranslation())),e=this.getBounds()),i.scale(0!==e.width?t.width/e.width:0,0!==e.height?t.height/e.height:0)),r=e.getCenter(),i.translate(-r.x,-r.y),this.transform(i)},_getBounds:function(t,e){var n=this._children;return n&&n.length?(Item._updateBoundsCache(this,e.cacheItem),Item._getBounds(n,t,e)):new Rectangle},_getCachedBounds:function(t,e){t=t&&t._orNullIfIdentity();var n=e.internal,i=e.cacheItem,r=n?null:this._matrix._orNullIfIdentity(),s=i&&(!t||t.equals(r))&&[e.stroke?1:0,e.handle?1:0,n?1:0].join("");if(Item._updateBoundsCache(this._parent||this._symbol,i),s&&this._bounds&&s in this._bounds)return this._bounds[s].rect.clone();var a=this._getBounds(t||r,e);if(s){this._bounds||(this._bounds={});this._bounds[s]={rect:a.clone(),internal:e.internal}}return a},_getStrokeMatrix:function(t,e){var n=this.getStrokeScaling()?null:e&&e.internal?this:this._parent||this._symbol&&this._symbol._item,i=n?n.getViewMatrix().invert():t;return i&&i._shiftless()},statics:{_updateBoundsCache:function(t,e){if(t&&e){var n=e._id,i=t._boundsCache=t._boundsCache||{ids:{},list:[]};i.ids[n]||(i.list.push(e),i.ids[n]=e)}},_clearBoundsCache:function(t){var e=t._boundsCache;if(e){t._bounds=t._position=t._boundsCache=void 0;for(var n=0,i=e.list,r=i.length;r>n;n++){var s=i[n];s!==t&&(s._bounds=s._position=void 0,s._boundsCache&&Item._clearBoundsCache(s))}}},_getBounds:function(t,e,n){var i=1/0,r=-i,s=i,a=r;n=n||{};for(var h=0,o=t.length;o>h;h++){var u=t[h];if(u._visible&&!u.isEmpty()){var l=u._getCachedBounds(e&&e.appended(u._matrix),n);i=Math.min(l.x,i),s=Math.min(l.y,s),r=Math.max(l.x+l.width,r),a=Math.max(l.y+l.height,a)}}return isFinite(i)?new Rectangle(i,s,r-i,a-s):new Rectangle}}}),{beans:!0,_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var t=this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();null!=e&&null!=t&&this.rotate(t-e)},getScaling:function(){var t=this._decompose(),e=t&&t.scaling;return e?new LinkedPoint(e.x,e.y,this,"setScaling"):void 0},setScaling:function(){var t=this.getScaling(),e=Point.read(arguments,0,{clone:!0,readNull:!0});t&&e&&this.scale(e.x/t.x,e.y/t.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;t.initialize.apply(t,arguments)},getGlobalMatrix:function(t){var e=this._globalMatrix,n=this._project._updateVersion;if(e&&e._updateVersion!==n&&(e=null),!e){e=this._globalMatrix=this._matrix.clone();var i=this._parent;i&&e.prepend(i.getGlobalMatrix(!0)),e._updateVersion=n}return t?e:e.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){(this._applyMatrix=this._canApplyMatrix&&!!t)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){this._project&&this._installEvents(!1),this._project=t;for(var n=this._children,i=0,r=n&&n.length;r>i;i++)n[i]._setProject(t);e=!0}e&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function s(t){s.base.call(this,t);for(var e=this._children,n=0,i=e&&e.length;i>n;n++)e[n]._installEvents(t)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof Layer)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var t=this._getOwner();return t&&t._children[this._index+1]||null},getPreviousSibling:function(){var t=this._getOwner();return t&&t._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return Base.equals(this._children,t._children)},clone:function(t){var e=new this.constructor(Item.NO_INSERT),n=this._children,i=Base.pick(t?t.insert:void 0,void 0===t||t===!0),r=Base.pick(t?t.deep:void 0,!0);n&&e.copyAttributes(this),(!n||r)&&e.copyContent(this),n||e.copyAttributes(this),i&&e.insertAbove(this);var s=this._name,a=this._parent;if(s&&a){for(var n=a._children,h=s,o=1;n[s];)s=h+" "+o++;s!==h&&e.setName(s)}return e},copyContent:function(t){for(var e=t._children,n=0,i=e&&e.length;i>n;n++)this.addChild(e[n].clone(!1),!0)},copyAttributes:function(t,e){for(var n=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],i=0,r=n.length;r>i;i++){var s=n[i];t.hasOwnProperty(s)&&(this[s]=t[s])}e||this._matrix.set(t._matrix),this.setApplyMatrix(t._applyMatrix),this.setPivot(t._pivot),this.setSelection(t._selection);var a=t._data,h=t._name;this._data=a?Base.clone(a):null,h&&this.setName(h)},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(t){var e=this._children;if(e){for(var n=e.length-1;n>=0;n--)if(e[n].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){return t instanceof Item?this._asPathItem().getIntersections(t._asPathItem(),null,e,!0).length>0:!1}},{addChild:function(t){return this.insertChild(void 0,t)},insertChild:function(t,e){var n=e?this.insertChildren(t,[e]):null;return n&&n[0]},addChildren:function(t){return this.insertChildren(this._children.length,t)},insertChildren:function(t,e){var n=this._children;if(n&&e&&e.length>0){e=Base.slice(e);for(var i=e.length-1;i>=0;i--){var r=e[i];r?r._remove(!1,!0):e.splice(i,1)}Base.splice(n,e,t,0);for(var s=this._project,a=s._changes,i=0,h=e.length;h>i;i++){var r=e[i],o=r._name;r._parent=this,r._setProject(s,!0),o&&r.setName(o),a&&this._changed(5)}this._changed(11)}else e=null;return e},_insertItem:"#insertChild",_insertAt:function(t,e){var n=this;if(n!==t){var i=t&&t._getOwner();i?(n._remove(!1,!0),i._insertItem(t._index+e,n)):n=null}return n},insertAbove:function(t){return this._insertAt(t,1)},insertBelow:function(t){return this._insertAt(t,0)},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(t){return t._insertItem(void 0,this.clone(!1))},reduce:function(t){var e=this._children;if(e&&1===e.length){var n=e[0].reduce(t);return this._parent?(n.insertAbove(this),this.remove()):n.remove(),n}return this},_removeNamed:function(){var t=this._getOwner();if(t){var e=t._children,n=t._namedChildren,i=this._name,r=n[i],s=r?r.indexOf(this):-1;-1!==s&&(e[i]==this&&delete e[i],r.splice(s,1),r.length?e[i]=r[0]:delete n[i])}},_remove:function(t,e){var n=this._getOwner(),i=this._project,r=this._index;return n?(null!=r&&(i._activeLayer===this&&(i._activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(n._children,null,r,1)),this._name&&this._removeNamed(),this._installEvents(!1),t&&i._changes&&this._changed(5),e&&n._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);return e&&this.remove(),e},removeChildren:function(t,e){if(!this._children)return null;t=t||0,e=Base.pick(e,this._children.length);for(var n=Base.splice(this._children,null,t,e-t),i=n.length-1;i>=0;i--)n[i]._remove(!0,!1);return n.length>0&&this._changed(11),n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;e>t;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){var t=this._children;return!t||!t.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},_getOrder:function(t){function e(t){var e=[];do e.unshift(t);while(t=t._parent);return e}for(var n=e(this),i=e(t),r=0,s=Math.min(n.length,i.length);s>r;r++)if(n[r]!=i[r])return n[r]._index<i[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e===t)return!0;return!1},isAncestor:function(t){return t?t.isDescendant(this):!1},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1}},Base.each(["rotate","scale","shear","skew"],function(t){var e="rotate"===t;this[t]=function(){var n=(e?Base:Point).read(arguments),i=Point.read(arguments,0,{readNull:!0});return this.transform((new Matrix)[t](n,i||this.getPosition(!0)))}},{translate:function(){var t=new Matrix;return this.transform(t.translate.apply(t,arguments))},transform:function(t,e,n,i){t&&t.isIdentity()&&(t=null);var r=this._matrix,s=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&n&&this._children);if(!t&&!s)return this;if(t&&(!t.isInvertible()&&r.isInvertible()&&(r._backup=r.getValues()),r.prepend(t)),s=s&&this._transformContent(r,n,i)){var a=this._pivot;a&&r._transformPoint(a,a,!0),fillColor&&fillColor.transform(r),strokeColor&&strokeColor.transform(r),r.reset(!0),i&&this._canApplyMatrix&&(this._applyMatrix=!0)}var h=this._bounds,o=this._position;this._changed(9);var u=h&&t&&t.decompose();if(u&&!u.shearing&&u.rotation%90===0){for(var l in h){var c=h[l];if(s||!c.internal){var _=c.rect;t._transformBounds(_,_)}}var g=this._boundsGetter,_=h[g&&g.getBounds||g||"getBounds"];_&&(this._position=_.getCenter(!0)),this._bounds=h}else t&&o&&(this._position=t._transformPoint(o,o));return this},_transformContent:function(t,e,n){var i=this._children;if(i){for(var r=0,s=i.length;s>r;r++)i[r].transform(t,!0,e,n);return!0}}})),Group=Item.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||this.addChildren(Array.isArray(t)?t:arguments)},_changed:function a(t){a.base.call(this,t),1026&t&&(this._clipItem=void 0)}}),Segment=Base.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(t,e,n,i,r,s){var a,h,o,u,l=arguments.length;l>0&&(null==t||"object"==typeof t?1===l&&t&&"point"in t?(a=t.point,h=t.handleIn,o=t.handleOut,u=t.selection):(a=t,h=e,o=n,u=i):(a=[t,e],h=void 0!==n?[n,i]:null,o=void 0!==r?[r,s]:null)),new SegmentPoint(a,this,"_point"),new SegmentPoint(h,this,"_handleIn"),new SegmentPoint(o,this,"_handleOut"),u&&this.setSelection(u)},_serialize:function(t,e){var n=this._point,i=this._selection,r=i||this.hasHandles()?[n,this._handleIn,this._handleOut]:n;return i&&r.push(i),Base.serialize(r,t,!0,e)},_changed:function(t){var e=this._path;if(e){var n,i=e._curves,r=this._index;i&&(t&&t!==this._point&&t!==this._handleIn||!(n=r>0?i[r-1]:e._closed?i[i.length-1]:null)||n._changed(),t&&t!==this._point&&t!==this._handleOut||!(n=i[r])||n._changed()),e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(Point.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(Point.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(Point.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(t){var e=this._selection,n=this._path;this._selection=t=t||0,n&&t!==e&&(n._updateSelection(this,e,t),n._changed(129))},changeSelection:function(t,e){var n=this._selection;this.setSelection(e?n|t:n&~t)},isSelected:function(){return!!(7&this._selection)},setSelected:function(t){this.changeSelection(7,t)},getIndex:function(){return void 0!==this._index?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;return t?(e>0&&!t._closed&&e===t._segments.length-1&&e--,t.getCurves()[e]||null):null},getLocation:function(){var t=this.getCurve();return t?new CurveLocation(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},smooth:function(t,e,n){var i=t||{},r=i.type,s=i.factor,a=this.getPrevious(),h=this.getNext(),o=(a||this)._point,u=this._point,l=(h||this)._point,c=o.getDistance(u),_=u.getDistance(l);if(r&&"catmull-rom"!==r){if("geometric"!==r)throw new Error("Smoothing method '"+r+"' not supported.");if(a&&h){var g=o.subtract(l),d=void 0===s?.4:s,f=d*c/(c+_);e||this.setHandleIn(g.multiply(f)),n||this.setHandleOut(g.multiply(f-d))}}else{var v=void 0===s?.5:s,m=Math.pow(c,v),p=m*m,x=Math.pow(_,v),y=x*x;if(!e&&a){var C=2*y+3*x*m+p,P=3*x*(x+m);this.setHandleIn(0!==P?new Point((y*o._x+C*u._x-p*l._x)/P-u._x,(y*o._y+C*u._y-p*l._y)/P-u._y):new Point)}if(!n&&h){var C=2*p+3*m*x+y,P=3*m*(m+x);this.setHandleOut(0!==P?new Point((p*l._x+C*u._x-y*o._x)/P-u._x,(p*l._y+C*u._y-y*o._y)/P-u._y):new Point)}}},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,n=t.clone();t.set(e),e.set(n)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},_transformCoordinates:function(t,e,n){var i=this._point,r=n&&this._handleIn.isZero()?null:this._handleIn,s=n&&this._handleOut.isZero()?null:this._handleOut,a=i._x,h=i._y,o=2;return e[0]=a,e[1]=h,r&&(e[o++]=r._x+a,e[o++]=r._y+h),s&&(e[o++]=s._x+a,e[o++]=s._y+h),t&&(t._transformCoordinates(e,e,o/2),a=e[0],h=e[1],n?(i._x=a,i._y=h,o=2,r&&(r._x=e[o++]-a,r._y=e[o++]-h),s&&(s._x=e[o++]-a,s._y=e[o++]-h)):(r||(e[o++]=a,e[o++]=h),s||(e[o++]=a,e[o++]=h))),e}}),SegmentPoint=Point.extend({initialize:function(t,e,n){var i,r,s;if(t)if(void 0!==(i=t[0]))r=t[1];else{var a=t;void 0===(i=a.x)&&(a=Point.read(arguments),i=a.x),r=a.y,s=a.selected}else i=r=0;this._x=i,this._y=r,this._owner=e,e[n]=this,s&&this.setSelected(!0)},_set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(t){this._owner.changeSelection(this._getSelection(),t)},_getSelection:function(){var t=this._owner;return this===t._point?1:this===t._handleIn?2:this===t._handleOut?4:0}}),Curve=Base.extend({_class:"Curve",initialize:function(t,e,n,i,r,s,a,h){var o,u,l,c,_,g,d=arguments.length;3===d?(this._path=t,o=e,u=n):d?1===d?"segment1"in t?(o=new Segment(t.segment1),u=new Segment(t.segment2)):"point1"in t?(l=t.point1,_=t.handle1,g=t.handle2,c=t.point2):Array.isArray(t)&&(l=[t[0],t[1]],c=[t[6],t[7]],_=[t[2]-t[0],t[3]-t[1]],g=[t[4]-t[6],t[5]-t[7]]):2===d?(o=new Segment(t),u=new Segment(e)):4===d?(l=t,_=e,g=n,c=i):8===d&&(l=[t,e],c=[a,h],_=[n-t,i-e],g=[r-a,s-h]):(o=new Segment,u=new Segment),this._segment1=o||new Segment(l,null,_),this._segment2=u||new Segment(c,g,null)},_serialize:function(t,e){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0,e)},_changed:function(){this._length=this._bounds=void 0},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||t.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||t.push("handle2: "+this._segment2._handleIn),t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},remove:function(){var t=!1;if(this._path){var e=this._segment2,n=e._handleOut;t=e.remove(),t&&this._segment1._handleOut.set(n)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(Point.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(Point.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(Point.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(Point.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return Curve.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],n=0;8>n;n+=2)e.push(new Point(t[n],t[n+1]));return e},getLength:function(){return null==this._length&&(this._length=Curve.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new Curve(Curve.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return Curve.getLength(this.getValues(),t,e)},getIntersections:function(t){return Curve._getIntersections(this.getValues(),t&&t!==this?t.getValues():null,this,t,[],{})},divideAt:function(t){return this.divideAtTime(t&&t.curve===this?t.time:t)},divideAtTime:function(t,e){var n=4e-7,i=1-n,r=null;if(t>=n&&i>=t){var s=Curve.subdivide(this.getValues(),t),a=s[0],h=s[1],o=e||this.hasHandles(),u=this._segment1,l=this._segment2,c=this._path;o&&(u._handleOut._set(a[2]-a[0],a[3]-a[1]),l._handleIn._set(h[4]-h[6],h[5]-h[7]));var _=a[6],g=a[7],d=new Segment(new Point(_,g),o&&new Point(a[4]-_,a[5]-g),o&&new Point(h[2]-_,h[3]-g));c?(c.insert(u._index+1,d),r=this.getNext()):(this._segment2=d,this._changed(),r=new Curve(d,l))}return r},splitAt:function(t){return this._path?this._path.splitAt(t):null},splitAtTime:function(t){return this.splitAt(this.getLocationAtTime(t))},divide:function(t,e){return this.divideAtTime(void 0===t?.5:e?t:this.getTimeAt(t))},split:function(t,e){return this.splitAtTime(void 0===t?.5:e?t:this.getTimeAt(t))},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(t,e,n){var i=t._point,r=t._handleOut,s=e._handleIn,a=e._point,h=[i._x,i._y,i._x+r._x,i._y+r._y,a._x+s._x,a._y+s._y,a._x,a._y];return n&&n._transformCoordinates(h,h,4),h},subdivide:function(t,e){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],h=t[5],o=t[6],u=t[7];void 0===e&&(e=.5);var l=1-e,c=l*n+e*r,_=l*i+e*s,g=l*r+e*a,d=l*s+e*h,f=l*a+e*o,v=l*h+e*u,m=l*c+e*g,p=l*_+e*d,x=l*g+e*f,y=l*d+e*v,C=l*m+e*x,P=l*p+e*y;return[[n,i,c,_,m,p,C,P],[C,P,x,y,f,v,o,u]]},getMonoCurves:function(t,e){var n=[],i=e?0:1,r=t[i],s=t[i+2],a=t[i+4],h=t[i+6];if(r>=s==s>=a&&s>=a==a>=h||Curve.isStraight(t))n.push(t);else{var o=3*(s-a)-r+h,u=2*(r+a)-4*s,l=s-r,c=4e-7,_=1-c,g=[],d=Numerical.solveQuadratic(o,u,l,g,c,_);if(d){g.sort();var f=g[0],v=Curve.subdivide(t,f);n.push(v[0]),d>1&&(f=(g[1]-f)/(1-f),v=Curve.subdivide(v[1],f),n.push(v[0])),n.push(v[1])}else n.push(t)}return n},solveCubic:function(t,e,n,i,r,s){var a=t[e],h=t[e+2],o=t[e+4],u=t[e+6],l=0;if(!(n>a&&n>u&&n>h&&n>o||a>n&&u>n&&h>n&&o>n)){var c=3*(h-a),_=3*(o-h)-c,g=u-a-c-_;l=Numerical.solveCubic(g,_,c,a-n,i,r,s)}return l},getTimeOf:function(t,e){var n=new Point(t[0],t[1]),i=new Point(t[6],t[7]),r=1e-12,s=e.isClose(n,r)?0:e.isClose(i,r)?1:null;if(null!==s)return s;for(var a=[e.x,e.y],h=[],o=1e-7,u=0;2>u;u++)for(var l=Curve.solveCubic(t,u,a[u],h,0,1),c=0;l>c;c++)if(s=h[c],e.isClose(Curve.getPoint(t,s),o))return s;return e.isClose(n,o)?0:e.isClose(i,o)?1:null},getNearestTime:function(t,e){function n(n){if(n>=0&&1>=n){var i=e.getDistance(Curve.getPoint(t,n),!0);if(_>i)return _=i,g=n,!0}}if(Curve.isStraight(t)){var i=t[0],r=t[1],s=t[6],a=t[7],h=s-i,o=a-r,u=h*h+o*o;if(0===u)return 0;var l=((e.x-i)*h+(e.y-r)*o)/u;return 1e-12>l?0:l>.999999999999?1:Curve.getTimeOf(t,new Point(i+l*h,r+l*o))}for(var c=100,_=1/0,g=0,d=0;c>=d;d++)n(d/c);for(var f=1/(2*c);f>4e-7;)n(g-f)||n(g+f)||(f/=2);return g},getPart:function(t,e,n){var i=e>n;if(i){var r=e;e=n,n=r}return e>0&&(t=Curve.subdivide(t,e)[1]),1>n&&(t=Curve.subdivide(t,(n-e)/(1-e))[0]),i?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},isFlatEnough:function(t,e){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],h=t[5],o=t[6],u=t[7],l=3*r-2*n-o,c=3*s-2*i-u,_=3*a-2*o-n,g=3*h-2*u-i;return Math.max(l*l,_*_)+Math.max(c*c,g*g)<=16*e*e},getArea:function(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],h=t[6],o=t[7];return 3*((o-n)*(i+s)-(h-e)*(r+a)+r*(e-s)-i*(n-a)+o*(s+e/3)-h*(a+n/3))/20},getBounds:function(t){for(var e=t.slice(0,2),n=e.slice(),i=[0,0],r=0;2>r;r++)Curve._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,n,i);return new Rectangle(e[0],e[1],n[0]-e[0],n[1]-e[1])},_addBounds:function(t,e,n,i,r,s,a,h,o){function u(t,e){var n=t-e,i=t+e;n<a[r]&&(a[r]=n),i>h[r]&&(h[r]=i)}s/=2;var l=a[r]-s,c=h[r]+s;if(l>t||l>e||l>n||l>i||t>c||e>c||n>c||i>c)if(t>e!=i>e&&t>n!=i>n)u(t,s),u(i,s);else{var _=3*(e-n)-t+i,g=2*(t+n)-4*e,d=e-t,f=Numerical.solveQuadratic(_,g,d,o),v=4e-7,m=1-v;u(i,0);for(var p=0;f>p;p++){var x=o[p],y=1-x;x>v&&m>x&&u(y*y*y*t+3*y*y*x*e+3*y*x*x*n+x*x*x*i,s)}}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds"],function(t){this[t]=function(){this._bounds||(this._bounds={});var e=this._bounds[t];return e||(e=this._bounds[t]=Path[t]([this._segment1,this._segment2],!1,this._path)),e.clone()}},{}),Base.each({isStraight:function(t,e,n){if(e.isZero()&&n.isZero())return!0;var i=t.getVector(),r=1e-7;if(i.isZero())return!1;if(t.getDistance(e)<r&&t.getDistance(n)<r){var s=i.dot(i),a=i.dot(e)/s,h=i.dot(n)/s;return a>=0&&1>=a&&0>=h&&h>=-1}return!1},isLinear:function(t,e,n){var i=t.getVector().divide(3);return e.equals(i)&&n.negate().equals(i)}},function(t,e){this[e]=function(){var e=this._segment1,n=this._segment2;return t(new Line(e._point,n._point),e._handleOut,n._handleIn)},this.statics[e]=function(e){var n=e[0],i=e[1],r=e[6],s=e[7];return t(new Line(n,i,r,s),new Point(e[2]-n,e[3]-i),new Point(e[4]-r,e[5]-s))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(t,e){return this.getLocationAtTime(e?t:this.getTimeAt(t))},getLocationAtTime:function(t){return null!=t&&t>=0&&1>=t?new CurveLocation(this,t):null},getTimeAt:function(t,e){return Curve.getTimeAt(this.getValues(),t,e)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(t){return this.getPartLength(0,t)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(Point.read(arguments)))},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getTimeOf:function(){return Curve.getTimeOf(this.getValues(),Point.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var t=Point.read(arguments),e=this.getValues(),n=Curve.getNearestTime(e,t),i=Curve.getPoint(e,n);return new CurveLocation(this,n,i,null,t.getDistance(i))},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(t,function(t){this[t+"At"]=function(e,n){var i=this.getValues();return Curve[t](i,n?e:Curve.getTimeAt(i,e))},this[t+"AtTime"]=function(e){return Curve[t](this.getValues(),e)}},{statics:{_evaluateMethods:t}})},new function(){function t(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],h=t[6],o=t[7],u=9*(i-s)+3*(h-e),l=6*(e+s)-12*i,c=3*(i-e),_=9*(r-a)+3*(o-n),g=6*(n+a)-12*r,d=3*(r-n);return function(t){var e=(u*t+l)*t+c,n=(_*t+g)*t+d;return Math.sqrt(e*e+n*n)}}function e(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,n,i){if(null==e||0>e||e>1)return null;var r=t[0],s=t[1],a=t[2],h=t[3],o=t[4],u=t[5],l=t[6],c=t[7],_=Numerical.isZero;_(a-r)&&_(h-s)&&(a=r,h=s),_(o-l)&&_(u-c)&&(o=l,u=c);var g,d,f=3*(a-r),v=3*(o-a)-f,m=l-r-f-v,p=3*(h-s),x=3*(u-h)-p,y=c-s-p-x;if(0===n)g=0===e?r:1===e?l:((m*e+v)*e+f)*e+r,d=0===e?s:1===e?c:((y*e+x)*e+p)*e+s;else{var C=4e-7,P=1-C;if(C>e?(g=f,d=p):e>P?(g=3*(l-o),d=3*(c-u)):(g=(3*m*e+2*v)*e+f,d=(3*y*e+2*x)*e+p),i){0===g&&0===d&&(C>e||e>P)&&(g=o-a,d=u-h);var w=Math.sqrt(g*g+d*d);w&&(g/=w,d/=w)}if(3===n){var b=6*m*e+2*v,S=6*y*e+2*x,I=Math.pow(g*g+d*d,1.5);g=0!==I?(g*S-d*b)/I:0,d=0}}return 2===n?new Point(d,-g):new Point(g,d)}return{statics:{getLength:function(n,i,r,s){if(void 0===i&&(i=0),void 0===r&&(r=1),Curve.isStraight(n)){var a=n;1>r&&(a=Curve.subdivide(a,r)[0],i/=r),i>0&&(a=Curve.subdivide(a,i)[1]);var h=a[6]-a[0],o=a[7]-a[1];return Math.sqrt(h*h+o*o)}return Numerical.integrate(s||t(n),i,r,e(i,r))},getTimeAt:function(n,i,r){function s(t){return f+=Numerical.integrate(c,r,t,e(r,t)),r=t,f-i}if(void 0===r&&(r=0>i?1:0),0===i)return r;var a=Math.abs,h=1e-12,o=i>0,u=o?r:0,l=o?1:r,c=t(n),_=Curve.getLength(n,u,l,c),g=a(i)-_;if(a(g)<h)return o?l:u;if(g>h)return null;var d=i/_,f=0;return Numerical.findRoot(s,c,r+d,u,l,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x}}}},new function(){function t(t,e,n,i,r,s,a,h,o,u,l){var c=!l&&e.excludeStart,_=!l&&e.excludeEnd,g=4e-7,d=1-g;if(null==r&&(r=Curve.getTimeOf(n,s)),null!==r&&r>=(c?g:0)&&(_?d:1)>=r&&(null==o&&(o=Curve.getTimeOf(a,u)),null!==o&&o>=(_?g:0)&&(c?d:1)>=o)){var f=e.renormalize;if(f){var v=f(r,o);r=v[0],o=v[1]}var m=new CurveLocation(i,r,s||Curve.getPoint(n,r),l),p=new CurveLocation(h,o,u||Curve.getPoint(a,o),l),x=m.getPath()===p.getPath()&&m.getIndex()>p.getIndex(),y=x?p:m,C=e.include;m._intersection=p,p._intersection=m,(!C||C(y))&&CurveLocation.insert(t,y,!0)}}function e(r,s,a,h,o,u,l,c,_,g,d,f,v){if(++f>=48||++v>4096)return v;var m,p,x=s[0],y=s[1],C=s[6],P=s[7],w=Line.getSignedDistance,b=w(x,y,C,P,s[2],s[3]),S=w(x,y,C,P,s[4],s[5]),I=b*S>0?.75:4/9,M=I*Math.min(0,b,S),B=I*Math.max(0,b,S),T=w(x,y,C,P,r[0],r[1]),L=w(x,y,C,P,r[2],r[3]),A=w(x,y,C,P,r[4],r[5]),O=w(x,y,C,P,r[6],r[7]),N=n(T,L,A,O),k=N[0],z=N[1];if(0===b&&0===S&&0===T&&0===L&&0===A&&0===O||null==(m=i(k,z,M,B))||null==(p=i(k.reverse(),z.reverse(),M,B)))return v;var R=l+(c-l)*m,E=l+(c-l)*p;if(Math.max(g-_,E-R)<1e-10){var j=(R+E)/2,F=(_+g)/2;r=a.getValues(),s=h.getValues(),t(o,u,d?s:r,d?h:a,d?F:j,null,d?r:s,d?a:h,d?j:F,null)}else if(r=Curve.getPart(r,m,p),p-m>.8)if(E-R>g-_){var H=Curve.subdivide(r,.5),j=(R+E)/2;v=e(s,H[0],h,a,o,u,_,g,R,j,!d,f,v),v=e(s,H[1],h,a,o,u,_,g,j,E,!d,f,v)}else{var H=Curve.subdivide(s,.5),F=(_+g)/2;v=e(H[0],r,h,a,o,u,_,F,R,E,!d,f,v),
v=e(H[1],r,h,a,o,u,F,g,R,E,!d,f,v)}else v=g-_>=1e-10?e(s,r,h,a,o,u,_,g,R,E,!d,f,v):e(r,s,a,h,o,u,R,E,_,g,d,f,v);return v}function n(t,e,n,i){var r,s=[0,t],a=[1/3,e],h=[2/3,n],o=[1,i],u=e-(2*t+i)/3,l=n-(t+2*i)/3;if(0>u*l)r=[[s,a,o],[s,h,o]];else{var c=u/l;r=[c>=2?[s,a,o]:.5>=c?[s,h,o]:[s,a,h,o],[s,o]]}return 0>(u||l)?r.reverse():r}function i(t,e,n,i){return t[0][1]<n?r(t,!0,n):e[0][1]>i?r(e,!1,i):t[0][0]}function r(t,e,n){for(var i=t[0][0],r=t[0][1],s=1,a=t.length;a>s;s++){var h=t[s][0],o=t[s][1];if(e?o>=n:n>=o)return o===n?h:i+(n-r)*(h-i)/(o-r);i=h,r=o}return null}function s(e,n,i,r,s,a){for(var h=Curve.isStraight(e),o=h?n:e,u=h?e:n,l=u[0],c=u[1],_=u[6],g=u[7],d=_-l,f=g-c,v=Math.atan2(-f,d),m=Math.sin(v),p=Math.cos(v),x=[],y=0;8>y;y+=2){var C=o[y]-l,P=o[y+1]-c;x.push(C*p-P*m,C*m+P*p)}for(var w=[],b=Curve.solveCubic(x,1,0,w,0,1),y=0;b>y;y++){var S=w[y],I=Curve.getPoint(o,S),M=Curve.getTimeOf(u,I);if(null!==M){var B=Curve.getPoint(u,M),T=h?M:S,L=h?S:M;(!a.excludeEnd||L>Numerical.CURVETIME_EPSILON)&&t(s,a,e,i,T,h?B:I,n,r,L,h?I:B)}}}function a(e,n,i,r,s,a){var h=Line.intersect(e[0],e[1],e[6],e[7],n[0],n[1],n[6],n[7]);h&&t(s,a,e,i,null,h,n,r,null,h)}return{statics:{_getIntersections:function(n,i,r,h,o,u){if(!i)return Curve._getSelfIntersection(n,r,o,u);var l=1e-7,c=n[0],_=n[1],g=n[6],d=n[7],f=i[0],v=i[1],m=i[6],p=i[7],x=(3*n[2]+c)/4,y=(3*n[3]+_)/4,C=(3*n[4]+g)/4,P=(3*n[5]+d)/4,w=(3*i[2]+f)/4,b=(3*i[3]+v)/4,S=(3*i[4]+m)/4,I=(3*i[5]+p)/4,M=Math.min,B=Math.max;if(!(B(c,x,C,g)+l>M(f,w,S,m)&&M(c,x,C,g)-l<B(f,w,S,m)&&B(_,y,P,d)+l>M(v,b,I,p)&&M(_,y,P,d)-l<B(v,b,I,p)))return o;var T=Curve.getOverlaps(n,i);if(T){for(var L=0;2>L;L++){var A=T[L];t(o,u,n,r,A[0],null,i,h,A[1],null,!0)}return o}var O=Curve.isStraight(n),N=Curve.isStraight(i),k=O&&N,z=o.length;if((k?a:O||N?s:e)(n,i,r,h,o,u,0,1,0,1,0,0,0),k&&o.length>z)return o;var R=new Point(c,_),E=new Point(g,d),j=new Point(f,v),F=new Point(m,p);return R.isClose(j,l)&&t(o,u,n,r,0,R,i,h,0,j),!u.excludeStart&&R.isClose(F,l)&&t(o,u,n,r,0,R,i,h,1,F),!u.excludeEnd&&E.isClose(j,l)&&t(o,u,n,r,1,E,i,h,0,j),E.isClose(F,l)&&t(o,u,n,r,1,E,i,h,1,F),o},_getSelfIntersection:function(t,e,n,i){var r=t[0],s=t[1],a=t[2],h=t[3],o=t[4],u=t[5],l=t[6],c=t[7],_=new Line(r,s,l,c,!1),g=_.getSide(new Point(a,h),!0),d=_.getSide(new Point(o,u),!0);if(g===d){var f=(r-o)*(h-c)+(a-l)*(u-s);if(f*g>0)return n}var v=l-3*o+3*a-r,m=o-2*a+r,p=a-r,x=c-3*u+3*h-s,y=u-2*h+s,C=h-s,P=x*p-v*C,w=x*m-v*y,b=y*p-m*C;if(0>P*P-4*w*b){var S,I=[],M=Numerical.solveCubic(v*v+x*x,3*(v*m+x*y),2*(m*m+y*y)+v*p+x*C,m*p+y*C,I,0,1);if(M>0){for(var B=0,T=0;M>B;B++){var L=Math.abs(e.getCurvatureAtTime(I[B]));L>T&&(T=L,S=I[B])}var A=Curve.subdivide(t,S);i.excludeEnd=!0,i.renormalize=function(t,e){return[t*S,e*(1-S)+S]},Curve._getIntersections(A[0],A[1],e,e,n,i)}}return n},getOverlaps:function(t,e){function n(t){var e=t[6]-t[0],n=t[7]-t[1];return e*e+n*n}var i=Math.abs,r=4e-7,s=1e-7,a=Curve.isStraight(t),h=Curve.isStraight(e),o=a&&h,u=n(t)<n(e),l=u?e:t,c=u?t:e,_=new Line(l[0],l[1],l[6],l[7]);if(_.getDistance(new Point(c[0],c[1]))<s&&_.getDistance(new Point(c[6],c[7]))<s)!o&&_.getDistance(new Point(l[2],l[3]))<s&&_.getDistance(new Point(l[4],l[5]))<s&&_.getDistance(new Point(c[2],c[3]))<s&&_.getDistance(new Point(c[4],c[5]))<s&&(a=h=o=!0);else if(o)return null;if(a^h)return null;for(var g=[t,e],d=[],f=0,v=0;2>f&&d.length<2;f+=0===v?0:1,v=1^v){var m=Curve.getTimeOf(g[1^f],new Point(g[f][0===v?0:6],g[f][0===v?1:7]));if(null!=m){var p=0===f?[v,m]:[m,v];(!d.length||i(p[0]-d[0][0])>r&&i(p[1]-d[0][1])>r)&&d.push(p)}if(1===f&&!d.length)break}if(2!==d.length)d=null;else if(!o){var x=Curve.getPart(t,d[0][0],d[1][0]),y=Curve.getPart(e,d[0][1],d[1][1]);(i(y[2]-x[2])>s||i(y[3]-x[3])>s||i(y[4]-x[4])>s||i(y[5]-x[5])>s)&&(d=null)}return d}}}}),CurveLocation=Base.extend({_class:"CurveLocation",beans:!0,initialize:function(t,e,n,i,r){if(e>.9999996){var s=t.getNext();s&&(e=0,t=s)}this._setCurve(t),this._time=e,this._point=n||t.getPointAtTime(e),this._overlap=i,this._distance=r,this._intersection=this._next=this._previous=null},_setCurve:function(t){var e=t._path;this._path=e,this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._time=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this.getCurve(),e=this._segment;if(!e){var n=this.getTime();0===n?e=t._segment1:1===n?e=t._segment2:null!=n&&(e=t.getPartLength(0,n)<t.getPartLength(n,1)?t._segment1:t._segment2),this._segment=e}return e},getCurve:function(){function t(t){var e=t&&t.getCurve();return e&&null!=(n._time=e.getTimeOf(n._point))?(n._setCurve(e),n._segment=t,e):void 0}var e=this._path,n=this;return e&&e._version!==this._version&&(this._time=this._curve=this._offset=null),this._curve||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getTime:function(){var t=this.getCurve(),e=this._time;return t&&null==e?this._time=t.getTimeOf(this._point):e},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),n=this.getIndex();if(e&&null!=n)for(var i=e.getCurves(),r=0;n>r;r++)t+=i[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this.getCurve(),e=this.getTime();return null!=e&&t&&t.getPartLength(0,e)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=null;return t&&(e=t.divideAtTime(this.getTime()),e&&this._setSegment(e._segment1)),e},split:function(){var t=this.getCurve();return t?t.splitAtTime(this.getTime()):null},equals:function(t,e){var n=this===t,i=1e-7;if(!n&&t instanceof CurveLocation&&this.getPath()===t.getPath()&&this.getPoint().isClose(t.getPoint(),i)){var r=this.getCurve(),s=t.getCurve(),a=Math.abs,h=a((r.isLast()&&s.isFirst()?-1:r.getIndex())+this.getTime()-((s.isLast()&&r.isFirst()?-1:s.getIndex())+t.getTime()));n=(4e-7>h||(h=a(this.getOffset()-t.getOffset()))<i||a(this.getPath().getLength()-h)<i)&&(e||!this._intersection&&!t._intersection||this._intersection&&this._intersection.equals(t._intersection,!0))}return n},toString:function(){var t=[],e=this.getPoint(),n=Formatter.instance;e&&t.push("point: "+e);var i=this.getIndex();null!=i&&t.push("index: "+i);var r=this.getTime();return null!=r&&t.push("time: "+n.number(r)),null!=this._distance&&t.push("distance: "+n.number(this._distance)),"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),n=t.getCurve();return!(e.isStraight()&&n.isStraight()&&e.getLine().intersect(n.getLine()))}return!1},isCrossing:function(){function t(t,e,n){return n>e?t>e&&n>t:t>e||n>t}var e=this._intersection;if(!e)return!1;var n=this.getTime(),i=e.getTime(),r=4e-7,s=1-r,a=n>r&&s>n,h=i>r&&s>i;if(a&&h)return!this.isTouching();var o=this.getCurve(),u=r>=n?o.getPrevious():o,l=e.getCurve(),c=r>=i?l.getPrevious():l;if(n>=s&&(o=o.getNext()),i>=s&&(l=l.getNext()),!(u&&o&&c&&l))return!1;var _=[];a||_.push(u.getLength(),o.getLength()),h||_.push(c.getLength(),l.getLength());var g=this.getPoint(),d=Math.min.apply(Math,_)/64,f=a?o.getTangentAtTime(n):o.getPointAt(d).subtract(g),v=a?f.negate():u.getPointAt(-d).subtract(g),m=h?l.getTangentAtTime(i):l.getPointAt(d).subtract(g),p=h?m.negate():c.getPointAt(-d).subtract(g),x=v.getAngle(),y=f.getAngle(),C=p.getAngle(),P=m.getAngle();return!!(a?t(x,C,P)^t(y,C,P)&&t(x,P,C)^t(y,P,C):t(C,x,y)^t(P,x,y)&&t(C,y,x)^t(P,y,x))},hasOverlap:function(){return!!this._overlap}},Base.each(Curve._evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getCurve(),n=this.getTime();return null!=n&&t&&t[e](n,!0)}},{preserve:!0}),new function(){function t(t,e,n){function i(n,i){for(var s=n+i;s>=-1&&r>=s;s+=i){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),1e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;a>=s;){var h,o=s+a>>>1,u=t[o];if(n&&(h=e.equals(u)?u:i(o,-1)||i(o,1)))return e._overlap&&(h._overlap=h._intersection._overlap=!0),h;var l=e.getPath(),c=u.getPath(),_=l!==c?l._id-c._id:e.getIndex()+e.getTime()-(u.getIndex()+u.getTime());0>_?a=o-1:s=o+1}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var n=e.slice(),i=e.length-1;i>=0;i--)t(n,e[i]._intersection,!1);return n}}}}),PathItem=Item.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,initialize:function(){},statics:{create:function(t){var e,n,i;if(Base.isPlainObject(t)?(n=t.segments,e=t.pathData):Array.isArray(t)?n=t:"string"==typeof t&&(e=t),n){var r=n[0];i=r&&Array.isArray(r[0])}else e&&(i=(e.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(e));var s=i?CompoundPath:Path;return new s(t)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(t){this.isClockwise()!=(t=!!t)&&this.reverse()},setPathData:function(t){function e(t,e){var n=+i[t];return h&&(n+=o[e]),n}function n(t){return new Point(e(t,"x"),e(t+1,"y"))}var i,r,s,a=t&&t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),h=!1,o=new Point,u=new Point;this.clear();for(var l=0,c=a&&a.length;c>l;l++){var _=a[l],g=_[0],d=g.toLowerCase();i=_.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var f=i&&i.length;switch(h=g===d,"z"!==r||/[mz]/.test(d)||this.moveTo(o),d){case"m":case"l":for(var v="m"===d,m=0;f>m;m+=2)this[!m&&v?"moveTo":"lineTo"](o=n(m));s=o,v&&(u=o);break;case"h":case"v":var p="h"===d?"x":"y";o=o.clone();for(var m=0;f>m;m++)o[p]=e(m,p),this.lineTo(o);s=o;break;case"c":for(var m=0;f>m;m+=6)this.cubicCurveTo(n(m),s=n(m+2),o=n(m+4));break;case"s":for(var m=0;f>m;m+=4)this.cubicCurveTo(/[cs]/.test(r)?o.multiply(2).subtract(s):o,s=n(m),o=n(m+2)),r=d;break;case"q":for(var m=0;f>m;m+=4)this.quadraticCurveTo(s=n(m),o=n(m+2));break;case"t":for(var m=0;f>m;m+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?o.multiply(2).subtract(s):o,o=n(m)),r=d;break;case"a":for(var m=0;f>m;m+=7)this.arcTo(o=n(m+5),new Size(+i[m],+i[m+1]),+i[m+2],+i[m+4],+i[m+3]);break;case"z":this.closePath(1e-12),o=u}r=d}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=t.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(t):{};return!!("evenodd"===this.getFillRule()?1&e.windingL||1&e.windingR:e.winding)},getIntersections:function(t,e,n,i){var r=this===t||!t,s=this._matrix._orNullIfIdentity(),a=r?s:(n||t._matrix)._orNullIfIdentity();if(!r&&!this.getBounds(s).touches(t.getBounds(a)))return[];for(var h,t,o=this.getCurves(),u=r?o:t.getCurves(),l=o.length,c=r?l:u.length,_=[],g=[],d=0;c>d;d++)_[d]=u[d].getValues(a);for(var d=0;l>d;d++){var f=o[d],v=r?_[d]:f.getValues(s),m=f.getPath();m!==t&&(t=m,h=[],g.push(h)),r&&Curve._getSelfIntersection(v,f,h,{include:e,excludeStart:1===l&&f.getPoint1().equals(f.getPoint2())});for(var p=r?d+1:0;c>p;p++){if(i&&h.length)return h;var x=u[p];Curve._getIntersections(v,_[p],f,x,h,{include:e,excludeStart:r&&f.getPrevious()===x,excludeEnd:r&&f.getNext()===x})}}h=[];for(var d=0,y=g.length;y>d;d++)h.push.apply(h,g[d]);return h},getCrossings:function(t){return this.getIntersections(t,function(t){return t._overlap||t.isCrossing()})},getNearestLocation:function(){for(var t=Point.read(arguments),e=this.getCurves(),n=1/0,i=null,r=0,s=e.length;s>r;r++){var a=e[r].getNearestLocation(t);a._distance<n&&(n=a._distance,i=a)}return i},getNearestPoint:function(){var t=this.getNearestLocation.apply(this,arguments);return t?t.getPoint():t},interpolate:function(t,e,n){var i=!this._children,r=i?"_segments":"_children",s=t[r],a=e[r],h=this[r];if(!s||!a||s.length!==a.length)throw new Error("Invalid operands in interpolate() call: "+t+", "+e);var o=h.length,u=a.length;if(u>o)for(var l=i?Segment:Path,c=o;u>c;c++)this.add(new l);else o>u&&this[i?"removeSegments":"removeChildren"](u,o);for(var c=0;u>c;c++)h[c].interpolate(s[c],a[c],n);i&&(this.setClosed(t._closed),this._changed(9))},compare:function(t){var e=!1;if(t){var n,i=this._children||[this],r=t._children.slice()||[t],s=i.length,a=r.length,h=[];e=!0;for(var o=s-1;o>=0&&e;o--){var u=i[o];e=!1;for(var l=a-1;l>=0&&!e;l--)u.compare(r[l])&&(h[l]||(h[l]=!0,n++),e=!0)}e=e&&n===a}return e}}),Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(t){this._closed=!1,this._segments=[],this._version=0;var e=Array.isArray(t)?"object"==typeof t[0]?t:arguments:!t||void 0!==t.size||void 0===t.x&&void 0===t.point?null:arguments;e&&e.length>0?this.setSegments(e):(this._curves=void 0,this._segmentSelection=0,e||"string"!=typeof t||(this.setPathData(t),t=null)),this._initialize(!e&&t)},_equals:function(t){return this._closed===t._closed&&Base.equals(this._segments,t._segments)},copyContent:function(t){this.setSegments(t._segments),this._closed=t._closed},_changed:function h(t){if(h.base.call(this,t),8&t){if(this._length=this._area=void 0,16&t)this._version++;else if(this._curves)for(var e=0,n=this._curves.length;n>e;e++)this._curves[e]._changed()}else 32&t&&(this._bounds=void 0)},getStyle:function(){var t=this._parent;return(t instanceof CompoundPath?t:this)._style},getSegments:function(){return this._segments},setSegments:function(t){var e=this.isFullySelected(),n=t&&t.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=void 0,n){var i=t[n-1];"boolean"==typeof i&&(this.setClosed(i),n--),this._add(Segment.readList(t,0,{},n))}e&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var n=this._countCurves();t=this._curves=new Array(n);for(var i=0;n>i;i++)t[i]=new Curve(this,e[i],e[i+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();t&&(this._curves[e-1]=new Curve(this,this._segments[e-1],this._segments[0]))}this._changed(25)}},getFillRule:function(){return"nonzero"}},{beans:!0,getPathData:function(t,e){function n(e,n){if(e._transformCoordinates(t,d),i=d[0],r=d[1],f)v.push("M"+g.pair(i,r)),f=!1;else if(h=d[2],o=d[3],h===i&&o===r&&u===s&&l===a){if(!n){var c=i-s,_=r-a;v.push(0===c?"v"+g.number(_):0===_?"h"+g.number(c):"l"+g.pair(c,_))}}else v.push("c"+g.pair(u-s,l-a)+" "+g.pair(h-s,o-a)+" "+g.pair(i-s,r-a));s=i,a=r,u=d[4],l=d[5]}var i,r,s,a,h,o,u,l,c=this._segments,_=c.length,g=new Formatter(e),d=new Array(6),f=!0,v=[];if(!_)return"";for(var m=0;_>m;m++)n(c[m]);return this._closed&&_>0&&(n(c[0],!0),v.push("z")),v.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(t){for(var e=this._segments,n=new Array(6),i=0,r=e.length;r>i;i++)e[i]._transformCoordinates(t,n,!0);return!0},_add:function(t,e){for(var n=this._segments,i=this._curves,r=t.length,s=null==e,e=s?n.length:e,a=0;r>a;a++){var h=t[a];h._path&&(h=t[a]=h.clone()),h._path=this,h._index=e+a,h._selection&&this._updateSelection(h,0,h._selection)}if(s)n.push.apply(n,t);else{n.splice.apply(n,[e,0].concat(t));for(var a=e+r,o=n.length;o>a;a++)n[a]._index=a}if(i){var u=this._countCurves(),l=e>0&&e+r-1===u?e-1:e,c=l,_=Math.min(l+r,u);t._curves&&(i.splice.apply(i,[l,0].concat(t._curves)),c+=t._curves.length);for(var a=c;_>a;a++)i.splice(a,0,new Curve(this,null,null));this._adjustCurves(l,_)}return this._changed(25),t},_adjustCurves:function(t,e){for(var n,i=this._segments,r=this._curves,s=t;e>s;s++)n=r[s],n._path=this,n._segment1=i[s],n._segment2=i[s+1]||i[0],n._changed();(n=r[this._closed&&!t?i.length-1:t-1])&&(n._segment2=i[t]||i[0],n._changed()),(n=r[e])&&(n._segment1=i[e],n._changed())},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(Segment.readList(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(Segment.readList(arguments,1),t):this._add([Segment.read(arguments,1)],t)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(t){return this._add([Segment.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(Segment.readList(t))},insertSegments:function(t,e){return this._add(Segment.readList(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,e,n){t=t||0,e=Base.pick(e,this._segments.length);var i=this._segments,r=this._curves,s=i.length,a=i.splice(t,e-t),h=a.length;if(!h)return a;for(var o=0;h>o;o++){var u=a[o];u._selection&&this._updateSelection(u,u._selection,0),u._index=u._path=null}for(var o=t,l=i.length;l>o;o++)i[o]._index=o;if(r){for(var c=t>0&&e===s+(this._closed?1:0)?t-1:t,r=r.splice(c,h),o=r.length-1;o>=0;o--)r[o]._path=null;n&&(a._curves=r.slice(1)),this._adjustCurves(c,c)}return this._changed(25),a},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,n=t.length;n>e;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,n=t.length;n>e;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,n=0,i=t.length;i>n;n++)e+=t[n].getLength();this._length=e}return this._length},getArea:function(t){var e=void 0===t,n=this._area;if(!e||null==n){var i=this._segments,r=i.length,s=e?this._closed:t,a=r-1;n=0;for(var h=0,o=s?r:a;o>h;h++)n+=Curve.getArea(Curve.getValues(i[h],i[a>h?h+1:0]));e&&(this._area=n)}return n},isFullySelected:function(){var t=this._segments.length;return this.isSelected()&&t>0&&this._segmentSelection===7*t},setFullySelected:function(t){t&&this._selectSegments(!0),this.setSelected(t)},setSelection:function o(t){1&t||this._selectSegments(!1),o.base.call(this,t)},_selectSegments:function(t){var e=this._segments,n=e.length,i=t?7:0;this._segmentSelection=i*n;for(var r=0;n>r;r++)e[r]._selection=i},_updateSelection:function(t,e,n){t._selection=n;var i=this._segmentSelection+=n-e;i>0&&this.setSelected(!0)},splitAt:function(t){var e="number"==typeof t?this.getLocationAt(t):t,n=e&&e.index,i=e&&e.time,r=4e-7,s=1-r;i>=s&&(n++,i=0);var a=this.getCurves();if(n>=0&&n<a.length){i>=r&&a[n++].divideAtTime(i);var h,o=this.removeSegments(n,this._segments.length,!0);return this._closed?(this.setClosed(!1),h=this):(h=new Path(Item.NO_INSERT),h.insertAbove(this),h.copyAttributes(this)),h._add(o,0),this.addSegment(o[0]),h}return null},split:function(t,e){var n,i=void 0===e?t:(n=this.getCurves()[t])&&n.getLocationAtTime(e);return null!=i?this.splitAt(i):null},join:function(t,e){var n=e||0;if(t&&t!==this){var i=t._segments,r=this.getLastSegment(),s=t.getLastSegment();if(!s)return this;r&&r._point.isClose(s._point,n)&&t.reverse();var a=t.getFirstSegment();if(r&&r._point.isClose(a._point,n))r.setHandleOut(a._handleOut),this._add(i.slice(1));else{var h=this.getFirstSegment();h&&h._point.isClose(a._point,n)&&t.reverse(),s=t.getLastSegment(),h&&h._point.isClose(s._point,n)?(h.setHandleIn(s._handleIn),this._add(i.slice(0,i.length-1),0)):this._add(i.slice())}t._closed&&this._add([i[0]]),t.remove()}var o=this.getFirstSegment(),u=this.getLastSegment();return o!==u&&o._point.isClose(u._point,n)&&(o.setHandleIn(u._handleIn),u.remove(),this.setClosed(!0)),this},reduce:function(t){for(var e=this.getCurves(),n=t&&t.simplify,i=n?1e-7:0,r=e.length-1;r>=0;r--){var s=e[r];!s.hasHandles()&&(s.getLength()<i||n&&s.isCollinear(s.getNext()))&&s.remove()}return this},reverse:function(){this._segments.reverse();for(var t=0,e=this._segments.length;e>t;t++){var n=this._segments[t],i=n._handleIn;n._handleIn=n._handleOut,n._handleOut=i,n._index=t}this._curves=null,this._changed(9)},toPath:"#clone"},new function(){function t(t){var e=t._segments;if(!e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;1===t.length&&this.removeSegment(0),t.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var e=Point.read(arguments),n=Point.read(arguments),i=Point.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new Segment(i,n.subtract(i))])},quadraticCurveTo:function(){var e=Point.read(arguments),n=Point.read(arguments),i=t(this)._point;this.cubicCurveTo(e.add(i.subtract(e).multiply(1/3)),e.add(n.subtract(e).multiply(1/3)),n)},curveTo:function(){var e=Point.read(arguments),n=Point.read(arguments),i=Base.pick(Base.read(arguments),.5),r=1-i,s=t(this)._point,a=e.subtract(s.multiply(r*r)).subtract(n.multiply(i*i)).divide(2*i*r);if(a.isNaN())throw new Error("Cannot put a curve through points with parameter = "+i);this.quadraticCurveTo(a,n)},arcTo:function(){var e,n,i,r,s,a=t(this),h=a._point,o=Point.read(arguments),u=Base.peek(arguments),l=Base.pick(u,!0);if("boolean"==typeof l)var c=h.add(o).divide(2),e=c.add(c.subtract(h).rotate(l?-90:90));else if(Base.remain(arguments)<=2)e=o,o=Point.read(arguments);else{var _=Size.read(arguments),g=Numerical.isZero;if(g(_.width)||g(_.height))return this.lineTo(o);var d=Base.read(arguments),l=!!Base.read(arguments),f=!!Base.read(arguments),c=h.add(o).divide(2),v=h.subtract(c).rotate(-d),m=v.x,p=v.y,x=Math.abs,y=x(_.width),C=x(_.height),P=y*y,w=C*C,b=m*m,S=p*p,I=Math.sqrt(b/P+S/w);if(I>1&&(y*=I,C*=I,P=y*y,w=C*C),I=(P*w-P*S-w*b)/(P*S+w*b),x(I)<1e-12&&(I=0),0>I)throw new Error("Cannot create an arc with the given arguments");n=new Point(y*p/C,-C*m/y).multiply((f===l?-1:1)*Math.sqrt(I)).rotate(d).add(c),s=(new Matrix).translate(n).rotate(d).scale(y,C),r=s._inverseTransform(h),i=r.getDirectedAngle(s._inverseTransform(o)),!l&&i>0?i-=360:l&&0>i&&(i+=360)}if(e){var M=new Line(h.add(e).divide(2),e.subtract(h).rotate(90),!0),B=new Line(e.add(o).divide(2),o.subtract(e).rotate(90),!0),T=new Line(h,o),L=T.getSide(e);if(n=M.intersect(B,!0),!n){if(!L)return this.lineTo(o);throw new Error("Cannot create an arc with the given arguments")}r=h.subtract(n),i=r.getDirectedAngle(o.subtract(n));var A=T.getSide(n);0===A?i=L*Math.abs(i):L===A&&(i+=0>i?360:-360)}for(var O=Math.abs(i),N=O>=360?4:Math.ceil(O/90),k=i/N,z=k*Math.PI/360,R=4/3*Math.sin(z)/(1+Math.cos(z)),E=[],j=0;N>=j;j++){var v=o,F=null;if(N>j&&(F=r.rotate(90).multiply(R),s?(v=s._transformPoint(r),F=s._transformPoint(r.add(F)).subtract(v)):v=n.add(r)),j){var H=r.rotate(-90).multiply(R);s&&(H=s._transformPoint(r.add(H)).subtract(v)),E.push(new Segment(v,H,F))}else a.setHandleOut(F);r=r.rotate(k)}this._add(E)},lineBy:function(){var e=Point.read(arguments),n=t(this)._point;this.lineTo(n.add(e))},curveBy:function(){var e=Point.read(arguments),n=Point.read(arguments),i=Base.read(arguments),r=t(this)._point;this.curveTo(r.add(e),r.add(n),i)},cubicCurveBy:function(){var e=Point.read(arguments),n=Point.read(arguments),i=Point.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(n),r.add(i))},quadraticCurveBy:function(){var e=Point.read(arguments),n=Point.read(arguments),i=t(this)._point;this.quadraticCurveTo(i.add(e),i.add(n))},arcBy:function(){var e=t(this)._point,n=e.add(Point.read(arguments)),i=Base.pick(Base.peek(arguments),!0);"boolean"==typeof i?this.arcTo(n,i):this.arcTo(n,e.add(Point.read(arguments)))},closePath:function(t){this.setClosed(!0),this.join(this,t)}}}),CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(t){this._children=[],this._namedChildren={},this._initialize(t)||("string"==typeof t?this.setPathData(t):this.addChildren(Array.isArray(t)?t:arguments))},insertChildren:function u(t,e){var n=e,i=n[0];i&&"number"==typeof i[0]&&(n=[n]);for(var r=e.length-1;r>=0;r--){var s=n[r];n!==e||s instanceof Path||(n=Base.slice(n)),Array.isArray(s)?n[r]=new Path({segments:s,insert:!1}):s instanceof CompoundPath&&(n.splice.apply(n,[r,1].concat(s.removeChildren())),s.remove())}return u.base.call(this,t,n)},reduce:function l(t){for(var e=this._children,n=e.length-1;n>=0;n--){var i=e[n].reduce(t);i.isEmpty()&&i.remove()}if(!e.length){var i=new Path(Item.NO_INSERT);return i.copyAttributes(this),i.insertAbove(this),this.remove(),i}return l.base.call(this)},isClosed:function(){for(var t=this._children,e=0,n=t.length;n>e;e++)if(!t[e]._closed)return!1;return!0},setClosed:function(t){for(var e=this._children,n=0,i=e.length;i>n;n++)e[n].setClosed(t)},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],n=0,i=t.length;i>n;n++)e.push.apply(e,t[n].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getLastCurve()},getArea:function(){for(var t=this._children,e=0,n=0,i=t.length;i>n;n++)e+=t[n].getArea();return e},getLength:function(){for(var t=this._children,e=0,n=0,i=t.length;i>n;n++)e+=t[n].getLength();return e}},{beans:!0,getPathData:function(t,e){for(var n=this._children,i=[],r=0,s=n.length;s>r;r++){var a=n[r],h=a._matrix;i.push(a.getPathData(t&&!h.isIdentity()?t.appended(h):t,e))}return i.join("")}},{_hitTestChildren:function c(t,e,n){return c.base.call(this,t,e["class"]===Path||"path"===e.type?e:Base.set({},e,{fill:!1}),n)},_draw:function(t,e,n,i){var r=this._children;if(r.length){e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var s=0,a=r.length;a>s;s++)r[s].draw(t,e,i);if(!e.clip){this._setStyles(t,e,n);var h=this._style;h.hasFill()&&(t.fill(h.getFillRule()),t.shadowColor="rgba(0,0,0,0)"),h.hasStroke()&&t.stroke()}}},_drawSelected:function(t,e,n){for(var i=this._children,r=0,s=i.length;s>r;r++){var a=i[r],h=a._matrix;n[a._id]||a._drawSelected(t,h.isIdentity()?e:e.appended(h))}}},new function(){function t(t,e){var n=t._children;if(e&&!n.length)throw new Error("Use a moveTo() command first");return n[n.length-1]}return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){this[e]=function(){var n=t(this,!0);n[e].apply(n,arguments)}},{moveTo:function(){var e=t(this),n=e&&e.isEmpty()?e:new Path(Item.NO_INSERT);n!==e&&this.addChild(n),n.moveTo.apply(n,arguments)},moveBy:function(){var e=t(this,!0),n=e&&e.getLastSegment(),i=Point.read(arguments);this.moveTo(n?i.add(n._point):i)},closePath:function(e){t(this,!0).closePath(e)}})},Base.each(["reverse","flatten","simplify","smooth"],function(t){this[t]=function(e){for(var n,i=this._children,r=0,s=i.length;s>r;r++)n=i[r][t](e)||n;return n}},{}));PathItem.inject(new function(){function t(t,e){var n=t.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return e&&n.setClosed(!0),e?n.resolveCrossings().reorient("nonzero"===n.getFillRule()):n}function e(t,e,n,i,r){var s=new t(Item.NO_INSERT);return s.addChildren(e,!0),n&&(s=s.reduce({simplify:!0})),s.insertAbove(r&&i.isSibling(r)&&i.getIndex()<r.getIndex()?r:i),s.copyAttributes(i,!0),s}function n(n,r,a){function u(t){for(var e=0,n=t.length;n>e;e++){var i=t[e];p.push.apply(p,i._segments),x.push.apply(x,i.getCurves()),i._overlapsOnly=i._validOverlapsOnly=!0}}var l=_[a];if(l[a]=!0,!n.isClosed())return i(n,r,l);var c=t(n,!0),g=r&&n!==r&&t(r,!0);g&&(l.subtract||l.exclude)^(g.isClockwise()^c.isClockwise())&&g.reverse();var d,f=s(CurveLocation.expand(c.getCrossings(g))),v=c._children||[c],m=g&&(g._children||[g]),p=[],x=[];if(!f.length){var y=!0;if(m)for(var C=0,P=v.length;P>C&&y;C++)for(var w=v[C].getBounds(),b=0,S=m.length;S>b&&y;b++){var I=m[b].getBounds();y=!w._containsRectangle(I)&&!I._containsRectangle(w)}y&&(d=l.unite||l.exclude?[c,g]:l.subtract?[c]:l.intersect?[new Path(Item.NO_INSERT)]:null)}if(!d){u(v),m&&u(m);for(var M=0,B=f.length;B>M;M++)h(f[M]._segment,c,g,x,l);for(var M=0,B=p.length;B>M;M++){var T=p[M],L=T._intersection;if(null==T._winding&&h(T,c,g,x,l),!L||!L._overlap){var A=T._path;A._overlapsOnly=!1,l[T._winding.winding]&&(A._validOverlapsOnly=!1)}}d=o(p,l)}return e(CompoundPath,d,!0,n,r)}function i(n,i,r){function s(t){return h.contains(t.getPointAt(t.getLength()/2))^u?(l.unshift(t),!0):void 0}if(!i||!r.subtract&&!r.intersect)throw new Error("Boolean operations on open paths only support subtraction and intersection with another path.");for(var a=t(n,!1),h=t(i,!1),o=a.getCrossings(h),u=r.subtract,l=[],c=o.length-1;c>=0;c--){var _=o[c].split();_&&(s(_)&&_.getFirstSegment().setHandleIn(0,0),a.getLastSegment().setHandleOut(0,0))}return s(a),e(Group,l,!1,n,i)}function r(t,e){for(var n=t;n;){if(n===e)return;n=n._previous}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._previous;)e=e._previous;t._next=e,e._previous=t}}function s(t,e){for(var n,i,s=e&&[],a=4e-7,h=1-a,o=!1,u=[],l=t.length-1;l>=0;l--){var c=t[l];if(e){if(!e(c))continue;s.unshift(c)}var _,g=c._curve,d=c._time,f=d;if(g!==n?o=!g.hasHandles():i>=a&&h>=i&&(d/=i),a>d)_=g._segment1;else if(d>h)_=g._segment2;else{var v=g.divideAtTime(d,!0);o&&u.push(g,v),_=v._segment1}c._setSegment(_);var m=_._intersection,p=c._intersection;if(m){r(m,p);for(var x=m;x;)r(x._intersection,m),x=x._next}else _._intersection=p;n=g,i=f}for(var l=0,y=u.length;y>l;l++)u[l].clearHandles();return s||t}function a(t,e,n,i){function r(r){var s=r[f],o=r[f+6];if(s>p&&o>p||p>s&&p>o)return r;var c=r[d],g=r[d+2],v=r[d+4],m=r[d+6];if(s===o)return(y>g&&m>x||y>m&&g>x)&&(M=!0),h;var C=null,P=p===s?c:p===o?m:x>l(c,g,v,m)||y<u(c,g,v,m)?(c+m)/2:1===Curve.solveCubic(r,f,p,B,0,1)?Curve.getPoint(r,C=B[0])[n?"y":"x"]:(c+m)/2,S=s>o?1:-1,I=h[f]>h[f+6]?1:-1,T=h[d+6];return p!==s?x>P?w+=S:P>y?b+=S:(M=!0,w+=S,b+=S):S!==I?(y>T&&(w+=S),T>x&&(b+=S)):(x>T&&P>x||T>y&&y>P)&&(M=!0,x>T?b+=S:T>y&&(w+=S)),M&&!i&&(C=p===s?0:p===o?1:C,_=null!==C&&0===Curve.getTangent(r,C)[n?"x":"y"]&&a(t,e,n?0:1,!0)),r}function s(t){var e=t[f],i=t[f+2],s=t[f+4],a=t[f+6];if(p<=l(e,i,s,a)&&p>=u(e,i,s,a))for(var o=t[d],c=t[d+2],g=t[d+4],v=t[d+6],m=x>l(o,c,g,v)||y<u(o,c,g,v)?[t]:Curve.getMonoCurves(t,n),C=0,P=m.length;!_&&P>C;C++)h=r(m[C])}for(var h,o,_,g=1e-8,d=n?1:0,f=n?0:1,v=[t.x,t.y],m=v[d],p=v[f],x=m-g,y=m+g,C=0,P=0,w=0,b=0,S=0,I=0,M=!1,B=[],T=0,L=e.length;!_&&L>T;T++){var A=e[T],O=A._path,N=A.getValues();if(!T||e[T-1]._path!==O){if(h=null,!O._closed){var k=O.getLastCurve().getPoint2(),z=A.getPoint1(),R=k._x,E=k._y,j=z._x,F=z._y;o=[R,E,R,E,j,F,j,F],o[f]!==o[f+6]&&(h=o)}if(!h){h=N;for(var H=O.getLastCurve();H&&H!==A;){var V=H.getValues();if(V[f]!==V[f+6]){h=V;break}H=H.getPrevious()}}}if(s(N),!_&&(T+1===L||e[T+1]._path!==O)){if(o&&(s(o),o=null),w||b||!M)C+=w,P+=b,w=b=0;else{var D=O.isClockwise()^n?1:-1;C+=D,P-=D,S+=D}M&&I++,M=!1}}return _||(C||P||(C=P=S),C=C&&2-c(C)%2,P=P&&2-c(P)%2,_={winding:l(C,P),windingL:C,windingR:P,onContour:!C^!P,onPathCount:I}),_}function h(t,e,n,i,r){var s,h=[],o=t,u=0;do{var l=t.getCurve(),_=l.getLength();h.push({segment:t,curve:l,length:_}),u+=_,t=t.getNext()}while(t&&!t._intersection&&t!==o);for(var _=u/2,g=0,d=h.length;d>g;g++){var f=h[g],v=f.length;if(v>=_){var l=f.curve,m=l._path,p=m._parent,x=l.getTimeAt(_),y=l.getPointAtTime(x),C=c(l.getTangentAtTime(x).normalize().y)<.5?1:0;p instanceof CompoundPath&&(m=p),s=r.subtract&&n&&(m===e&&n._getWinding(y,C).winding||m===n&&!e._getWinding(y,C).winding)?{winding:0}:a(y,i,C);break}_-=v}for(var g=h.length-1;g>=0;g--)h[g].segment._winding=s}function o(t,e){function n(t,n){var i;return!(!t||t._visited||!(!e||e[(i=t._winding).winding]||!n&&e.unite&&i.onContour))}function i(t){return t===a||t===h}function r(t){for(var e=t._segments,n=0,i=e.length;i>n;n++)e[n]._visited=!0}function s(t,r){if(!t._next)return t;for(;t;){var s=t._segment,a=s.getNext(),h=a&&a._intersection;
if(s!==r&&(i(s)||i(a)||a&&!s._visited&&!a._visited&&(!e||n(s)&&(n(a)||h&&n(h._segment)))))return t;t=t._next}return null}var a,h,o=[];t.sort(function(t,e){var n=t._intersection,i=e._intersection,r=!(!n||!n._overlap),s=!(!i||!i._overlap),a=t._path,h=e._path;return r^s?r?1:-1:n^i?n?1:-1:a!==h?a._id-h._id:t._index-e._index});for(var u=0,l=t.length;l>u;u++){var _,g=null,d=!1,f=t[u],v=f._intersection;if(!f._visited&&f._path._overlapsOnly){var m=f._path,p=v._segment._path;m.compare(p)&&((e.unite||e.intersect)&&m.getArea()&&o.push(m.clone(!1)),r(m),r(p))}if(n(f,!0)){for(a=h=null;;){v=v&&s(v,f)||v;var x=v&&v._segment;if(i(f)?d=!0:x&&(i(x)?(d=!0,f=x):n(x,n(f,!0))&&(e&&(e.intersect||e.subtract)&&(f._visited=!0),f=x)),d||f._visited){f._visited=!0;break}if(f._path._validOverlapsOnly&&!n(f))break;g||(g=new Path(Item.NO_INSERT),a=f,h=x);var y=f.getNext();g.add(new Segment(f._point,_,y&&f._handleOut)),f._visited=!0,f=y||f._path.getFirstSegment(),_=y&&y._handleIn,v=f._intersection}if(d)g.firstSegment.setHandleIn(_),g.setClosed(!0);else if(g){var C=g.getArea(!0);c(C)>=1e-7&&console.error("Boolean operation resulted in open path","segments =",g._segments.length,"length =",g.getLength(),"area=",C),g=null}g&&(g._segments.length>8||!Numerical.isZero(g.getArea()))&&(o.push(g),g=null)}}return o}var u=Math.min,l=Math.max,c=Math.abs,_={unite:{1:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0}};return{_getWinding:function(t,e){return a(t,this.getCurves(),e)},unite:function(t){return n(this,t,"unite")},intersect:function(t){return n(this,t,"intersect")},subtract:function(t){return n(this,t,"subtract")},exclude:function(t){return n(this,t,"exclude")},divide:function(t){return e(Group,[this.subtract(t),this.intersect(t)],!0,this,t)},resolveCrossings:function(){function t(t){var e=t&&t._intersection;return e&&e._overlap}var e=this._children,n=e||[this],i=!1,r=!1,a=this.getIntersections(null,function(t){return t._overlap&&(i=!0)||t.isCrossing()&&(r=!0)});if(a=CurveLocation.expand(a),i)for(var h=s(a,function(t){return t._overlap}),u=h.length-1;u>=0;u--){var l=h[u]._segment,c=l.getPrevious(),_=l.getNext();if(l._path&&t(c)&&t(_)){l.remove(),c._handleOut._set(0,0),_._handleIn._set(0,0);var g=c.getCurve();g.isStraight()&&0===g.getLength()&&(_._handleIn.set(c._handleIn),c.remove())}}r&&(s(a,i&&function(t){var e=t.getCurve(),n=t._intersection._curve,i=t._segment;return e&&n&&e._path&&n._path?!0:void(i&&(i._intersection=null))}),n=o(Base.each(n,function(t){this.push.apply(this,t._segments)},[])));var d,f=n.length;return f>1&&e?(n!==e&&this.setChildren(n),d=this):1!==f||e||(n[0]!==this&&this.setSegments(n[0].removeSegments()),d=this),d||(d=new CompoundPath(Item.NO_INSERT),d.addChildren(n),d=d.reduce(),d.copyAttributes(this),this.replaceWith(d)),d},reorient:function(t){var e=this._children,n=e&&e.length;if(n>1){var i=Base.each(e,function(t,e){this[t._id]={winding:t.isClockwise()?1:-1,index:e}},{}),r=this.removeChildren().sort(function(t,e){return c(e.getArea())-c(t.getArea())}),s=r[0],a=[];a[i[s._id].index]=s;for(var h=1;n>h;h++){for(var o=r[h],u=i[o._id],l=o.getInteriorPoint(),_=!1,g=null,d=!1,f=h-1;f>=0&&!g;f--){var v=r[f];if(v.contains(l)){var m=i[v._id];if(t&&!_&&(u.winding+=m.winding,u.winding&&m.winding)){d=u.exclude=!0;break}_=!0,g=!m.exclude&&v}}d||(o.setClockwise(g?!g.isClockwise():s.isClockwise()),a[u.index]=o)}this.setChildren(a)}return this},getInteriorPoint:function(){var t=this.getBounds(),e=t.getCenter(!0);if(!this.contains(e)){for(var n=this.getCurves(),i=e.y,r=[],s=[],a=0,h=n.length;h>a;a++){var o=n[a].getValues(),c=o[1],_=o[3],g=o[5],d=o[7];if(i>=u(c,_,g,d)&&i<=l(c,_,g,d))for(var f=Curve.getMonoCurves(o),v=0,m=f.length;m>v;v++){var p=f[v],x=p[1],y=p[7];if(x!==y&&(i>=x&&y>=i||i>=y&&x>=i)){var C=i===x?p[0]:i===y?p[6]:1===Curve.solveCubic(p,1,i,s,0,1)?Curve.getPoint(p,s[0]).x:(p[0]+p[6])/2;r.push(C)}}}r.length>1&&(r.sort(function(t,e){return t-e}),e.x=(r[0]+r[1])/2)}return e}}}),new function(){function t(t,e){return t.getPathData(null,e.precision)}function e(t,e){return t.getPathData(null,e.precision)}function n(t,e){var n=t,i=null;if(a){n="svg"===t.nodeName.toLowerCase()&&t;for(var r in a.svgs)i||(n||(n=SvgElement.create("svg"),n.appendChild(t)),i=n.insertBefore(SvgElement.create("defs"),n.firstChild)),i.appendChild(a.svgs[r]);a=null}return e.asString?(new self.XMLSerializer).serializeToString(n):n}function i(t,e,n){var i=h[t._class],r=i&&i(t,e);if(r){var s=e.onExport;s&&(r=s(t,r,e)||r);var a=JSON.stringify(t._data);a&&"{}"!==a&&"null"!==a&&r.setAttribute("data-paper-data",a)}return r}function r(t){return t||(t={}),s=new Formatter(t.precision),t}var s,a,h={Path:t,CompoundPath:e};Item.inject({exportSVG:function(t){return t=r(t),n(i(this,t,!0),t)}})};

paper = new (PaperScope.inject(Base.exports, {
  enumerable: true,
  Base: Base,
  Numerical: Numerical,
  //document: document,
  //window: window,
}))();

/*if (typeof define === 'function' && define.amd) {
  define('paper', paper);
} else if (typeof module === 'object' && module) {
  module.exports = paper;
}
*/
//return paper;
//}.call(this, typeof self === 'object' ? self : null);

export { paper, Path };