// boolean operations extracted from Paper.js

/*!
 * Paper.js v0.10.2-svg-boolean-op - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2016, Juerg Lehni & Jonathan Puckey
 * http://scratchdisk.com/ & http://jonathanpuckey.com/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Sat Jul 23 13:00:49 2016 +0300
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2016 Juerg Lehni
 * http://scratchdisk.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * http://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */

//var paper = function(self, undefined) {

/*self = self || require('./node/window.js');

var window = self.window,
  document = self.document;
*/
var Base=new function(){function k(b,c,d,g,h){function j(a,j){j=j||(j=e(c,a))&&(j.get?j:j.value),"string"==typeof j&&"#"===j[0]&&(j=b[j.substring(1)]||j);var o,k="function"==typeof j,m=j,n=h||k&&!j.base?j&&j.get?a in b:b[a]:null;h&&n||(k&&n&&(j.base=n),k&&g!==!1&&(o=a.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(i[o[3].toLowerCase()+o[4]]=o[2]),m&&!k&&m.get&&"function"==typeof m.get&&l.isPlainObject(m)||(m={value:m,writable:!0}),(e(b,a)||{configurable:!0}).configurable&&(m.configurable=!0,m.enumerable=d),f(b,a,m))}var i={};if(c){for(var k in c)c.hasOwnProperty(k)&&!a.test(k)&&j(k);for(var k in i){var m=i[k],n=b["set"+m],o=b["get"+m]||n&&b["is"+m];!o||g!==!0&&0!==o.length||j(k,{get:o,set:n})}}return b}function l(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];c&&i(this,c)}return this}var a=/^(statics|enumerable|beans|preserve)$/,b=[],c=b.slice,d=Object.create,e=Object.getOwnPropertyDescriptor,f=Object.defineProperty,g=b.forEach||function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},h=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},i=Object.assign||function(a){for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a},j=function(a,b,c){if(a){var d=e(a,"length");(d&&"number"==typeof d.value?g:h).call(a,b,c=c||a)}return c};return k(l,{inject:function(a){if(a){var b=a.statics===!0?a:a.statics,c=a.beans,d=a.preserve;b!==a&&k(this.prototype,a,a.enumerable,c,d),k(this,b,!0,c,d)}for(var e=1,f=arguments.length;e<f;e++)this.inject(arguments[e]);return this},extend:function(){for(var b,c,g,a=this,e=0,h=arguments.length;e<h&&(!b||!c);e++)g=arguments[e],b=b||g.initialize,c=c||g.prototype;return b=b||function(){a.apply(this,arguments)},c=b.prototype=c||d(this.prototype),f(c,"constructor",{value:b,writable:!0,configurable:!0}),k(b,this,!0),arguments.length&&this.inject.apply(b,arguments),b.base=a,b}},!0).inject({initialize:l,set:l,inject:function(){for(var a=0,b=arguments.length;a<b;a++){var c=arguments[a];c&&k(this,c,c.enumerable,c.beans,c.preserve)}return this},extend:function(){var a=d(this);return a.inject.apply(a,arguments)},each:function(a,b){return j(this,a,b)},clone:function(){return new this.constructor(this)},statics:{set:i,each:j,create:d,define:f,describe:e,clone:function(a){return i(new a.constructor,a)},isPlainObject:function(a){var b=null!=a&&a.constructor;return b&&(b===Object||b===l||"Object"===b.name)},pick:function(a,b){return void 0!==a?a:b},slice:function(a,b,d){return c.call(a,b,d)}}})};"undefined"!=typeof module&&(module.exports=Base),Base.inject({statics:{exports:{enumerable:!0},extend:function a(){var b=a.base.apply(this,arguments),c=b.prototype._class;return c&&!Base.exports[c]&&(Base.exports[c]=b),b},read:function(a,b,c,d){if(this===Base){var e=this.peek(a,b);return a.__index++,e}var f=this.prototype,g=f._readIndex,h=b||g&&a.__index||0,i=a.length,j=a[h];return d=d||i-h,j instanceof this||c&&c.readNull&&null==j&&d<=1?(g&&(a.__index=h+1),j&&c&&c.clone?j.clone():j):(j=Base.create(this.prototype),g&&(j.__read=!0),j=j.initialize.apply(j,h>0||h+d<i?Base.slice(a,h,h+d):a)||j,g&&(a.__index=h+j.__read,j.__read=void 0),j)},peek:function(a,b){return a[a.__index=b||a.__index||0]},readList:function(a,b,c,d){for(var f,e=[],g=b||0,h=d?g+d:a.length,i=g;i<h;i++)e.push(Array.isArray(f=a[i])?this.read(f,0,c):this.read(a,i,c,1));return e},splice:function(a,b,c,d){var e=b&&b.length,f=void 0===c;c=f?a.length:c,c>a.length&&(c=a.length);for(var g=0;g<e;g++)b[g]._index=c+g;if(f)return a.push.apply(a,b),[];var h=[c,d];b&&h.push.apply(h,b);for(var i=a.splice.apply(a,h),g=0,j=i.length;g<j;g++)i[g]._index=void 0;for(var g=c+e,j=a.length;g<j;g++)a[g]._index=g;return i},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(a,b){if("string"!=typeof a)Base.each(a,function(a,b){this.on(b,a)},this);else{var c=this._eventTypes,d=c&&c[a],e=this._callbacks=this._callbacks||{};e=e[a]=e[a]||[],e.indexOf(b)===-1&&(e.push(b),d&&d.install&&1===e.length&&d.install.call(this,a))}return this},off:function(a,b){if("string"!=typeof a)return void Base.each(a,function(a,b){this.off(b,a)},this);var f,c=this._eventTypes,d=c&&c[a],e=this._callbacks&&this._callbacks[a];return e&&(!b||(f=e.indexOf(b))!==-1&&1===e.length?(d&&d.uninstall&&d.uninstall.call(this,a),delete this._callbacks[a]):f!==-1&&e.splice(f,1)),this},once:function(a,b){return this.on(a,function(){b.apply(this,arguments),this.off(a,b)})},emit:function(a,b){var c=this._callbacks&&this._callbacks[a];if(!c)return!1;var d=Base.slice(arguments,1),e=b&&b.target&&!b.currentTarget;c=c.slice(),e&&(b.currentTarget=this);for(var f=0,g=c.length;f<g;f++)if(c[f].apply(this,d)===!1){b&&b.stop&&b.stop();break}return e&&delete b.currentTarget,!0},responds:function(a){return!(!this._callbacks||!this._callbacks[a])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(a){var b=this._eventTypes,c=this._callbacks,d=a?"install":"uninstall";if(b)for(var e in c)if(c[e].length>0){var f=b[e],g=f&&f[d];g&&g.call(this,e)}},statics:{inject:function a(b){var c=b._events;if(c){var d={};Base.each(c,function(a,c){var e="string"==typeof a,f=e?a:c,g=Base.capitalize(f),h=f.substring(2).toLowerCase();d[h]=e?{}:a,f="_"+f,b["get"+g]=function(){return this[f]},b["set"+g]=function(a){var b=this[f];b&&this.off(h,b),a&&this.on(h,a),this[f]=a}}),b._eventTypes=d}return a.base.apply(this,arguments)}}},PaperScope=Base.extend({_class:"PaperScope",initialize:function a(){paper=this,this.settings=new Base({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=a._id++,a._scopes[this._id]=this;a.prototype},version:"0.10.2-svg-boolean-restart",setup:function(a){return paper=this,this.project=new Project(a),this},statics:new function(){return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null}}}}),Formatter=Base.extend({initialize:function(a){this.precision=Base.pick(a,5),this.multiplier=Math.pow(10,this.precision)},number:function(a){return this.precision<16?Math.round(a*this.multiplier)/this.multiplier:a},pair:function(a,b,c){return this.number(a)+(c||",")+this.number(b)},point:function(a,b){return this.number(a.x)+(b||",")+this.number(a.y)},size:function(a,b){return this.number(a.width)+(b||",")+this.number(a.height)},rectangle:function(a,b){return this.point(a,b)+(b||",")+this.size(a,b)}});Formatter.instance=new Formatter;var Numerical=new function(){function i(a,b,c){return a<b?b:a>c?c:a}function j(a,b,d){function e(a){var b=134217729*a,c=a-b,d=c+b,e=a-d;return[d,e]}var f=b*b-a*d,g=b*b+a*d;if(3*c(f)<g){var h=e(a),i=e(b),j=e(d),k=b*b,l=i[0]*i[0]-k+2*i[0]*i[1]+i[1]*i[1],m=a*d,n=h[0]*j[0]-m+h[0]*j[1]+h[1]*j[0]+h[1]*j[1];f=k-m+(l-n)}return f}function k(){var a=Math.max.apply(Math,arguments);return a&&(a<1e-8||a>1e8)?e(2,-Math.round(f(a))):0}var a=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],b=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],c=Math.abs,d=Math.sqrt,e=Math.pow,f=Math.log2||function(a){return Math.log(a)*Math.LOG2E},g=1e-12,h=1.12e-16;return{TOLERANCE:1e-6,EPSILON:g,MACHINE_EPSILON:h,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:1e-7,WINDING_EPSILON:1e-8,TRIGONOMETRIC_EPSILON:1e-8,CLIPPING_EPSILON:1e-10,KAPPA:4*(d(2)-1)/3,isZero:function(a){return a>=-g&&a<=g},clamp:i,integrate:function(c,d,e,f){for(var g=a[f-2],h=b[f-2],i=.5*(e-d),j=i+d,k=0,l=f+1>>1,m=1&f?h[k++]*c(j):0;k<l;){var n=i*g[k];m+=h[k++]*(c(j+n)+c(j-n))}return i*m},findRoot:function(a,b,d,e,f,g,h){for(var i=0;i<g;i++){var j=a(d),k=j/b(d),l=d-k;if(c(k)<h)return l;j>0?(f=d,d=l<=e?.5*(e+f):l):(e=d,d=l>=f?.5*(e+f):l)}return d},solveQuadratic:function(a,b,e,f,l,m){var n,o=1/0;if(c(a)<g){if(c(b)<g)return c(e)<g?-1:0;n=-e/b}else{b*=-.5;var p=j(a,b,e);if(p&&c(p)<h){var q=k(c(a),c(b),c(e));q&&(a*=q,b*=q,e*=q,p=j(a,b,e))}if(p>=-h){var r=p<0?0:d(p),s=b+(b<0?-r:r);0===s?(n=e/a,o=-n):(n=s/a,o=e/s)}}var t=0,u=null==l,v=l-g,w=m+g;return isFinite(n)&&(u||n>v&&n<w)&&(f[t++]=u?n:i(n,l,m)),o!==n&&isFinite(o)&&(u||o>v&&o<w)&&(f[t++]=u?o:i(o,l,m)),t},solveCubic:function(a,b,f,j,l,m,n){function u(c){p=c;var d=a*p;q=d+b,r=q*p+f,s=(d+q)*p+r,t=r*p+j}var p,q,r,s,t,o=k(c(a),c(b),c(f),c(j));if(o&&(a*=o,b*=o,f*=o,j*=o),c(a)<g)a=b,q=f,r=j,p=1/0;else if(c(j)<g)q=b,r=f,p=0;else{u(-(b/a)/3);var v=t/a,w=e(c(v),1/3),x=v<0?-1:1,y=-s/a,z=y>0?1.324717957244746*Math.max(w,d(y)):w,A=p-x*z;if(A!==p){do u(A),A=0===s?p:p-t/s/(1+h);while(x*A>x*p);c(a)*p*p>c(j/p)&&(r=-j/p,q=(r-f)/p)}}var B=Numerical.solveQuadratic(a,q,r,l,m,n),C=null==m;return isFinite(p)&&(0===B||B>0&&p!==l[0]&&p!==l[1])&&(C||p>m-g&&p<n+g)&&(l[B++]=C?p:i(p,m,n)),B}}},UID={_id:1,_pools:{},get:function(a){if(a){var b=this._pools[a];return b||(b=this._pools[a]={_id:1}),b._id++}return this._id++}},Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function(b,c){var d=typeof b,e=this.__read,f=0;if("number"===d){var g="number"==typeof c;this._set(b,g?c:b),e&&(f=g?2:1)}else if("undefined"===d||null===b)this._set(0,0),e&&(f=null===b?1:0);else{var h="string"===d?b.split(/[\s,]+/)||[]:b;f=1,Array.isArray(h)?this._set(+h[0],+(h.length>1?h[1]:h[0])):"x"in h?this._set(h.x||0,h.y||0):"width"in h?this._set(h.width||0,h.height||0):"angle"in h?(this._set(h.length||0,0),this.setAngle(h.angle||0)):(this._set(0,0),f=0)}return e&&(this.__read=f),this},set:"#initialize",_set:function(a,b){return this.x=a,this.y=b,this},equals:function(a){return this===a||a&&(this.x===a.x&&this.y===a.y||Array.isArray(a)&&this.x===a[0]&&this.y===a[1])||!1},clone:function(){return new Point(this.x,this.y)},toString:function(){var a=Formatter.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this._set(Math.cos(b)*a,Math.sin(b)*a)}else{var c=a/this.getLength();Numerical.isZero(c)&&this.getAngle(),this._set(this.x*c,this.y*c)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(a){this.setAngleInRadians.call(this,a*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var a=Point.read(arguments),b=this.getLength()*a.getLength();if(Numerical.isZero(b))return NaN;var c=this.dot(a)/b;return Math.acos(c<-1?-1:c>1?1:c)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(a){if(this._angle=a,!this.isZero()){var b=this.getLength();this._set(Math.cos(a)*b,Math.sin(a)*b)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var a=Point.read(arguments);return 180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},getDistance:function(){var a=Point.read(arguments),b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Base.read(arguments);return e?d:Math.sqrt(d)},normalize:function(a){void 0===a&&(a=1);var b=this.getLength(),c=0!==b?a/b:0,d=new Point(this.x*c,this.y*c);return c>=0&&(d._angle=this._angle),d},rotate:function(a,b){if(0===a)return this.clone();a=a*Math.PI/180;var c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a);return c=new Point(c.x*e-c.y*d,c.x*d+c.y*e),b?c.add(b):c},transform:function(a){return a?a._transformPoint(this):this},add:function(){var a=Point.read(arguments);return new Point(this.x+a.x,this.y+a.y)},subtract:function(){var a=Point.read(arguments);return new Point(this.x-a.x,this.y-a.y)},multiply:function(){var a=Point.read(arguments);return new Point(this.x*a.x,this.y*a.y)},divide:function(){var a=Point.read(arguments);return new Point(this.x/a.x,this.y/a.y)},modulo:function(){var a=Point.read(arguments);return new Point(this.x%a.x,this.y%a.y)},negate:function(){return new Point((-this.x),(-this.y))},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var a=Point.read(arguments),b=Base.read(arguments);return this.getDistance(a)<=b},isCollinear:function(){var a=Point.read(arguments);return Point.isCollinear(this.x,this.y,a.x,a.y)},isColinear:"#isCollinear",isOrthogonal:function(){var a=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,a.x,a.y)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var a=Point.read(arguments);return this.x*a.x+this.y*a.y},cross:function(){var a=Point.read(arguments);return this.x*a.y-this.y*a.x},project:function(){var a=Point.read(arguments),b=a.isZero()?0:this.dot(a)/a.dot(a);return new Point(a.x*b,a.y*b)},statics:{min:function(){var a=Point.read(arguments),b=Point.read(arguments);return new Point(Math.min(a.x,b.x),Math.min(a.y,b.y))},max:function(){var a=Point.read(arguments),b=Point.read(arguments);return new Point(Math.max(a.x,b.x),Math.max(a.y,b.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(a,b,c,d){return Math.abs(a*d-b*c)<=1e-8*Math.sqrt((a*a+b*b)*(c*c+d*d))},isOrthogonal:function(a,b,c,d){return Math.abs(a*c+b*d)<=1e-8*Math.sqrt((a*a+b*b)*(c*c+d*d))}}},Base.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new Point(b(this.x),b(this.y))}},{})),Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(b,c,d,e){var g,f=typeof b;if("number"===f?(this._set(b,c,d,e),g=4):"undefined"===f||null===b?(this._set(0,0,0,0),g=null===b?1:0):1===arguments.length&&(Array.isArray(b)?(this._set.apply(this,b),g=1):void 0!==b.x||void 0!==b.width?(this._set(b.x||0,b.y||0,b.width||0,b.height||0),g=1):void 0===b.from&&void 0===b.to&&(this._set(0,0,0,0),Base.filter(this,b),g=1)),void 0===g){var l,m,h=Point.readNamed(arguments,"from"),i=Base.peek(arguments),j=h.x,k=h.y;if(i&&void 0!==i.x||Base.hasNamed(arguments,"to")){var n=Point.readNamed(arguments,"to");l=n.x-j,m=n.y-k,l<0&&(j=n.x,l=-l),m<0&&(k=n.y,m=-m)}else{var o=Size.read(arguments);l=o.width,m=o.height}this._set(j,k,l,m),g=arguments.__index}return this.__read&&(this.__read=g),this},set:"#initialize",_set:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(a){var b=Base.isPlainValue(a)?Rectangle.read(arguments):a;return b===this||b&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height||!1},toString:function(){var a=Formatter.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y),b.number(this.width),b.number(this.height)]},getPoint:function(a){var b=a?Point:LinkedPoint;return new b(this.x,this.y,this,"setPoint")},setPoint:function(){var a=Point.read(arguments);this.x=a.x,this.y=a.y},getSize:function(a){var b=a?Size:LinkedSize;return new b(this.width,this.height,this,"setSize")},setSize:function(){var a=Size.read(arguments);this._fixX&&(this.x+=(this.width-a.width)*this._fixX),this._fixY&&(this.y+=(this.height-a.height)*this._fixY),this.width=a.width,this.height=a.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(a){this._fixW||(this.width-=a-this.x),this.x=a,this._fixX=0},getTop:function(){return this.y},setTop:function(a){this._fixH||(this.height-=a-this.y),this.y=a,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(a){void 0!==this._fixX&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=a-this.width:this.width=a-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(a){void 0!==this._fixY&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=a-this.height:this.height=a-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(a){this.x=a-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(a){this.y=a-.5*this.height,this._fixY=.5},getCenter:function(a){var b=a?Point:LinkedPoint;return new b(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var a=Point.read(arguments);return this.setCenterX(a.x),this.setCenterY(a.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(a){return a&&void 0!==a.width||4===(Array.isArray(a)?a:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b<=this.x+this.width&&c<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(){var a=Rectangle.read(arguments);return a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},touches:function(){var a=Rectangle.read(arguments);return a.x+a.width>=this.x&&a.y+a.height>=this.y&&a.x<=this.x+this.width&&a.y<=this.y+this.height},intersect:function(){var a=Rectangle.read(arguments),b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),e=Math.min(this.y+this.height,a.y+a.height);return new Rectangle(b,c,d-b,e-c)},unite:function(){var a=Rectangle.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),e=Math.max(this.y+this.height,a.y+a.height);return new Rectangle(b,c,d-b,e-c)},include:function(){var a=Point.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x),e=Math.max(this.y+this.height,a.y);return new Rectangle(b,c,d-b,e-c)},expand:function(){var a=Size.read(arguments),b=a.width,c=a.height;return new Rectangle(this.x-b/2,this.y-c/2,this.width+b,this.height+c)},scale:function(a,b){return this.expand(this.width*a-this.width,this.height*(void 0===b?a:b)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);b>=4&&(a[1]+=d?"Y":"X");var e=a[d?0:1],f=a[d?1:0],g="get"+e,h="get"+f,i="set"+e,j="set"+f,k="get"+c,l="set"+c;this[k]=function(a){var b=a?Point:LinkedPoint;return new b(this[g](),this[h](),this,l)},this[l]=function(){var a=Point.read(arguments);this[i](a.x),this[j](a.y)}},{beans:!0})),LinkedRectangle=Rectangle.extend({initialize:function(b,c,d,e,f,g){this._set(b,c,d,e,!0),this._owner=f,this._setter=g},_set:function(a,b,c,d,e){return this._x=a,this._y=b,this._width=c,this._height=d,e||this._owner[this._setter](this),this}},new function(){var a=Rectangle.prototype;return Base.each(["x","y","width","height"],function(a){var b=Base.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]},this["set"+b]=function(a){this[c]=a,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(b){var c="set"+b;this[c]=function(){this._dontNotify=!0,a[c].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(a){var b=this._owner;b.changeSelection&&b.changeSelection(2,a)}}))}),Matrix=Base.extend({_class:"Matrix",initialize:function a(b){var c=arguments.length,d=!0;if(6===c?this._set.apply(this,arguments):1===c?b instanceof a?this._set(b._a,b._b,b._c,b._d,b._tx,b._ty):Array.isArray(b)?this._set.apply(this,b):d=!1:c?d=!1:this.reset(),!d)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(a,b,c,d,e,f,g){return this._a=a,this._b=b,this._c=c,this._d=d,this._tx=e,this._ty=f,g||this._changed(),this},_serialize:function(a,b){return Base.serialize(this.getValues(),a,!0,b)},_changed:function(){var a=this._owner;a&&(a._applyMatrix?a.transform(null,!0):a._changed(9))},clone:function(){return new Matrix(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(a){return a===this||a&&this._a===a._a&&this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty},toString:function(){var a=Formatter.instance;return"[["+[a.number(this._a),a.number(this._c),a.number(this._tx)].join(", ")+"], ["+[a.number(this._b),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(a){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,a||this._changed(),this},apply:function(a,b){var c=this._owner;return!!c&&(c.transform(null,!0,Base.pick(a,!0),b),this.isIdentity())},translate:function(){var a=Point.read(arguments),b=a.x,c=a.y;return this._tx+=b*this._a+c*this._c,this._ty+=b*this._b+c*this._d,this._changed(),this},scale:function(){var a=Point.read(arguments),b=Point.read(arguments,0,{readNull:!0});return b&&this.translate(b),this._a*=a.x,this._b*=a.x,this._c*=a.y,this._d*=a.y,b&&this.translate(b.negate()),this._changed(),this},rotate:function(a){a*=Math.PI/180;var b=Point.read(arguments,1),c=b.x,d=b.y,e=Math.cos(a),f=Math.sin(a),g=c-c*e+d*f,h=d-c*f-d*e,i=this._a,j=this._b,k=this._c,l=this._d;return this._a=e*i+f*k,this._b=e*j+f*l,this._c=-f*i+e*k,this._d=-f*j+e*l,this._tx+=g*i+h*k,this._ty+=g*j+h*l,this._changed(),this},shear:function(){var a=Point.read(arguments),b=Point.read(arguments,0,{readNull:!0});b&&this.translate(b);var c=this._a,d=this._b;return this._a+=a.y*this._c,this._b+=a.y*this._d,this._c+=a.x*c,this._d+=a.x*d,b&&this.translate(b.negate()),this._changed(),this},skew:function(){var a=Point.read(arguments),b=Point.read(arguments,0,{readNull:!0}),c=Math.PI/180,d=new Point(Math.tan(a.x*c),Math.tan(a.y*c));return this.shear(d,b)},append:function(a){if(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=a._a,g=a._c,h=a._b,i=a._d,j=a._tx,k=a._ty;this._a=f*b+h*d,this._c=g*b+i*d,this._b=f*c+h*e,this._d=g*c+i*e,this._tx+=j*b+k*d,this._ty+=j*c+k*e,this._changed()}return this},prepend:function(a){if(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty,h=a._a,i=a._c,j=a._b,k=a._d,l=a._tx,m=a._ty;this._a=h*b+i*c,this._c=h*d+i*e,this._b=j*b+k*c,this._d=j*d+k*e,this._tx=h*f+i*g+l,this._ty=j*f+k*g+m,this._changed()}return this},appended:function(a){return this.clone().append(a)},prepended:function(a){return this.clone().prepend(a)},invert:function(){var a=this._a,b=this._b,c=this._c,d=this._d,e=this._tx,f=this._ty,g=a*d-b*c,h=null;return g&&!isNaN(g)&&isFinite(e)&&isFinite(f)&&(this._a=d/g,this._b=-b/g,this._c=-c/g,this._d=a/g,this._tx=(c*f-d*e)/g,this._ty=(b*e-a*f)/g,h=this),h},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new Matrix(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var a=this._a*this._d-this._c*this._b;return a&&!isNaN(a)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(a,b,c){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(a,b,c)},_transformPoint:function(a,b,c){var d=a.x,e=a.y;return b||(b=new Point),b._set(d*this._a+e*this._c+this._tx,d*this._b+e*this._d+this._ty,c)},_transformCoordinates:function(a,b,c){for(var d=0,e=2*c;d<e;d+=2){var f=a[d],g=a[d+1];b[d]=f*this._a+g*this._c+this._tx,b[d+1]=f*this._b+g*this._d+this._ty}return b},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];return this._transformCoordinates(f,f,4)},_transformBounds:function(a,b,c){for(var d=this._transformCorners(a),e=d.slice(0,2),f=e.slice(),g=2;g<8;g++){var h=d[g],i=1&g;h<e[i]?e[i]=h:h>f[i]&&(f[i]=h)}return b||(b=new Rectangle),b._set(e[0],e[1],f[0]-e[0],f[1]-e[1],c)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_inverseTransform:function(a,b,c){var d=this._a,e=this._b,f=this._c,g=this._d,h=this._tx,i=this._ty,j=d*g-e*f,k=null;if(j&&!isNaN(j)&&isFinite(h)&&isFinite(i)){var l=a.x-this._tx,m=a.y-this._ty;b||(b=new Point),k=b._set((l*g-m*f)/j,(m*d-l*e)/j,c)}return k},decompose:function(){var i,j,k,a=this._a,b=this._b,c=this._c,d=this._d,e=a*d-b*c,f=Math.sqrt,g=Math.atan2,h=180/Math.PI;if(0!==a||0!==b){var l=f(a*a+b*b);i=Math.acos(a/l)*(b>0?1:-1),j=[l,e/l],k=[g(a*c+b*d,l*l),0]}else if(0!==c||0!==d){var m=f(c*c+d*d);i=Math.asin(c/m)*(d>0?1:-1),j=[e/m,m],k=[0,g(a*c+b*d,m*m)]}else i=0,k=j=[0,0];return{translation:this.getTranslation(),rotation:i*h,scaling:new Point(j),skewing:new Point(k[0]*h,k[1]*h)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(a){this.isIdentity()||a.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},Base.each(["a","b","c","d","tx","ty"],function(a){var b=Base.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]},this["set"+b]=function(a){this[c]=a,this._changed()}},{})),Line=Base.extend({_class:"Line",initialize:function(b,c,d,e,f){var g=!1;arguments.length>=4?(this._px=b,this._py=c,this._vx=d,this._vy=e,g=f):(this._px=b.x,this._py=b.y,this._vx=c.x,this._vy=c.y,g=d),g||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(a,b){return Line.intersect(this._px,this._py,this._vx,this._vy,a._px,a._py,a._vx,a._vy,!0,b)},getSide:function(a,b){return Line.getSide(this._px,this._py,this._vx,this._vy,a.x,a.y,!0,b)},getDistance:function(a){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,a.x,a.y,!0))},isCollinear:function(a){return Point.isCollinear(this._vx,this._vy,a._vx,a._vy)},isOrthogonal:function(a){return Point.isOrthogonal(this._vx,this._vy,a._vx,a._vy)},statics:{intersect:function(a,b,c,d,e,f,g,h,i,j){i||(c-=a,d-=b,g-=e,h-=f);var k=c*h-d*g;if(!Numerical.isZero(k)){var l=a-e,m=b-f,n=(g*m-h*l)/k,o=(c*m-d*l)/k,p=1e-12,q=-p,r=1+p;if(j||q<n&&n<r&&q<o&&o<r)return j||(n=n<=0?0:n>=1?1:n),new Point(a+n*c,b+n*d)}},getSide:function(a,b,c,d,e,f,g,h){g||(c-=a,d-=b);var i=e-a,j=f-b,k=i*d-j*c;return 0!==k||h||(k=(i*c+i*c)/(c*c+d*d),k>=0&&k<=1&&(k=0)),k<0?-1:k>0?1:0},getSignedDistance:function(a,b,c,d,e,f,g){return g||(c-=a,d-=b),0===c?d>0?e-a:a-e:0===d?c<0?f-b:b-f:((e-a)*d-(f-b)*c)/Math.sqrt(c*c+d*d)}}}),Project=Base.extend(Emitter,{_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(b){this._children=[],this._namedChildren={},this._activeLayer=null,this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_changed:function(a,b){if(1&a){var c=this._view;c&&(c._needsUpdate=!0,!c._requested&&c._autoUpdate&&c.requestUpdate())}var d=this._changes;if(d&&b){var e=this._changesById,f=b._id,g=e[f];g?g.flags|=a:d.push(e[f]={item:b,flags:a})}},insertLayer:function(a,b){if(b instanceof Group){b._remove(!1,!0),Base.splice(this._children,[b],a,0),b._setProject(this,!0);var c=b._name;c&&b.setName(c),this._changes&&b._changed(5),this._activeLayer||(this._activeLayer=b)}else b=null;return b},_insertItem:function(a,b,c){return b=this.insertLayer(a,b)||(this._activeLayer||this._insertItem(void 0,new Group(Item.NO_INSERT),!0)).insertChild(a,b),c&&b.activate&&b.activate(),b}}),Item=Base.extend(Emitter,{statics:{extend:function a(b){return b._serializeFields&&(b._serializeFields=Base.set({},this.prototype._serializeFields,b._serializeFields)),a.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}}},new function(){var a=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return Base.each(a,function(a){this._events[a]={install:function(a){this.getView()._countItemEvent(a,1)},uninstall:function(a){this.getView()._countItemEvent(a,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:a}})},{initialize:function(){},_initialize:function(a,b){var c=a&&Base.isPlainObject(a),d=c&&a.internal===!0,e=this._matrix=new Matrix,f=c&&a.project||paper.project,g=paper.settings;return this._id=d?null:UID.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&g.applyMatrix,b&&e.translate(b),e._owner=this,d||c&&a.insert===!1||!g.insertItems&&(!c||a.insert!==!0)?this._setProject(f):(c&&a.parent||f)._insertItem(void 0,this,!0),c&&a!==Item.NO_INSERT&&Base.filter(this,a,{internal:!0,insert:!0,
project:!0,parent:!0}),c},_changed:function(a){var b=this._symbol,c=this._parent||b,d=this._project;8&a&&(this._bounds=this._position=this._decomposed=this._globalMatrix=void 0),c&&40&a&&Item._clearBoundsCache(c),2&a&&Item._clearBoundsCache(this),d&&d._changed(a,this),b&&b._changed(a)},set:function(a){return a&&this._set(a),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){if(this._name&&this._removeNamed(),a===+a+"")throw new Error("Names consisting only of numbers are not supported.");var b=this._getOwner();if(a&&b){var c=b._children,d=b._namedChildren;(d[a]=d[a]||[]).push(this),a in c||(c[a]=this)}this._name=a||void 0,this._changed(128)}},{beans:!0,getSelection:function(){return this._selection},setSelection:function(a){if(a!==this._selection){this._selection=a;var b=this._project;b&&(b._updateSelection(this),this._changed(129))}},changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){if(this._selectChildren)for(var a=this._children,b=0,c=a.length;b<c;b++)if(a[b].isSelected())return!0;return!!(1&this._selection)},setSelected:function(a){if(this._selectChildren)for(var b=this._children,c=0,d=b.length;c<d;c++)b[c].setSelected(a);this.changeSelection(1,a)},isFullySelected:function(){var a=this._children,b=!!(1&this._selection);if(a&&b){for(var c=0,d=a.length;c<d;c++)if(!a[c].isFullySelected())return!1;return!0}return b},setFullySelected:function(a){var b=this._children;if(b)for(var c=0,d=b.length;c<d;c++)b[c].setFullySelected(a);this.changeSelection(1,a)},getData:function(){return this._data||(this._data={}),this._data},setData:function(a){this._data=a},getPosition:function(a){var b=this._position,c=a?Point:LinkedPoint;if(!b){var d=this._pivot;b=this._position=d?this._matrix._transformPoint(d):this.getBounds().getCenter(!0)}return new c(b.x,b.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(){var a=this._pivot;return a?new LinkedPoint(a.x,a.y,this,"setPivot"):null},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:!0,readNull:!0}),this._position=void 0}},Base.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(a,b){this[b]=function(b){return this.getBounds(b,a)}},{beans:!0,getBounds:function(a,b){var c=b||a instanceof Matrix,d=Base.set({},c?b:a,this._boundsOptions);d.stroke&&!this.getStrokeScaling()||(d.cacheItem=this);var e=this._getCachedBounds(c&&a,d);return arguments.length?e:new LinkedRectangle(e.x,e.y,e.width,e.height,this,"setBounds")},setBounds:function(){var a=Rectangle.read(arguments),b=this.getBounds(),c=this._matrix,d=new Matrix,e=a.getCenter();d.translate(e),a.width==b.width&&a.height==b.height||(c.isInvertible()||(c.set(c._backup||(new Matrix).translate(c.getTranslation())),b=this.getBounds()),d.scale(0!==b.width?a.width/b.width:0,0!==b.height?a.height/b.height:0)),e=b.getCenter(),d.translate(-e.x,-e.y),this.transform(d)},_getBounds:function(a,b){var c=this._children;return c&&c.length?(Item._updateBoundsCache(this,b.cacheItem),Item._getBounds(c,a,b)):new Rectangle},_getCachedBounds:function(a,b){a=a&&a._orNullIfIdentity();var c=b.internal,d=b.cacheItem,e=c?null:this._matrix._orNullIfIdentity(),f=d&&(!a||a.equals(e))&&[b.stroke?1:0,b.handle?1:0,c?1:0].join("");if(Item._updateBoundsCache(this._parent||this._symbol,d),f&&this._bounds&&f in this._bounds)return this._bounds[f].rect.clone();var g=this._getBounds(a||e,b);if(f){this._bounds||(this._bounds={});this._bounds[f]={rect:g.clone(),internal:b.internal}}return g},_getStrokeMatrix:function(a,b){var c=this.getStrokeScaling()?null:b&&b.internal?this:this._parent||this._symbol&&this._symbol._item,d=c?c.getViewMatrix().invert():a;return d&&d._shiftless()},statics:{_updateBoundsCache:function(a,b){if(a&&b){var c=b._id,d=a._boundsCache=a._boundsCache||{ids:{},list:[]};d.ids[c]||(d.list.push(b),d.ids[c]=b)}},_clearBoundsCache:function(a){var b=a._boundsCache;if(b){a._bounds=a._position=a._boundsCache=void 0;for(var c=0,d=b.list,e=d.length;c<e;c++){var f=d[c];f!==a&&(f._bounds=f._position=void 0,f._boundsCache&&Item._clearBoundsCache(f))}}},_getBounds:function(a,b,c){var d=1/0,e=-d,f=d,g=e;c=c||{};for(var h=0,i=a.length;h<i;h++){var j=a[h];if(j._visible&&!j.isEmpty()){var k=j._getCachedBounds(b&&b.appended(j._matrix),c);d=Math.min(k.x,d),f=Math.min(k.y,f),e=Math.max(k.x+k.width,e),g=Math.max(k.y+k.height,g)}}return isFinite(d)?new Rectangle(d,f,e-d,g-f):new Rectangle}}}),{beans:!0,_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var a=this._decompose();return a&&a.rotation},setRotation:function(a){var b=this.getRotation();null!=b&&null!=a&&this.rotate(a-b)},getScaling:function(){var a=this._decompose(),b=a&&a.scaling;return b?new LinkedPoint(b.x,b.y,this,"setScaling"):void 0},setScaling:function(){var a=this.getScaling(),b=Point.read(arguments,0,{clone:!0,readNull:!0});a&&b&&this.scale(b.x/a.x,b.y/a.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;a.initialize.apply(a,arguments)},getGlobalMatrix:function(a){var b=this._globalMatrix,c=this._project._updateVersion;if(b&&b._updateVersion!==c&&(b=null),!b){b=this._globalMatrix=this._matrix.clone();var d=this._parent;d&&b.prepend(d.getGlobalMatrix(!0)),b._updateVersion=c}return a?b:b.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(a){(this._applyMatrix=this._canApplyMatrix&&!!a)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(a,b){if(this._project!==a){this._project&&this._installEvents(!1),this._project=a;for(var c=this._children,d=0,e=c&&c.length;d<e;d++)c[d]._setProject(a);b=!0}b&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function a(b){a.base.call(this,b);for(var c=this._children,d=0,e=c&&c.length;d<e;d++)c[d]._installEvents(b)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof Layer)return a;return null},getParent:function(){return this._parent},setParent:function(a){return a.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(a){this.removeChildren(),this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var a=this._getOwner();return a&&a._children[this._index+1]||null},getPreviousSibling:function(){var a=this._getOwner();return a&&a._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(a){return a===this||a&&this._class===a._class&&this._matrix.equals(a._matrix)&&this._locked===a._locked&&this._visible===a._visible&&this._blendMode===a._blendMode&&this._opacity===a._opacity&&this._clipMask===a._clipMask&&this._guide===a._guide&&this._equals(a)||!1},_equals:function(a){return Base.equals(this._children,a._children)},clone:function(a){var b=new this.constructor(Item.NO_INSERT),c=this._children,d=Base.pick(a?a.insert:void 0,void 0===a||a===!0),e=Base.pick(a?a.deep:void 0,!0);c&&b.copyAttributes(this),c&&!e||b.copyContent(this),c||b.copyAttributes(this),d&&b.insertAbove(this);var f=this._name,g=this._parent;if(f&&g){for(var c=g._children,h=f,i=1;c[f];)f=h+" "+i++;f!==h&&b.setName(f)}return b},copyContent:function(a){for(var b=a._children,c=0,d=b&&b.length;c<d;c++)this.addChild(b[c].clone(!1),!0)},copyAttributes:function(a,b){for(var c=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],d=0,e=c.length;d<e;d++){var f=c[d];a.hasOwnProperty(f)&&(this[f]=a[f])}b||this._matrix.set(a._matrix),this.setApplyMatrix(a._applyMatrix),this.setPivot(a._pivot),this.setSelection(a._selection);var g=a._data,h=a._name;this._data=g?Base.clone(g):null,h&&this.setName(h)},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(a){var b=this._children;if(b){for(var c=b.length-1;c>=0;c--)if(b[c].contains(a))return!0;return!1}return a.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(a,b){return a instanceof Item&&this._asPathItem().getIntersections(a._asPathItem(),null,b,!0).length>0}},{addChild:function(a){return this.insertChild(void 0,a)},insertChild:function(a,b){var c=b?this.insertChildren(a,[b]):null;return c&&c[0]},addChildren:function(a){return this.insertChildren(this._children.length,a)},insertChildren:function(a,b){var c=this._children;if(c&&b&&b.length>0){b=Base.slice(b);for(var d=b.length-1;d>=0;d--){var e=b[d];e?e._remove(!1,!0):b.splice(d,1)}Base.splice(c,b,a,0);for(var f=this._project,g=f._changes,d=0,h=b.length;d<h;d++){var e=b[d],i=e._name;e._parent=this,e._setProject(f,!0),i&&e.setName(i),g&&this._changed(5)}this._changed(11)}else b=null;return b},_insertItem:"#insertChild",_insertAt:function(a,b){var c=this;if(c!==a){var d=a&&a._getOwner();d?(c._remove(!1,!0),d._insertItem(a._index+b,c)):c=null}return c},insertAbove:function(a){return this._insertAt(a,1)},insertBelow:function(a){return this._insertAt(a,0)},appendTop:"#addChild",appendBottom:function(a){return this.insertChild(0,a)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(a){return a._insertItem(void 0,this.clone(!1))},reduce:function(a){var b=this._children;if(b&&1===b.length){var c=b[0].reduce(a);return this._parent?(c.insertAbove(this),this.remove()):c.remove(),c}return this},_removeNamed:function(){var a=this._getOwner();if(a){var b=a._children,c=a._namedChildren,d=this._name,e=c[d],f=e?e.indexOf(this):-1;f!==-1&&(b[d]==this&&delete b[d],e.splice(f,1),e.length?b[d]=e[0]:delete c[d])}},_remove:function(a,b){var c=this._getOwner(),d=this._project,e=this._index;return!!c&&(null!=e&&(d._activeLayer===this&&(d._activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(c._children,null,e,1)),this._name&&this._removeNamed(),this._installEvents(!1),a&&d._changes&&this._changed(5),b&&c._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(a){var b=a&&a.insertBelow(this);return b&&this.remove(),b},removeChildren:function(a,b){if(!this._children)return null;a=a||0,b=Base.pick(b,this._children.length);for(var c=Base.splice(this._children,null,a,b-a),d=c.length-1;d>=0;d--)c[d]._remove(!0,!1);return c.length>0&&this._changed(11),c},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;a<b;a++)this._children[a]._index=a;this._changed(11)}},isEmpty:function(){var a=this._children;return!a||!a.length},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}for(var c=b(this),d=b(a),e=0,f=Math.min(c.length,d.length);e<f;e++)if(c[e]!=d[e])return c[e]._index<d[e]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(a){return this._getOrder(a)===-1},isBelow:function(a){return 1===this._getOrder(a)},isParent:function(a){return this._parent===a},isChild:function(a){return a&&a._parent===this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b===a)return!0;return!1},isAncestor:function(a){return!!a&&a.isDescendant(this)},isSibling:function(a){return this._parent===a._parent},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&/^(Group|Layer|CompoundPath)$/.test(b._class)&&a.isDescendant(b))return!0;b=b._parent}return!1}},Base.each(["rotate","scale","shear","skew"],function(a){var b="rotate"===a;this[a]=function(){var c=(b?Base:Point).read(arguments),d=Point.read(arguments,0,{readNull:!0});return this.transform((new Matrix)[a](c,d||this.getPosition(!0)))}},{translate:function(){var a=new Matrix;return this.transform(a.translate.apply(a,arguments))},transform:function(a,b,c,d){a&&a.isIdentity()&&(a=null);var e=this._matrix,f=(b||this._applyMatrix)&&(!e.isIdentity()||a||b&&c&&this._children);if(!a&&!f)return this;if(a&&(!a.isInvertible()&&e.isInvertible()&&(e._backup=e.getValues()),e.prepend(a)),f=f&&this._transformContent(e,c,d)){var g=this._pivot;g&&e._transformPoint(g,g,!0),e.reset(!0),d&&this._canApplyMatrix&&(this._applyMatrix=!0)}var h=this._bounds,i=this._position;this._changed(9);var j=h&&a&&a.decompose();if(j&&!j.shearing&&j.rotation%90===0){for(var k in h){var l=h[k];if(f||!l.internal){var m=l.rect;a._transformBounds(m,m)}}var n=this._boundsGetter,m=h[n&&n.getBounds||n||"getBounds"];m&&(this._position=m.getCenter(!0)),this._bounds=h}else a&&i&&(this._position=a._transformPoint(i,i));return this},_transformContent:function(a,b,c){var d=this._children;if(d){for(var e=0,f=d.length;e<f;e++)d[e].transform(a,!0,b,c);return!0}}})),Group=Item.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(b){this._children=[],this._namedChildren={},this._initialize(b)||this.addChildren(Array.isArray(b)?b:arguments)},_changed:function a(b){a.base.call(this,b),1026&b&&(this._clipItem=void 0)}}),Segment=Base.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(b,c,d,e,f,g){var i,j,k,l,h=arguments.length;h>0&&(null==b||"object"==typeof b?1===h&&b&&"point"in b?(i=b.point,j=b.handleIn,k=b.handleOut,l=b.selection):(i=b,j=c,k=d,l=e):(i=[b,c],j=void 0!==d?[d,e]:null,k=void 0!==f?[f,g]:null)),new SegmentPoint(i,this,"_point"),new SegmentPoint(j,this,"_handleIn"),new SegmentPoint(k,this,"_handleOut"),l&&this.setSelection(l)},_serialize:function(a,b){var c=this._point,d=this._selection,e=d||this.hasHandles()?[c,this._handleIn,this._handleOut]:c;return d&&e.push(d),Base.serialize(e,a,!0,b)},_changed:function(a){var b=this._path;if(b){var e,c=b._curves,d=this._index;c&&(a&&a!==this._point&&a!==this._handleIn||!(e=d>0?c[d-1]:b._closed?c[c.length-1]:null)||e._changed(),a&&a!==this._point&&a!==this._handleOut||!(e=c[d])||e._changed()),b._changed(25)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(Point.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(Point.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(Point.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(a){var b=this._selection,c=this._path;this._selection=a=a||0,c&&a!==b&&(c._updateSelection(this,b,a),c._changed(129))},changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){return!!(7&this._selection)},setSelected:function(a){this.changeSelection(7,a)},getIndex:function(){return void 0!==this._index?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var a=this._path,b=this._index;return a?(b>0&&!a._closed&&b===a._segments.length-1&&b--,a.getCurves()[b]||null):null},getLocation:function(){var a=this.getCurve();return a?new CurveLocation(a,this===a._segment1?0:1):null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},smooth:function(a,b,c){var d=a||{},e=d.type,f=d.factor,g=this.getPrevious(),h=this.getNext(),i=(g||this)._point,j=this._point,k=(h||this)._point,l=i.getDistance(j),m=j.getDistance(k);if(e&&"catmull-rom"!==e){if("geometric"!==e)throw new Error("Smoothing method '"+e+"' not supported.");if(g&&h){var u=i.subtract(k),v=void 0===f?.4:f,w=v*l/(l+m);b||this.setHandleIn(u.multiply(w)),c||this.setHandleOut(u.multiply(w-v))}}else{var n=void 0===f?.5:f,o=Math.pow(l,n),p=o*o,q=Math.pow(m,n),r=q*q;if(!b&&g){var s=2*r+3*q*o+p,t=3*q*(q+o);this.setHandleIn(0!==t?new Point((r*i._x+s*j._x-p*k._x)/t-j._x,(r*i._y+s*j._y-p*k._y)/t-j._y):new Point)}if(!c&&h){var s=2*p+3*o*q+r,t=3*o*(o+q);this.setHandleOut(0!==t?new Point((p*k._x+s*j._x-r*i._x)/t-j._x,(p*k._y+s*j._y-r*i._y)/t-j._y):new Point)}}},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var a=this._path;return a&&this._index===a._segments.length-1||!1},reverse:function(){var a=this._handleIn,b=this._handleOut,c=a.clone();a.set(b),b.set(c)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},transform:function(a){this._transformCoordinates(a,new Array(6),!0),this._changed()},_transformCoordinates:function(a,b,c){var d=this._point,e=c&&this._handleIn.isZero()?null:this._handleIn,f=c&&this._handleOut.isZero()?null:this._handleOut,g=d._x,h=d._y,i=2;return b[0]=g,b[1]=h,e&&(b[i++]=e._x+g,b[i++]=e._y+h),f&&(b[i++]=f._x+g,b[i++]=f._y+h),a&&(a._transformCoordinates(b,b,i/2),g=b[0],h=b[1],c?(d._x=g,d._y=h,i=2,e&&(e._x=b[i++]-g,e._y=b[i++]-h),f&&(f._x=b[i++]-g,f._y=b[i++]-h)):(e||(b[i++]=g,b[i++]=h),f||(b[i++]=g,b[i++]=h))),b}}),SegmentPoint=Point.extend({initialize:function(b,c,d){var e,f,g;if(b)if(void 0!==(e=b[0]))f=b[1];else{var h=b;void 0===(e=h.x)&&(h=Point.read(arguments),e=h.x),f=h.y,g=h.selected}else e=f=0;this._x=e,this._y=f,this._owner=c,c[d]=this,g&&this.setSelected(!0)},_set:function(a,b){return this._x=a,this._y=b,this._owner._changed(this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner.changeSelection(this._getSelection(),a)},_getSelection:function(){var a=this._owner;return this===a._point?1:this===a._handleIn?2:this===a._handleOut?4:0}}),Curve=Base.extend({_class:"Curve",initialize:function(b,c,d,e,f,g,h,i){var k,l,m,n,o,p,j=arguments.length;3===j?(this._path=b,k=c,l=d):j?1===j?"segment1"in b?(k=new Segment(b.segment1),l=new Segment(b.segment2)):"point1"in b?(m=b.point1,o=b.handle1,p=b.handle2,n=b.point2):Array.isArray(b)&&(m=[b[0],b[1]],n=[b[6],b[7]],o=[b[2]-b[0],b[3]-b[1]],p=[b[4]-b[6],b[5]-b[7]]):2===j?(k=new Segment(b),l=new Segment(c)):4===j?(m=b,o=c,p=d,n=e):8===j&&(m=[b,c],n=[h,i],o=[d-b,e-c],p=[f-h,g-i]):(k=new Segment,l=new Segment),this._segment1=k||new Segment(m,null,o),this._segment2=l||new Segment(n,p,null)},_serialize:function(a,b){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],a,!0,b)},_changed:function(){this._length=this._bounds=void 0},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn),a.push("point2: "+this._segment2._point),"{ "+a.join(", ")+" }"},remove:function(){var a=!1;if(this._path){var b=this._segment2,c=b._handleOut;a=b.remove(),a&&this._segment1._handleOut.set(c)}return a},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(Point.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(Point.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(Point.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(Point.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var a=this._path;return a&&this._segment1._index===a._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(a){this.getPoint1().setSelected(a),this.getHandle1().setSelected(a),this.getHandle2().setSelected(a),this.getPoint2().setSelected(a)},getValues:function(a){return Curve.getValues(this._segment1,this._segment2,a)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;c<8;c+=2)b.push(new Point(a[c],a[c+1]));return b},getLength:function(){return null==this._length&&(this._length=Curve.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(a,b){return new Curve(Curve.getPart(this.getValues(),a,b))},getPartLength:function(a,b){return Curve.getLength(this.getValues(),a,b)},getIntersections:function(a){return Curve._getIntersections(this.getValues(),a&&a!==this?a.getValues():null,this,a,[],{})},divideAt:function(a){return this.divideAtTime(a&&a.curve===this?a.time:a)},divideAtTime:function(a,b){var c=4e-7,d=1-c,e=null;if(a>=c&&a<=d){var f=Curve.subdivide(this.getValues(),a),g=f[0],h=f[1],i=b||this.hasHandles(),j=this._segment1,k=this._segment2,l=this._path;i&&(j._handleOut._set(g[2]-g[0],g[3]-g[1]),k._handleIn._set(h[4]-h[6],h[5]-h[7]));var m=g[6],n=g[7],o=new Segment(new Point(m,n),i&&new Point(g[4]-m,g[5]-n),i&&new Point(h[2]-m,h[3]-n));l?(l.insert(j._index+1,o),e=this.getNext()):(this._segment2=o,this._changed(),e=new Curve(o,k))}return e},splitAt:function(a){return this._path?this._path.splitAt(a):null},splitAtTime:function(a){return this.splitAt(this.getLocationAtTime(a))},divide:function(a,b){return this.divideAtTime(void 0===a?.5:b?a:this.getTimeAt(a))},split:function(a,b){return this.splitAtTime(void 0===a?.5:b?a:this.getTimeAt(a))},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(a,b,c){var d=a._point,e=a._handleOut,f=b._handleIn,g=b._point,h=[d._x,d._y,d._x+e._x,d._y+e._y,g._x+f._x,g._y+f._y,g._x,g._y];return c&&c._transformCoordinates(h,h,4),h},subdivide:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7];void 0===b&&(b=.5);var k=1-b,l=k*c+b*e,m=k*d+b*f,n=k*e+b*g,o=k*f+b*h,p=k*g+b*i,q=k*h+b*j,r=k*l+b*n,s=k*m+b*o,t=k*n+b*p,u=k*o+b*q,v=k*r+b*t,w=k*s+b*u;return[[c,d,l,m,r,s,v,w],[v,w,t,u,p,q,i,j]]},getMonoCurves:function(a,b){var c=[],d=b?0:1,e=a[d],f=a[d+2],g=a[d+4],h=a[d+6];if(e>=f==f>=g&&f>=g==g>=h||Curve.isStraight(a))c.push(a);else{var i=3*(f-g)-e+h,j=2*(e+g)-4*f,k=f-e,l=4e-7,m=1-l,n=[],o=Numerical.solveQuadratic(i,j,k,n,l,m);if(o){n.sort();var p=n[0],q=Curve.subdivide(a,p);c.push(q[0]),o>1&&(p=(n[1]-p)/(1-p),q=Curve.subdivide(q[1],p),c.push(q[0])),c.push(q[1])}else c.push(a)}return c},solveCubic:function(a,b,c,d,e,f){var g=a[b],h=a[b+2],i=a[b+4],j=a[b+6],k=0;if(!(g<c&&j<c&&h<c&&i<c||g>c&&j>c&&h>c&&i>c)){var l=3*(h-g),m=3*(i-h)-l,n=j-g-l-m;k=Numerical.solveCubic(n,m,l,g-c,d,e,f)}return k},getTimeOf:function(a,b){var c=new Point(a[0],a[1]),d=new Point(a[6],a[7]),e=1e-12,f=b.isClose(c,e)?0:b.isClose(d,e)?1:null;if(null!==f)return f;for(var g=[b.x,b.y],h=[],i=1e-7,j=0;j<2;j++)for(var k=Curve.solveCubic(a,j,g[j],h,0,1),l=0;l<k;l++)if(f=h[l],b.isClose(Curve.getPoint(a,f),i))return f;return b.isClose(c,i)?0:b.isClose(d,i)?1:null},getNearestTime:function(a,b){function n(c){if(c>=0&&c<=1){var d=b.getDistance(Curve.getPoint(a,c),!0);if(d<l)return l=d,m=c,!0}}if(Curve.isStraight(a)){var c=a[0],d=a[1],e=a[6],f=a[7],g=e-c,h=f-d,i=g*g+h*h;if(0===i)return 0;var j=((b.x-c)*g+(b.y-d)*h)/i;return j<1e-12?0:j>.999999999999?1:Curve.getTimeOf(a,new Point(c+j*g,d+j*h))}for(var k=100,l=1/0,m=0,o=0;o<=k;o++)n(o/k);for(var p=1/(2*k);p>4e-7;)n(m-p)||n(m+p)||(p/=2);return m},getPart:function(a,b,c){var d=b>c;if(d){var e=b;b=c,c=e}return b>0&&(a=Curve.subdivide(a,b)[1]),c<1&&(a=Curve.subdivide(a,(c-b)/(1-b))[0]),d?[a[6],a[7],a[4],a[5],a[2],a[3],a[0],a[1]]:a},isFlatEnough:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=3*e-2*c-i,l=3*f-2*d-j,m=3*g-2*i-c,n=3*h-2*j-d;return Math.max(k*k,m*m)+Math.max(l*l,n*n)<=16*b*b},getArea:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7];return 3*((i-c)*(d+f)-(h-b)*(e+g)+e*(b-f)-d*(c-g)+i*(f+b/3)-h*(g+c/3))/20},getBounds:function(a){for(var b=a.slice(0,2),c=b.slice(),d=[0,0],e=0;e<2;e++)Curve._addBounds(a[e],a[e+2],a[e+4],a[e+6],e,0,b,c,d);return new Rectangle(b[0],b[1],c[0]-b[0],c[1]-b[1])},_addBounds:function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=a-b,d=a+b;c<g[e]&&(g[e]=c),d>h[e]&&(h[e]=d)}f/=2;var k=g[e]-f,l=h[e]+f;if(a<k||b<k||c<k||d<k||a>l||b>l||c>l||d>l)if(b<a!=b<d&&c<a!=c<d)j(a,f),j(d,f);else{var m=3*(b-c)-a+d,n=2*(a+c)-4*b,o=b-a,p=Numerical.solveQuadratic(m,n,o,i),q=4e-7,r=1-q;j(d,0);for(var s=0;s<p;s++){var t=i[s],u=1-t;q<t&&t<r&&j(u*u*u*a+3*u*u*t*b+3*u*t*t*c+t*t*t*d,f)}}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds"],function(a){this[a]=function(){this._bounds||(this._bounds={});var b=this._bounds[a];return b||(b=this._bounds[a]=Path[a]([this._segment1,this._segment2],!1,this._path)),b.clone()}},{}),Base.each({isStraight:function(a,b,c){if(b.isZero()&&c.isZero())return!0;var d=a.getVector(),e=1e-7;if(d.isZero())return!1;if(a.getDistance(b)<e&&a.getDistance(c)<e){var f=d.dot(d),g=d.dot(b)/f,h=d.dot(c)/f;return g>=0&&g<=1&&h<=0&&h>=-1}return!1},isLinear:function(a,b,c){var d=a.getVector().divide(3);return b.equals(d)&&c.negate().equals(d)}},function(a,b){this[b]=function(){var b=this._segment1,c=this._segment2;return a(new Line(b._point,c._point),b._handleOut,c._handleIn)},this.statics[b]=function(b){var c=b[0],d=b[1],e=b[6],f=b[7];return a(new Line(c,d,e,f),new Point(b[2]-c,b[3]-d),new Point(b[4]-e,b[5]-f))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(a){return a&&this.isStraight()&&a.isStraight()&&this.getLine().isCollinear(a.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(a,b){return this.getLocationAtTime(b?a:this.getTimeAt(a))},getLocationAtTime:function(a){return null!=a&&a>=0&&a<=1?new CurveLocation(this,a):null},getTimeAt:function(a,b){return Curve.getTimeAt(this.getValues(),a,b)},getParameterAt:"#getTimeAt",getOffsetAtTime:function(a){return this.getPartLength(0,a)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(Point.read(arguments)))},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getTimeOf:function(){return Curve.getTimeOf(this.getValues(),Point.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var a=Point.read(arguments),b=this.getValues(),c=Curve.getNearestTime(b,a),d=Curve.getPoint(b,c);return new CurveLocation(this,c,d,null,a.getDistance(d))},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a}},new function(){var a=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(a,function(a){this[a+"At"]=function(b,c){var d=this.getValues();return Curve[a](d,c?b:Curve.getTimeAt(d,b))},this[a+"AtTime"]=function(b){return Curve[a](this.getValues(),b)}},{statics:{_evaluateMethods:a}})},new function(){function a(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=9*(d-f)+3*(h-b),k=6*(b+f)-12*d,l=3*(d-b),m=9*(e-g)+3*(i-c),n=6*(c+g)-12*e,o=3*(e-c);return function(a){var b=(j*a+k)*a+l,c=(m*a+n)*a+o;return Math.sqrt(b*b+c*c)}}function b(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}function c(a,b,c,d){if(null==b||b<0||b>1)return null;var e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7],m=Numerical.isZero;m(g-e)&&m(h-f)&&(g=e,h=f),m(i-k)&&m(j-l)&&(i=k,j=l);var t,u,n=3*(g-e),o=3*(i-g)-n,p=k-e-n-o,q=3*(h-f),r=3*(j-h)-q,s=l-f-q-r;if(0===c)t=0===b?e:1===b?k:((p*b+o)*b+n)*b+e,u=0===b?f:1===b?l:((s*b+r)*b+q)*b+f;else{var v=4e-7,w=1-v;if(b<v?(t=n,u=q):b>w?(t=3*(k-i),u=3*(l-j)):(t=(3*p*b+2*o)*b+n,u=(3*s*b+2*r)*b+q),d){0===t&&0===u&&(b<v||b>w)&&(t=i-g,u=j-h);var x=Math.sqrt(t*t+u*u);x&&(t/=x,u/=x)}if(3===c){var y=6*p*b+2*o,z=6*s*b+2*r,A=Math.pow(t*t+u*u,1.5);t=0!==A?(t*z-u*y)/A:0,u=0}}return 2===c?new Point(u,(-t)):new Point(t,u)}return{statics:{getLength:function(c,d,e,f){if(void 0===d&&(d=0),void 0===e&&(e=1),Curve.isStraight(c)){var g=c;e<1&&(g=Curve.subdivide(g,e)[0],d/=e),d>0&&(g=Curve.subdivide(g,d)[1]);var h=g[6]-g[0],i=g[7]-g[1];return Math.sqrt(h*h+i*i)}return Numerical.integrate(f||a(c),d,e,b(d,e))},getTimeAt:function(c,d,e){function p(a){return o+=Numerical.integrate(k,e,a,b(e,a)),e=a,o-d}if(void 0===e&&(e=d<0?1:0),0===d)return e;var f=Math.abs,g=1e-12,h=d>0,i=h?e:0,j=h?1:e,k=a(c),l=Curve.getLength(c,i,j,k),m=f(d)-l;if(f(m)<g)return h?j:i;if(m>g)return null;var n=d/l,o=0;return Numerical.findRoot(p,k,e+n,i,j,32,1e-12)},getPoint:function(a,b){return c(a,b,0,!1)},getTangent:function(a,b){return c(a,b,1,!0)},getWeightedTangent:function(a,b){return c(a,b,1,!1)},getNormal:function(a,b){return c(a,b,2,!0)},getWeightedNormal:function(a,b){return c(a,b,2,!1)},getCurvature:function(a,b){return c(a,b,3,!1).x}}}},new function(){function a(a,b,c,d,e,f,g,h,i,j,k){var l=!k&&b.excludeStart,m=!k&&b.excludeEnd,n=4e-7,o=1-n;if(null==e&&(e=Curve.getTimeOf(c,f)),null!==e&&e>=(l?n:0)&&e<=(m?o:1)&&(null==i&&(i=Curve.getTimeOf(g,j)),null!==i&&i>=(m?n:0)&&i<=(l?o:1))){var p=b.renormalize;if(p){var q=p(e,i);e=q[0],i=q[1]}var r=new CurveLocation(d,e,f||Curve.getPoint(c,e),k),s=new CurveLocation(h,i,j||Curve.getPoint(g,i),k),t=r.getPath()===s.getPath()&&r.getIndex()>s.getIndex(),u=t?s:r,v=b.include;r._intersection=s,s._intersection=r,v&&!v(u)||CurveLocation.insert(a,u,!0)}}function b(e,f,g,h,i,j,k,l,m,n,o,p,q){if(++p>=48||++q>4096)return q;var I,J,r=f[0],s=f[1],t=f[6],u=f[7],v=Line.getSignedDistance,w=v(r,s,t,u,f[2],f[3]),x=v(r,s,t,u,f[4],f[5]),y=w*x>0?.75:4/9,z=y*Math.min(0,w,x),A=y*Math.max(0,w,x),B=v(r,s,t,u,e[0],e[1]),C=v(r,s,t,u,e[2],e[3]),D=v(r,s,t,u,e[4],e[5]),E=v(r,s,t,u,e[6],e[7]),F=c(B,C,D,E),G=F[0],H=F[1];if(0===w&&0===x&&0===B&&0===C&&0===D&&0===E||null==(I=d(G,H,z,A))||null==(J=d(G.reverse(),H.reverse(),z,A)))return q;var K=k+(l-k)*I,L=k+(l-k)*J;if(Math.max(n-m,L-K)<1e-10){var M=(K+L)/2,N=(m+n)/2;e=g.getValues(),f=h.getValues(),a(i,j,o?f:e,o?h:g,o?N:M,null,o?e:f,o?g:h,o?M:N,null)}else if(e=Curve.getPart(e,I,J),J-I>.8)if(L-K>n-m){var O=Curve.subdivide(e,.5),M=(K+L)/2;q=b(f,O[0],h,g,i,j,m,n,K,M,!o,p,q),q=b(f,O[1],h,g,i,j,m,n,M,L,!o,p,q)}else{var O=Curve.subdivide(f,.5),N=(m+n)/2;q=b(O[0],e,h,g,i,j,m,N,K,L,!o,p,q),q=b(O[1],e,h,g,i,j,N,n,K,L,!o,p,q)}else q=n-m>=1e-10?b(f,e,h,g,i,j,m,n,K,L,!o,p,q):b(e,f,g,h,i,j,K,L,m,n,o,p,q);
return q}function c(a,b,c,d){var k,e=[0,a],f=[1/3,b],g=[2/3,c],h=[1,d],i=b-(2*a+d)/3,j=c-(a+2*d)/3;if(i*j<0)k=[[e,f,h],[e,g,h]];else{var l=i/j;k=[l>=2?[e,f,h]:l<=.5?[e,g,h]:[e,f,g,h],[e,h]]}return(i||j)<0?k.reverse():k}function d(a,b,c,d){return a[0][1]<c?e(a,!0,c):b[0][1]>d?e(b,!1,d):a[0][0]}function e(a,b,c){for(var d=a[0][0],e=a[0][1],f=1,g=a.length;f<g;f++){var h=a[f][0],i=a[f][1];if(b?i>=c:i<=c)return i===c?h:d+(c-e)*(h-d)/(i-e);d=h,e=i}return null}function f(b,c,d,e,f,g){for(var h=Curve.isStraight(b),i=h?c:b,j=h?b:c,k=j[0],l=j[1],m=j[6],n=j[7],o=m-k,p=n-l,q=Math.atan2(-p,o),r=Math.sin(q),s=Math.cos(q),t=[],u=0;u<8;u+=2){var v=i[u]-k,w=i[u+1]-l;t.push(v*s-w*r,v*r+w*s)}for(var x=[],y=Curve.solveCubic(t,1,0,x,0,1),u=0;u<y;u++){var z=x[u],A=Curve.getPoint(i,z),B=Curve.getTimeOf(j,A);if(null!==B){var C=Curve.getPoint(j,B),D=h?B:z,E=h?z:B;(!g.excludeEnd||E>Numerical.CURVETIME_EPSILON)&&a(f,g,b,d,D,h?C:A,c,e,E,h?A:C)}}}function g(b,c,d,e,f,g){var h=Line.intersect(b[0],b[1],b[6],b[7],c[0],c[1],c[6],c[7]);h&&a(f,g,b,d,null,h,c,e,null,h)}return{statics:{_getIntersections:function(c,d,e,h,i,j){if(!d)return Curve._getSelfIntersection(c,e,i,j);var k=1e-7,l=c[0],m=c[1],n=c[6],o=c[7],p=d[0],q=d[1],r=d[6],s=d[7],t=(3*c[2]+l)/4,u=(3*c[3]+m)/4,v=(3*c[4]+n)/4,w=(3*c[5]+o)/4,x=(3*d[2]+p)/4,y=(3*d[3]+q)/4,z=(3*d[4]+r)/4,A=(3*d[5]+s)/4,B=Math.min,C=Math.max;if(!(C(l,t,v,n)+k>B(p,x,z,r)&&B(l,t,v,n)-k<C(p,x,z,r)&&C(m,u,w,o)+k>B(q,y,A,s)&&B(m,u,w,o)-k<C(q,y,A,s)))return i;var D=Curve.getOverlaps(c,d);if(D){for(var E=0;E<2;E++){var F=D[E];a(i,j,c,e,F[0],null,d,h,F[1],null,!0)}return i}var G=Curve.isStraight(c),H=Curve.isStraight(d),I=G&&H,J=i.length;if((I?g:G||H?f:b)(c,d,e,h,i,j,0,1,0,1,0,0,0),I&&i.length>J)return i;var K=new Point(l,m),L=new Point(n,o),M=new Point(p,q),N=new Point(r,s);return K.isClose(M,k)&&a(i,j,c,e,0,K,d,h,0,M),!j.excludeStart&&K.isClose(N,k)&&a(i,j,c,e,0,K,d,h,1,N),!j.excludeEnd&&L.isClose(M,k)&&a(i,j,c,e,1,L,d,h,0,M),L.isClose(N,k)&&a(i,j,c,e,1,L,d,h,1,N),i},_getSelfIntersection:function(a,b,c,d){var e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7],m=new Line(e,f,k,l,(!1)),n=m.getSide(new Point(g,h),!0),o=m.getSide(new Point(i,j),!0);if(n===o){var p=(e-i)*(h-l)+(g-k)*(j-f);if(p*n>0)return c}var q=k-3*i+3*g-e,r=i-2*g+e,s=g-e,t=l-3*j+3*h-f,u=j-2*h+f,v=h-f,w=t*s-q*v,x=t*r-q*u,y=u*s-r*v;if(w*w-4*x*y<0){var A,z=[],B=Numerical.solveCubic(q*q+t*t,3*(q*r+t*u),2*(r*r+u*u)+q*s+t*v,r*s+u*v,z,0,1);if(B>0){for(var C=0,D=0;C<B;C++){var E=Math.abs(b.getCurvatureAtTime(z[C]));E>D&&(D=E,A=z[C])}var F=Curve.subdivide(a,A);d.excludeEnd=!0,d.renormalize=function(a,b){return[a*A,b*(1-A)+A]},Curve._getIntersections(F[0],F[1],b,b,c,d)}}return c},getOverlaps:function(a,b){function i(a){var b=a[6]-a[0],c=a[7]-a[1];return b*b+c*c}var c=Math.abs,d=4e-7,e=1e-7,f=Curve.isStraight(a),g=Curve.isStraight(b),h=f&&g,j=i(a)<i(b),k=j?b:a,l=j?a:b,m=new Line(k[0],k[1],k[6],k[7]);if(m.getDistance(new Point(l[0],l[1]))<e&&m.getDistance(new Point(l[6],l[7]))<e)!h&&m.getDistance(new Point(k[2],k[3]))<e&&m.getDistance(new Point(k[4],k[5]))<e&&m.getDistance(new Point(l[2],l[3]))<e&&m.getDistance(new Point(l[4],l[5]))<e&&(f=g=h=!0);else if(h)return null;if(f^g)return null;for(var n=[a,b],o=[],p=0,q=0;p<2&&o.length<2;p+=0===q?0:1,q=1^q){var r=Curve.getTimeOf(n[1^p],new Point(n[p][0===q?0:6],n[p][0===q?1:7]));if(null!=r){var s=0===p?[q,r]:[r,q];(!o.length||c(s[0]-o[0][0])>d&&c(s[1]-o[0][1])>d)&&o.push(s)}if(1===p&&!o.length)break}if(2!==o.length)o=null;else if(!h){var t=Curve.getPart(a,o[0][0],o[1][0]),u=Curve.getPart(b,o[0][1],o[1][1]);(c(u[2]-t[2])>e||c(u[3]-t[3])>e||c(u[4]-t[4])>e||c(u[5]-t[5])>e)&&(o=null)}return o}}}}),CurveLocation=Base.extend({_class:"CurveLocation",beans:!0,initialize:function(b,c,d,e,f){if(c>.9999996){var g=b.getNext();g&&(c=0,b=g)}this._setCurve(b),this._time=c,this._point=d||b.getPointAtTime(c),this._overlap=e,this._distance=f,this._intersection=this._next=this._previous=null},_setCurve:function(a){var b=a._path;this._path=b,this._version=b?b._version:0,this._curve=a,this._segment=null,this._segment1=a._segment1,this._segment2=a._segment2},_setSegment:function(a){this._setCurve(a.getCurve()),this._segment=a,this._time=a===this._segment1?0:1,this._point=a._point.clone()},getSegment:function(){var a=this.getCurve(),b=this._segment;if(!b){var c=this.getTime();0===c?b=a._segment1:1===c?b=a._segment2:null!=c&&(b=a.getPartLength(0,c)<a.getPartLength(c,1)?a._segment1:a._segment2),this._segment=b}return b},getCurve:function(){function c(a){var c=a&&a.getCurve();if(c&&null!=(b._time=c.getTimeOf(b._point)))return b._setCurve(c),b._segment=a,c}var a=this._path,b=this;return a&&a._version!==this._version&&(this._time=this._curve=this._offset=null),this._curve||c(this._segment)||c(this._segment1)||c(this._segment2.getPrevious())},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getTime:function(){var a=this.getCurve(),b=this._time;return a&&null==b?this._time=a.getTimeOf(this._point):b},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var a=this._offset;if(null==a){a=0;var b=this.getPath(),c=this.getIndex();if(b&&null!=c)for(var d=b.getCurves(),e=0;e<c;e++)a+=d[e].getLength();this._offset=a+=this.getCurveOffset()}return a},getCurveOffset:function(){var a=this.getCurve(),b=this.getTime();return null!=b&&a&&a.getPartLength(0,b)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve(),b=null;return a&&(b=a.divideAtTime(this.getTime()),b&&this._setSegment(b._segment1)),b},split:function(){var a=this.getCurve();return a?a.splitAtTime(this.getTime()):null},equals:function(a,b){var c=this===a,d=1e-7;if(!c&&a instanceof CurveLocation&&this.getPath()===a.getPath()&&this.getPoint().isClose(a.getPoint(),d)){var e=this.getCurve(),f=a.getCurve(),g=Math.abs,h=g((e.isLast()&&f.isFirst()?-1:e.getIndex())+this.getTime()-((f.isLast()&&e.isFirst()?-1:f.getIndex())+a.getTime()));c=(h<4e-7||(h=g(this.getOffset()-a.getOffset()))<d||g(this.getPath().getLength()-h)<d)&&(b||!this._intersection&&!a._intersection||this._intersection&&this._intersection.equals(a._intersection,!0))}return c},toString:function(){var a=[],b=this.getPoint(),c=Formatter.instance;b&&a.push("point: "+b);var d=this.getIndex();null!=d&&a.push("index: "+d);var e=this.getTime();return null!=e&&a.push("time: "+c.number(e)),null!=this._distance&&a.push("distance: "+c.number(this._distance)),"{ "+a.join(", ")+" }"},isTouching:function(){var a=this._intersection;if(a&&this.getTangent().isCollinear(a.getTangent())){var b=this.getCurve(),c=a.getCurve();return!(b.isStraight()&&c.isStraight()&&b.getLine().intersect(c.getLine()))}return!1},isCrossing:function(){function l(a,b,c){return b<c?a>b&&a<c:a>b||a<c}var a=this._intersection;if(!a)return!1;var b=this.getTime(),c=a.getTime(),d=4e-7,e=1-d,f=b>d&&b<e,g=c>d&&c<e;if(f&&g)return!this.isTouching();var h=this.getCurve(),i=b<=d?h.getPrevious():h,j=a.getCurve(),k=c<=d?j.getPrevious():j;if(b>=e&&(h=h.getNext()),c>=e&&(j=j.getNext()),!(i&&h&&k&&j))return!1;var m=[];f||m.push(i.getLength(),h.getLength()),g||m.push(k.getLength(),j.getLength());var n=this.getPoint(),o=Math.min.apply(Math,m)/64,p=f?h.getTangentAtTime(b):h.getPointAt(o).subtract(n),q=f?p.negate():i.getPointAt(-o).subtract(n),r=g?j.getTangentAtTime(c):j.getPointAt(o).subtract(n),s=g?r.negate():k.getPointAt(-o).subtract(n),t=q.getAngle(),u=p.getAngle(),v=s.getAngle(),w=r.getAngle();return!!(f?l(t,v,w)^l(u,v,w)&&l(t,w,v)^l(u,w,v):l(v,t,u)^l(w,t,u)&&l(v,u,t)^l(w,u,t))},hasOverlap:function(){return!!this._overlap}},Base.each(Curve._evaluateMethods,function(a){var b=a+"At";this[a]=function(){var a=this.getCurve(),c=this.getTime();return null!=c&&a&&a[b](c,!0)}},{preserve:!0}),new function(){function a(a,b,c){function g(c,e){for(var f=c+e;f>=-1&&f<=d;f+=e){var g=a[(f%d+d)%d];if(!b.getPoint().isClose(g.getPoint(),1e-7))break;if(b.equals(g))return g}return null}for(var d=a.length,e=0,f=d-1;e<=f;){var j,h=e+f>>>1,i=a[h];if(c&&(j=b.equals(i)?i:g(h,-1)||g(h,1)))return b._overlap&&(j._overlap=j._intersection._overlap=!0),j;var k=b.getPath(),l=i.getPath(),m=k!==l?k._id-l._id:b.getIndex()+b.getTime()-(i.getIndex()+i.getTime());m<0?f=h-1:e=h+1}return a.splice(e,0,b),b}return{statics:{insert:a,expand:function(b){for(var c=b.slice(),d=b.length-1;d>=0;d--)a(c,b[d]._intersection,!1);return c}}}}),PathItem=Item.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,initialize:function(){},statics:{create:function(a){var b,c,d;if(Base.isPlainObject(a)?(c=a.segments,b=a.pathData):Array.isArray(a)?c=a:"string"==typeof a&&(b=a),c){var e=c[0];d=e&&Array.isArray(e[0])}else b&&(d=(b.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(b));var f=d?CompoundPath:Path;return new f(a)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(a){this.isClockwise()!=(a=!!a)&&this.reverse()},setPathData:function(a){function i(a,b){var e=+c[a];return d&&(e+=g[b]),e}function j(a){return new Point(i(a,"x"),i(a+1,"y"))}var c,e,f,b=a&&a.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),d=!1,g=new Point,h=new Point;this.clear();for(var k=0,l=b&&b.length;k<l;k++){var m=b[k],n=m[0],o=n.toLowerCase();c=m.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var p=c&&c.length;switch(d=n===o,"z"!==e||/[mz]/.test(o)||this.moveTo(g),o){case"m":case"l":for(var q="m"===o,r=0;r<p;r+=2)this[!r&&q?"moveTo":"lineTo"](g=j(r));f=g,q&&(h=g);break;case"h":case"v":var s="h"===o?"x":"y";g=g.clone();for(var r=0;r<p;r++)g[s]=i(r,s),this.lineTo(g);f=g;break;case"c":for(var r=0;r<p;r+=6)this.cubicCurveTo(j(r),f=j(r+2),g=j(r+4));break;case"s":for(var r=0;r<p;r+=4)this.cubicCurveTo(/[cs]/.test(e)?g.multiply(2).subtract(f):g,f=j(r),g=j(r+2)),e=o;break;case"q":for(var r=0;r<p;r+=4)this.quadraticCurveTo(f=j(r),g=j(r+2));break;case"t":for(var r=0;r<p;r+=2)this.quadraticCurveTo(f=/[qt]/.test(e)?g.multiply(2).subtract(f):g,g=j(r)),e=o;break;case"a":for(var r=0;r<p;r+=7)this.arcTo(g=j(r+5),new Size((+c[r]),(+c[r+1])),+c[r+2],+c[r+4],+c[r+3]);break;case"z":this.closePath(1e-12),g=h}e=o}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(a){var b=a.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(a):{};return!!("evenodd"===this.getFillRule()?1&b.windingL||1&b.windingR:b.winding)},getIntersections:function(a,b,c,d){var e=this===a||!a,f=this._matrix._orNullIfIdentity(),g=e?f:(c||a._matrix)._orNullIfIdentity();if(!e&&!this.getBounds(f).touches(a.getBounds(g)))return[];for(var n,a,h=this.getCurves(),i=e?h:a.getCurves(),j=h.length,k=e?j:i.length,l=[],m=[],o=0;o<k;o++)l[o]=i[o].getValues(g);for(var o=0;o<j;o++){var p=h[o],q=e?l[o]:p.getValues(f),r=p.getPath();r!==a&&(a=r,n=[],m.push(n)),e&&Curve._getSelfIntersection(q,p,n,{include:b,excludeStart:1===j&&p.getPoint1().equals(p.getPoint2())});for(var s=e?o+1:0;s<k;s++){if(d&&n.length)return n;var t=i[s];Curve._getIntersections(q,l[s],p,t,n,{include:b,excludeStart:e&&p.getPrevious()===t,excludeEnd:e&&p.getNext()===t})}}n=[];for(var o=0,u=m.length;o<u;o++)n.push.apply(n,m[o]);return n},getCrossings:function(a){return this.getIntersections(a,function(a){return a._overlap||a.isCrossing()})},getNearestLocation:function(){for(var a=Point.read(arguments),b=this.getCurves(),c=1/0,d=null,e=0,f=b.length;e<f;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a},interpolate:function(a,b,c){var d=!this._children,e=d?"_segments":"_children",f=a[e],g=b[e],h=this[e];if(!f||!g||f.length!==g.length)throw new Error("Invalid operands in interpolate() call: "+a+", "+b);var i=h.length,j=g.length;if(i<j)for(var k=d?Segment:Path,l=i;l<j;l++)this.add(new k);else i>j&&this[d?"removeSegments":"removeChildren"](j,i);for(var l=0;l<j;l++)h[l].interpolate(f[l],g[l],c);d&&(this.setClosed(a._closed),this._changed(9))},compare:function(a){var b=!1;if(a){var h,c=this._children||[this],d=a._children.slice()||[a],e=c.length,f=d.length,g=[];b=!0;for(var i=e-1;i>=0&&b;i--){var j=c[i];b=!1;for(var k=f-1;k>=0&&!b;k--)j.compare(d[k])&&(g[k]||(g[k]=!0,h++),b=!0)}b=b&&h===f}return b}}),Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(b){this._closed=!1,this._segments=[],this._version=0;var c=Array.isArray(b)?"object"==typeof b[0]?b:arguments:!b||void 0!==b.size||void 0===b.x&&void 0===b.point?null:arguments;c&&c.length>0?this.setSegments(c):(this._curves=void 0,this._segmentSelection=0,c||"string"!=typeof b||(this.setPathData(b),b=null)),this._initialize(!c&&b)},_equals:function(a){return this._closed===a._closed&&Base.equals(this._segments,a._segments)},copyContent:function(a){this.setSegments(a._segments),this._closed=a._closed},_changed:function a(b){if(a.base.call(this,b),8&b){if(this._length=this._area=void 0,16&b)this._version++;else if(this._curves)for(var c=0,d=this._curves.length;c<d;c++)this._curves[c]._changed()}else 32&b&&(this._bounds=void 0)},getStyle:function(){var a=this._parent;return(a instanceof CompoundPath?a:this)._style},getSegments:function(){return this._segments},setSegments:function(a){var b=this.isFullySelected(),c=a&&a.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=void 0,c){var d=a[c-1];"boolean"==typeof d&&(this.setClosed(d),c--),this._add(Segment.readList(a,0,{},c))}b&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,b=this._segments;if(!a){var c=this._countCurves();a=this._curves=new Array(c);for(var d=0;d<c;d++)a[d]=new Curve(this,b[d],b[d+1]||b[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},isClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){if(this._closed=a,this._curves){var b=this._curves.length=this._countCurves();a&&(this._curves[b-1]=new Curve(this,this._segments[b-1],this._segments[0]))}this._changed(25)}},getFillRule:function(){return"nonzero"}},{beans:!0,getPathData:function(a,b){function q(b,c){if(b._transformCoordinates(a,f),h=f[0],i=f[1],g)p.push("M"+e.pair(h,i)),g=!1;else if(l=f[2],m=f[3],l===h&&m===i&&n===j&&o===k){if(!c){var d=h-j,q=i-k;p.push(0===d?"v"+e.number(q):0===q?"h"+e.number(d):"l"+e.pair(d,q))}}else p.push("c"+e.pair(n-j,o-k)+" "+e.pair(l-j,m-k)+" "+e.pair(h-j,i-k));j=h,k=i,n=f[4],o=f[5]}var h,i,j,k,l,m,n,o,c=this._segments,d=c.length,e=new Formatter(b),f=new Array(6),g=!0,p=[];if(!d)return"";for(var r=0;r<d;r++)q(c[r]);return this._closed&&d>0&&(q(c[0],!0),p.push("z")),p.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(a){for(var b=this._segments,c=new Array(6),d=0,e=b.length;d<e;d++)b[d]._transformCoordinates(a,c,!0);return!0},_add:function(a,b){for(var c=this._segments,d=this._curves,e=a.length,f=null==b,b=f?c.length:b,g=0;g<e;g++){var h=a[g];h._path&&(h=a[g]=h.clone()),h._path=this,h._index=b+g,h._selection&&this._updateSelection(h,0,h._selection)}if(f)c.push.apply(c,a);else{c.splice.apply(c,[b,0].concat(a));for(var g=b+e,i=c.length;g<i;g++)c[g]._index=g}if(d){var j=this._countCurves(),k=b>0&&b+e-1===j?b-1:b,l=k,m=Math.min(k+e,j);a._curves&&(d.splice.apply(d,[k,0].concat(a._curves)),l+=a._curves.length);for(var g=l;g<m;g++)d.splice(g,0,new Curve(this,null,null));this._adjustCurves(k,m)}return this._changed(25),a},_adjustCurves:function(a,b){for(var e,c=this._segments,d=this._curves,f=a;f<b;f++)e=d[f],e._path=this,e._segment1=c[f],e._segment2=c[f+1]||c[0],e._changed();(e=d[this._closed&&!a?c.length-1:a-1])&&(e._segment2=c[a]||c[0],e._changed()),(e=d[b])&&(e._segment1=c[b],e._changed())},_countCurves:function(){var a=this._segments.length;return!this._closed&&a>0?a-1:a},add:function(a){return arguments.length>1&&"number"!=typeof a?this._add(Segment.readList(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(a,b){return arguments.length>2&&"number"!=typeof b?this._add(Segment.readList(arguments,1),a):this._add([Segment.read(arguments,1)],a)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(a){return this._add([Segment.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(Segment.readList(a))},insertSegments:function(a,b){return this._add(Segment.readList(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b,c){a=a||0,b=Base.pick(b,this._segments.length);var d=this._segments,e=this._curves,f=d.length,g=d.splice(a,b-a),h=g.length;if(!h)return g;for(var i=0;i<h;i++){var j=g[i];j._selection&&this._updateSelection(j,j._selection,0),j._index=j._path=null}for(var i=a,k=d.length;i<k;i++)d[i]._index=i;if(e){for(var l=a>0&&b===f+(this._closed?1:0)?a-1:a,e=e.splice(l,h),i=e.length-1;i>=0;i--)e[i]._path=null;c&&(g._curves=e.slice(1)),this._adjustCurves(l,l)}return this._changed(25),g},clear:"#removeSegments",hasHandles:function(){for(var a=this._segments,b=0,c=a.length;b<c;b++)if(a[b].hasHandles())return!0;return!1},clearHandles:function(){for(var a=this._segments,b=0,c=a.length;b<c;b++)a[b].clearHandles()},getLength:function(){if(null==this._length){for(var a=this.getCurves(),b=0,c=0,d=a.length;c<d;c++)b+=a[c].getLength();this._length=b}return this._length},getArea:function(a){var b=void 0===a,c=this._area;if(!b||null==c){var d=this._segments,e=d.length,f=b?this._closed:a,g=e-1;c=0;for(var h=0,i=f?e:g;h<i;h++)c+=Curve.getArea(Curve.getValues(d[h],d[h<g?h+1:0]));b&&(this._area=c)}return c},isFullySelected:function(){var a=this._segments.length;return this.isSelected()&&a>0&&this._segmentSelection===7*a},setFullySelected:function(a){a&&this._selectSegments(!0),this.setSelected(a)},setSelection:function a(b){1&b||this._selectSegments(!1),a.base.call(this,b)},_selectSegments:function(a){var b=this._segments,c=b.length,d=a?7:0;this._segmentSelection=d*c;for(var e=0;e<c;e++)b[e]._selection=d},_updateSelection:function(a,b,c){a._selection=c;var d=this._segmentSelection+=c-b;d>0&&this.setSelected(!0)},splitAt:function(a){var b="number"==typeof a?this.getLocationAt(a):a,c=b&&b.index,d=b&&b.time,e=4e-7,f=1-e;d>=f&&(c++,d=0);var g=this.getCurves();if(c>=0&&c<g.length){d>=e&&g[c++].divideAtTime(d);var i,h=this.removeSegments(c,this._segments.length,!0);return this._closed?(this.setClosed(!1),i=this):(i=new Path(Item.NO_INSERT),i.insertAbove(this),i.copyAttributes(this)),i._add(h,0),this.addSegment(h[0]),i}return null},split:function(a,b){var c,d=void 0===b?a:(c=this.getCurves()[a])&&c.getLocationAtTime(b);return null!=d?this.splitAt(d):null},join:function(a,b){var c=b||0;if(a&&a!==this){var d=a._segments,e=this.getLastSegment(),f=a.getLastSegment();if(!f)return this;e&&e._point.isClose(f._point,c)&&a.reverse();var g=a.getFirstSegment();if(e&&e._point.isClose(g._point,c))e.setHandleOut(g._handleOut),this._add(d.slice(1));else{var h=this.getFirstSegment();h&&h._point.isClose(g._point,c)&&a.reverse(),f=a.getLastSegment(),h&&h._point.isClose(f._point,c)?(h.setHandleIn(f._handleIn),this._add(d.slice(0,d.length-1),0)):this._add(d.slice())}a._closed&&this._add([d[0]]),a.remove()}var i=this.getFirstSegment(),j=this.getLastSegment();return i!==j&&i._point.isClose(j._point,c)&&(i.setHandleIn(j._handleIn),j.remove(),this.setClosed(!0)),this},reduce:function(a){for(var b=this.getCurves(),c=a&&a.simplify,d=c?1e-7:0,e=b.length-1;e>=0;e--){var f=b[e];!f.hasHandles()&&(f.getLength()<d||c&&f.isCollinear(f.getNext()))&&f.remove()}return this},reverse:function(){this._segments.reverse();for(var a=0,b=this._segments.length;a<b;a++){var c=this._segments[a],d=c._handleIn;c._handleIn=c._handleOut,c._handleOut=d,c._index=a}this._curves=null,this._changed(9)},toPath:"#clone"},new function(){function a(a){var b=a._segments;if(!b.length)throw new Error("Use a moveTo() command first");return b[b.length-1]}return{moveTo:function(){var a=this._segments;1===a.length&&this.removeSegment(0),a.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var b=Point.read(arguments),c=Point.read(arguments),d=Point.read(arguments),e=a(this);e.setHandleOut(b.subtract(e._point)),this._add([new Segment(d,c.subtract(d))])},quadraticCurveTo:function(){var b=Point.read(arguments),c=Point.read(arguments),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/3)),c)},curveTo:function(){var b=Point.read(arguments),c=Point.read(arguments),d=Base.pick(Base.read(arguments),.5),e=1-d,f=a(this)._point,g=b.subtract(f.multiply(e*e)).subtract(c.multiply(d*d)).divide(2*d*e);if(g.isNaN())throw new Error("Cannot put a curve through points with parameter = "+d);this.quadraticCurveTo(g,c)},arcTo:function(){var e,h,i,j,k,b=a(this),c=b._point,d=Point.read(arguments),f=Base.peek(arguments),g=Base.pick(f,!0);if("boolean"==typeof g)var l=c.add(d).divide(2),e=l.add(l.subtract(c).rotate(g?-90:90));else if(Base.remain(arguments)<=2)e=d,d=Point.read(arguments);else{var m=Size.read(arguments),n=Numerical.isZero;if(n(m.width)||n(m.height))return this.lineTo(d);var o=Base.read(arguments),g=!!Base.read(arguments),p=!!Base.read(arguments),l=c.add(d).divide(2),q=c.subtract(l).rotate(-o),r=q.x,s=q.y,t=Math.abs,u=t(m.width),v=t(m.height),w=u*u,x=v*v,y=r*r,z=s*s,A=Math.sqrt(y/w+z/x);if(A>1&&(u*=A,v*=A,w=u*u,x=v*v),A=(w*x-w*z-x*y)/(w*z+x*y),t(A)<1e-12&&(A=0),A<0)throw new Error("Cannot create an arc with the given arguments");h=new Point(u*s/v,-v*r/u).multiply((p===g?-1:1)*Math.sqrt(A)).rotate(o).add(l),k=(new Matrix).translate(h).rotate(o).scale(u,v),j=k._inverseTransform(c),i=j.getDirectedAngle(k._inverseTransform(d)),!g&&i>0?i-=360:g&&i<0&&(i+=360)}if(e){var B=new Line(c.add(e).divide(2),e.subtract(c).rotate(90),(!0)),C=new Line(e.add(d).divide(2),d.subtract(e).rotate(90),(!0)),D=new Line(c,d),E=D.getSide(e);if(h=B.intersect(C,!0),!h){if(!E)return this.lineTo(d);throw new Error("Cannot create an arc with the given arguments")}j=c.subtract(h),i=j.getDirectedAngle(d.subtract(h));var F=D.getSide(h);0===F?i=E*Math.abs(i):E===F&&(i+=i<0?360:-360)}for(var G=Math.abs(i),H=G>=360?4:Math.ceil(G/90),I=i/H,J=I*Math.PI/360,K=4/3*Math.sin(J)/(1+Math.cos(J)),L=[],M=0;M<=H;M++){var q=d,N=null;if(M<H&&(N=j.rotate(90).multiply(K),k?(q=k._transformPoint(j),N=k._transformPoint(j.add(N)).subtract(q)):q=h.add(j)),M){var O=j.rotate(-90).multiply(K);k&&(O=k._transformPoint(j.add(O)).subtract(q)),L.push(new Segment(q,O,N))}else b.setHandleOut(N);j=j.rotate(I)}this._add(L)},lineBy:function(){var b=Point.read(arguments),c=a(this)._point;this.lineTo(c.add(b))},curveBy:function(){var b=Point.read(arguments),c=Point.read(arguments),d=Base.read(arguments),e=a(this)._point;this.curveTo(e.add(b),e.add(c),d)},cubicCurveBy:function(){var b=Point.read(arguments),c=Point.read(arguments),d=Point.read(arguments),e=a(this)._point;this.cubicCurveTo(e.add(b),e.add(c),e.add(d))},quadraticCurveBy:function(){var b=Point.read(arguments),c=Point.read(arguments),d=a(this)._point;this.quadraticCurveTo(d.add(b),d.add(c))},arcBy:function(){var b=a(this)._point,c=b.add(Point.read(arguments)),d=Base.pick(Base.peek(arguments),!0);"boolean"==typeof d?this.arcTo(c,d):this.arcTo(c,b.add(Point.read(arguments)))},closePath:function(a){this.setClosed(!0),this.join(this,a)}}}),CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(b){this._children=[],this._namedChildren={},this._initialize(b)||("string"==typeof b?this.setPathData(b):this.addChildren(Array.isArray(b)?b:arguments))},insertChildren:function a(b,c){var d=c,e=d[0];e&&"number"==typeof e[0]&&(d=[d]);for(var f=c.length-1;f>=0;f--){var g=d[f];d!==c||g instanceof Path||(d=Base.slice(d)),Array.isArray(g)?d[f]=new Path({segments:g,insert:!1}):g instanceof CompoundPath&&(d.splice.apply(d,[f,1].concat(g.removeChildren())),g.remove())}return a.base.call(this,b,d)},reduce:function a(b){for(var c=this._children,d=c.length-1;d>=0;d--){var e=c[d].reduce(b);e.isEmpty()&&e.remove()}if(!c.length){var e=new Path(Item.NO_INSERT);return e.copyAttributes(this),e.insertAbove(this),this.remove(),e}return a.base.call(this)},isClosed:function(){for(var a=this._children,b=0,c=a.length;b<c;b++)if(!a[b]._closed)return!1;return!0},setClosed:function(a){for(var b=this._children,c=0,d=b.length;c<d;c++)b[c].setClosed(a)},getFillRule:function(){return"nonzero"},getFirstSegment:function(){var a=this.getFirstChild();return a&&a.getFirstSegment()},getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;c<d;c++)b.push.apply(b,a[c].getCurves());return b},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getLastCurve()},getArea:function(){for(var a=this._children,b=0,c=0,d=a.length;c<d;c++)b+=a[c].getArea();return b},getLength:function(){for(var a=this._children,b=0,c=0,d=a.length;c<d;c++)b+=a[c].getLength();return b}},{beans:!0,getPathData:function(a,b){for(var c=this._children,d=[],e=0,f=c.length;e<f;e++){var g=c[e],h=g._matrix;d.push(g.getPathData(a&&!h.isIdentity()?a.appended(h):a,b))}return d.join("")}},{_hitTestChildren:function a(b,c,d){return a.base.call(this,b,c.class===Path||"path"===c.type?c:Base.set({},c,{fill:!1}),d)},_draw:function(a,b,c,d){var e=this._children;if(e.length){b=b.extend({dontStart:!0,dontFinish:!0}),a.beginPath();for(var f=0,g=e.length;f<g;f++)e[f].draw(a,b,d);if(!b.clip){this._setStyles(a,b,c);var h=this._style;h.hasFill()&&(a.fill(h.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),h.hasStroke()&&a.stroke()}}},_drawSelected:function(a,b,c){for(var d=this._children,e=0,f=d.length;e<f;e++){var g=d[e],h=g._matrix;c[g._id]||g._drawSelected(a,h.isIdentity()?b:b.appended(h))}}},new function(){function a(a,b){var c=a._children;if(b&&!c.length)throw new Error("Use a moveTo() command first");return c[c.length-1]}return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(b){this[b]=function(){var c=a(this,!0);c[b].apply(c,arguments)}},{moveTo:function(){var b=a(this),c=b&&b.isEmpty()?b:new Path(Item.NO_INSERT);c!==b&&this.addChild(c),c.moveTo.apply(c,arguments)},moveBy:function(){var b=a(this,!0),c=b&&b.getLastSegment(),d=Point.read(arguments);this.moveTo(c?d.add(c._point):d)},closePath:function(b){a(this,!0).closePath(b)}})},Base.each(["reverse","flatten","simplify","smooth"],function(a){this[a]=function(b){for(var d,c=this._children,e=0,f=c.length;e<f;e++)d=c[e][a](b)||d;return d}},{}));PathItem.inject(new function(){function e(a,b){var c=a.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return b&&c.setClosed(!0),b?c.resolveCrossings().reorient("nonzero"===c.getFillRule()):c}function f(a,b,c,d,e){var f=new a(Item.NO_INSERT);return f.addChildren(b,!0),c&&(f=f.reduce({simplify:!0})),f.insertAbove(e&&d.isSibling(e)&&d.getIndex()<e.getIndex()?e:d),f.copyAttributes(d,!0),f}function g(a,b,c){function A(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];q.push.apply(q,d._segments),r.push.apply(r,d.getCurves()),d._overlapsOnly=d._validOverlapsOnly=!0}}var g=d[c];if(g[c]=!0,!a.isClosed())return h(a,b,g);var i=e(a,!0),k=b&&a!==b&&e(b,!0);k&&(g.subtract||g.exclude)^(k.isClockwise()^i.isClockwise())&&k.reverse();var s,n=j(CurveLocation.expand(i.getCrossings(k))),o=i._children||[i],p=k&&(k._children||[k]),q=[],r=[];if(!n.length){var t=!0;if(p)for(var u=0,v=o.length;u<v&&t;u++)for(var w=o[u].getBounds(),x=0,y=p.length;x<y&&t;x++){var z=p[x].getBounds();t=!w._containsRectangle(z)&&!z._containsRectangle(w)}t&&(s=g.unite||g.exclude?[i,k]:g.subtract?[i]:g.intersect?[new Path(Item.NO_INSERT)]:null)}if(!s){A(o),p&&A(p);for(var B=0,C=n.length;B<C;B++)l(n[B]._segment,i,k,r,g);for(var B=0,C=q.length;B<C;B++){var D=q[B],E=D._intersection;if(null==D._winding&&l(D,i,k,r,g),!E||!E._overlap){var F=D._path;F._overlapsOnly=!1,g[D._winding.winding]&&(F._validOverlapsOnly=!1)}}s=m(q,g)}return f(CompoundPath,s,!0,a,b)}function h(a,b,c){function k(a){if(g.contains(a.getPointAt(a.getLength()/2))^i)return j.unshift(a),!0}if(!b||!c.subtract&&!c.intersect)throw new Error("Boolean operations on open paths only support subtraction and intersection with another path.");for(var d=e(a,!1),g=e(b,!1),h=d.getCrossings(g),i=c.subtract,j=[],l=h.length-1;l>=0;l--){var m=h[l].split();m&&(k(m)&&m.getFirstSegment().setHandleIn(0,0),d.getLastSegment().setHandleOut(0,0))}return k(d),f(Group,j,!1,a,b)}function i(a,b){for(var c=a;c;){if(c===b)return;c=c._previous}for(;a._next&&a._next!==b;)a=a._next;if(!a._next){for(;b._previous;)b=b._previous;a._next=b,b._previous=a}}function j(a,b){for(var h,j,c=b&&[],d=4e-7,e=1-d,f=!1,g=[],k=a.length-1;k>=0;k--){var l=a[k];if(b){if(!b(l))continue;c.unshift(l)}var p,m=l._curve,n=l._time,o=n;if(m!==h?f=!m.hasHandles():j>=d&&j<=e&&(n/=j),n<d)p=m._segment1;else if(n>e)p=m._segment2;else{var q=m.divideAtTime(n,!0);f&&g.push(m,q),p=q._segment1}l._setSegment(p);var r=p._intersection,s=l._intersection;if(r){i(r,s);for(var t=r;t;)i(t._intersection,r),t=t._next}else p._intersection=s;h=m,j=o}for(var k=0,u=g.length;k<u;k++)g[k].clearHandles();return c||a}function k(d,e,f,g){function B(c){var h=c[j],l=c[j+6];if(h>n&&l>n||h<n&&l<n)return c;var m=c[i],q=c[i+2],r=c[i+4],u=c[i+6];if(h===l)return(q<p&&u>o||u<p&&q>o)&&(w=!0),y;var v=null,z=n===h?m:n===l?u:o>b(m,q,r,u)||p<a(m,q,r,u)?(m+u)/2:1===Curve.solveCubic(c,j,n,x,0,1)?Curve.getPoint(c,v=x[0])[f?"y":"x"]:(m+u)/2,B=h>l?1:-1,C=y[j]>y[j+6]?1:-1,D=y[i+6];return n!==h?z<o?s+=B:z>p?t+=B:(w=!0,s+=B,t+=B):B!==C?(D<p&&(s+=B),D>o&&(t+=B)):(D<o&&z>o||D>p&&z<p)&&(w=!0,D<o?t+=B:D>p&&(s+=B)),w&&!g&&(v=n===h?0:n===l?1:v,A=null!==v&&0===Curve.getTangent(c,v)[f?"x":"y"]&&k(d,e,f?0:1,!0)),c}function C(c){var d=c[j],e=c[j+2],g=c[j+4],h=c[j+6];if(n<=b(d,e,g,h)&&n>=a(d,e,g,h))for(var k=c[i],l=c[i+2],m=c[i+4],q=c[i+6],r=o>b(k,l,m,q)||p<a(k,l,m,q)?[c]:Curve.getMonoCurves(c,f),s=0,t=r.length;!A&&s<t;s++)y=B(r[s])}for(var y,z,A,h=1e-8,i=f?1:0,j=f?0:1,l=[d.x,d.y],m=l[i],n=l[j],o=m-h,p=m+h,q=0,r=0,s=0,t=0,u=0,v=0,w=!1,x=[],D=0,E=e.length;!A&&D<E;D++){var F=e[D],G=F._path,H=F.getValues();if(!D||e[D-1]._path!==G){if(y=null,!G._closed){var I=G.getLastCurve().getPoint2(),J=F.getPoint1(),K=I._x,L=I._y,M=J._x,N=J._y;z=[K,L,K,L,M,N,M,N],z[j]!==z[j+6]&&(y=z)}if(!y){y=H;for(var O=G.getLastCurve();O&&O!==F;){var P=O.getValues();if(P[j]!==P[j+6]){y=P;break}O=O.getPrevious()}}}if(C(H),!A&&(D+1===E||e[D+1]._path!==G)){if(z&&(C(z),z=null),s||t||!w)q+=s,r+=t,s=t=0;else{var Q=G.isClockwise()^f?1:-1;q+=Q,r-=Q,u+=Q}w&&v++,w=!1}}return A||(q||r||(q=r=u),q=q&&2-c(q)%2,r=r&&2-c(r)%2,A={winding:b(q,r),windingL:q,windingR:r,onContour:!q^!r,onPathCount:v}),A}function l(a,b,d,e,f){var j,g=[],h=a,i=0;do{var l=a.getCurve(),m=l.getLength();g.push({segment:a,curve:l,length:m}),i+=m,a=a.getNext()}while(a&&!a._intersection&&a!==h);for(var m=i/2,n=0,o=g.length;n<o;n++){var p=g[n],q=p.length;if(m<=q){var l=p.curve,r=l._path,s=r._parent,t=l.getTimeAt(m),u=l.getPointAtTime(t),v=c(l.getTangentAtTime(t).normalize().y)<.5?1:0;s instanceof CompoundPath&&(r=s),j=f.subtract&&d&&(r===b&&d._getWinding(u,v).winding||r===d&&!b._getWinding(u,v).winding)?{winding:0}:k(u,e,v);break}m-=q}for(var n=g.length-1;n>=0;n--)g[n].segment._winding=j}function m(a,b){function g(a,c){var d;return!(!a||a._visited||!(!b||b[(d=a._winding).winding]||!c&&b.unite&&d.onContour))}function h(a){return a===e||a===f}function i(a){for(var b=a._segments,c=0,d=b.length;c<d;c++)b[c]._visited=!0}function j(a,c){if(!a._next)return a;for(;a;){var d=a._segment,e=d.getNext(),f=e&&e._intersection;if(d!==c&&(h(d)||h(e)||e&&!d._visited&&!e._visited&&(!b||g(d)&&(g(e)||f&&g(f._segment)))))return a;
a=a._next}return null}var e,f,d=[];a.sort(function(a,b){var c=a._intersection,d=b._intersection,e=!(!c||!c._overlap),f=!(!d||!d._overlap),g=a._path,h=b._path;return e^f?e?1:-1:c^d?c?1:-1:g!==h?g._id-h._id:a._index-b._index});for(var k=0,l=a.length;k<l;k++){var q,m=null,n=!1,o=a[k],p=o._intersection;if(!o._visited&&o._path._overlapsOnly){var r=o._path,s=p._segment._path;r.compare(s)&&((b.unite||b.intersect)&&r.getArea()&&d.push(r.clone(!1)),i(r),i(s))}if(g(o,!0)){for(e=f=null;;){p=p&&j(p,o)||p;var t=p&&p._segment;if(h(o)?n=!0:t&&(h(t)?(n=!0,o=t):g(t,g(o,!0))&&(b&&(b.intersect||b.subtract)&&(o._visited=!0),o=t)),n||o._visited){o._visited=!0;break}if(o._path._validOverlapsOnly&&!g(o))break;m||(m=new Path(Item.NO_INSERT),e=o,f=t);var u=o.getNext();m.add(new Segment(o._point,q,u&&o._handleOut)),o._visited=!0,o=u||o._path.getFirstSegment(),q=u&&u._handleIn,p=o._intersection}if(n)m.firstSegment.setHandleIn(q),m.setClosed(!0);else if(m){var v=m.getArea(!0);c(v)>=1e-7&&console.error("Boolean operation resulted in open path","segments =",m._segments.length,"length =",m.getLength(),"area=",v),m=null}m&&(m._segments.length>8||!Numerical.isZero(m.getArea()))&&(d.push(m),m=null)}}return d}var a=Math.min,b=Math.max,c=Math.abs,d={unite:{1:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0}};return{_getWinding:function(a,b){return k(a,this.getCurves(),b)},unite:function(a){return g(this,a,"unite")},intersect:function(a){return g(this,a,"intersect")},subtract:function(a){return g(this,a,"subtract")},exclude:function(a){return g(this,a,"exclude")},divide:function(a){return f(Group,[this.subtract(a),this.intersect(a)],!0,this,a)},resolveCrossings:function(){function c(a){var b=a&&a._intersection;return b&&b._overlap}var a=this._children,b=a||[this],d=!1,e=!1,f=this.getIntersections(null,function(a){return a._overlap&&(d=!0)||a.isCrossing()&&(e=!0)});if(f=CurveLocation.expand(f),d)for(var g=j(f,function(a){return a._overlap}),h=g.length-1;h>=0;h--){var i=g[h]._segment,k=i.getPrevious(),l=i.getNext();if(i._path&&c(k)&&c(l)){i.remove(),k._handleOut._set(0,0),l._handleIn._set(0,0);var n=k.getCurve();n.isStraight()&&0===n.getLength()&&(l._handleIn.set(k._handleIn),k.remove())}}e&&(j(f,d&&function(a){var b=a.getCurve(),c=a._intersection._curve,d=a._segment;return!!(b&&c&&b._path&&c._path)||void(d&&(d._intersection=null))}),b=m(Base.each(b,function(a){this.push.apply(this,a._segments)},[])));var p,o=b.length;return o>1&&a?(b!==a&&this.setChildren(b),p=this):1!==o||a||(b[0]!==this&&this.setSegments(b[0].removeSegments()),p=this),p||(p=new CompoundPath(Item.NO_INSERT),p.addChildren(b),p=p.reduce(),p.copyAttributes(this),this.replaceWith(p)),p},reorient:function(a){var b=this._children,d=b&&b.length;if(d>1){var e=Base.each(b,function(a,b){this[a._id]={winding:a.isClockwise()?1:-1,index:b}},{}),f=this.removeChildren().sort(function(a,b){return c(b.getArea())-c(a.getArea())}),g=f[0],h=[];h[e[g._id].index]=g;for(var i=1;i<d;i++){for(var j=f[i],k=e[j._id],l=j.getInteriorPoint(),m=!1,n=null,o=!1,p=i-1;p>=0&&!n;p--){var q=f[p];if(q.contains(l)){var r=e[q._id];if(a&&!m&&(k.winding+=r.winding,k.winding&&r.winding)){o=k.exclude=!0;break}m=!0,n=!r.exclude&&q}}o||(j.setClockwise(n?!n.isClockwise():g.isClockwise()),h[k.index]=j)}this.setChildren(h)}return this},getInteriorPoint:function(){var c=this.getBounds(),d=c.getCenter(!0);if(!this.contains(d)){for(var e=this.getCurves(),f=d.y,g=[],h=[],i=0,j=e.length;i<j;i++){var k=e[i].getValues(),l=k[1],m=k[3],n=k[5],o=k[7];if(f>=a(l,m,n,o)&&f<=b(l,m,n,o))for(var p=Curve.getMonoCurves(k),q=0,r=p.length;q<r;q++){var s=p[q],t=s[1],u=s[7];if(t!==u&&(f>=t&&f<=u||f>=u&&f<=t)){var v=f===t?s[0]:f===u?s[6]:1===Curve.solveCubic(s,1,f,h,0,1)?Curve.getPoint(s,h[0]).x:(s[0]+s[6])/2;g.push(v)}}}g.length>1&&(g.sort(function(a,b){return a-b}),d.x=(g[0]+g[1])/2)}return d}}}),new function(){function c(a,b){return a.getPathData(null,b.precision)}function d(a,b){return a.getPathData(null,b.precision)}function i(a,b){var c=a,d=null;if(f){c="svg"===a.nodeName.toLowerCase()&&a;for(var e in f.svgs)d||(c||(c=SvgElement.create("svg"),c.appendChild(a)),d=c.insertBefore(SvgElement.create("defs"),c.firstChild)),d.appendChild(f.svgs[e]);f=null}return b.asString?(new self.XMLSerializer).serializeToString(c):c}function j(a,b,c){var d=e[a._class],f=d&&d(a,b);if(f){var g=b.onExport;g&&(f=g(a,f,b)||f);var h=JSON.stringify(a._data);h&&"{}"!==h&&"null"!==h&&f.setAttribute("data-paper-data",h)}return f}function k(b){return b||(b={}),a=new Formatter(b.precision),b}var a,f,e={Path:c,CompoundPath:d};Item.inject({exportSVG:function(a){return a=k(a),i(j(this,a,!0),a)}})};

paper = new (PaperScope.inject(Base.exports, {
  enumerable: true,
  Base: Base,
  Numerical: Numerical,
  //document: document,
  //window: window,
}))();

/*if (typeof define === 'function' && define.amd) {
  define('paper', paper);
} else if (typeof module === 'object' && module) {
  module.exports = paper;
}
*/
//return paper;
//}.call(this, typeof self === 'object' ? self : null);

export { paper, Path };